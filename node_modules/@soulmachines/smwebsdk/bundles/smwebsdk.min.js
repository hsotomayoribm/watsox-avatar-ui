!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t();else if("function"==typeof define&&define.amd)define([],t);else{var n=t();for(var r in n)("object"==typeof exports?exports:e)[r]=n[r]}}(self,(()=>(()=>{"use strict";var e={d:(t,n)=>{for(var r in n)e.o(n,r)&&!e.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:n[r]})}};e.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),e.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),e.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})};var t={};e.r(t),e.d(t,{AnimateToNamedCameraRequestBody:()=>s.AnimateToNamedCameraRequestBody,ConnectOptions:()=>w.ConnectOptions,ConnectionState:()=>vn,ConnectionStateTypes:()=>q,ContentAwareness:()=>Ve,ContentCardFormatter:()=>fn,Conversation:()=>hn,ConversationResultResponseBody:()=>S.ConversationResultResponseBody,ConversationSendRequestBody:()=>r.ConversationSendRequestBody,ConversationSetVariablesRequestBody:()=>o.ConversationSetVariablesRequestBody,ConversationState:()=>pn,ConversationStateTypes:()=>un,DemoModeResponseBody:()=>E.DemoModeResponseBody,GetModelChildrenRequestBody:()=>f.GetModelChildrenRequestBody,GetModelFilterSearchResultRequestBody:()=>h.GetModelFilterSearchResultRequestBody,GetModelVariableFilterSearchResultRequestBody:()=>d.GetModelVariableFilterSearchResultRequestBody,GetModelVariablesListRequestBody:()=>p.GetModelVariablesListRequestBody,GetVariablesListRequestBody:()=>l.GetVariablesListRequestBody,GetVariablesRequestBody:()=>i.GetVariablesRequestBody,LogLevel:()=>n.LogLevel,NLPIntent:()=>H,Persona:()=>P,PersonaRequestBody:()=>a.PersonaRequestBody,PlayAnimationRequestBody:()=>c.PlayAnimationRequestBody,RecognizeResultsResponseBody:()=>T.RecognizeResultsResponseBody,Scene:()=>Yl,SceneOptions:()=>w.SceneOptions,SceneRequest:()=>m.SceneRequest,SceneRequestBody:()=>m.SceneRequestBody,SceneResponse:()=>R.SceneResponse,SceneResponseError:()=>K,SetVariablesRequestBody:()=>u.SetVariablesRequestBody,SmEvent:()=>C,SpeechMarkerResponseBody:()=>b.SpeechMarkerResponseBody,StartRecognizeRequestBody:()=>v.StartRecognizeRequestBody,StartSpeakingOptionalArgs:()=>y.StartSpeakingOptionalArgs,StartSpeakingRequestBody:()=>y.StartSpeakingRequestBody,StateResponseBody:()=>O.StateResponseBody,StopBlProfilingRequestBody:()=>_.StopBlProfilingRequestBody,UpdateContentAwarenessRequestBody:()=>g.UpdateContentAwarenessRequestBody,UserMedia:()=>z,WebsocketKind:()=>J,smwebsdk:()=>Zl});var n={};e.r(n),e.d(n,{Y:()=>B});var r={};e.r(r);var o={};e.r(o);var i={};e.r(i);var a={};e.r(a);var s={};e.r(s);var c={};e.r(c);var u={};e.r(u);var l={};e.r(l);var p={};e.r(p);var f={};e.r(f);var h={};e.r(h);var d={};e.r(d);var _={};e.r(_);var v={};e.r(v);var y={};e.r(y);var g={};e.r(g);var m={};e.r(m);var E={};e.r(E);var T={};e.r(T);var S={};e.r(S);var b={};e.r(b),e.d(b,{Z:()=>F});var O={};e.r(O),e.d(O,{T:()=>X});var R={};e.r(R);var w={};e.r(w),e.d(w,{x:()=>Yl});var C=function(){function e(){this._callbacks=[]}return e.prototype.addListener=function(e){this._callbacks.push(e)},e.prototype.removeListener=function(e){var t=this._callbacks.indexOf(e);t>-1&&this._callbacks.splice(t,1)},e.prototype.call=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];this._callbacks.forEach((function(t){t.apply(t,e)}),this)},e}(),P=function(){function e(e,t){this._scene=e,this._personaId=t,this._scene.onConversationResultEvents[t]||(this._scene.onConversationResultEvents[t]=new C),this._onConversationResultEvent=this._scene.onConversationResultEvents[t],this._scene.onSpeechMarkerEvents[t]||(this._scene.onSpeechMarkerEvents[t]=new C),this._onSpeechMarkerEvent=this._scene.onSpeechMarkerEvents[t]}return e.prototype.startSpeaking=function(e,t,n){void 0===t&&(t=null),void 0===n&&(n=null);var r={personaId:this._personaId,text:e};return t&&(r.context=t),n&&(r.optionalArgs=n),this._scene.sendRequest("startSpeaking",r)},e.prototype.stopSpeaking=function(){var e={personaId:this._personaId};return this._scene.sendRequest("stopSpeaking",e)},e.prototype.conversationSend=function(e,t,n){var r={personaId:this._personaId,text:e,variables:t,optionalArgs:n};return this._scene.sendRequest("conversationSend",r)},e.prototype.conversationSetVariables=function(e){var t={personaId:this._personaId,variables:e};return this._scene.sendRequest("conversationSetVariables",t)},e.prototype.conversationGetVariables=function(){var e={personaId:this._personaId};return this._scene.sendRequest("conversationGetVariables",e)},e.prototype.animateToNamedCameraWithOrbitPan=function(e,t,n,r,o,i){var a={personaId:this._personaId,cameraName:e,time:t,orbitDegX:n,orbitDegY:r,panDeg:o,tiltDeg:i};return this._scene.sendRequest("animateToNamedCamera",a)},e.prototype.playAnimation=function(e){var t={personaId:this._personaId,animation:e};return this._scene.sendRequest("playAnimation",t)},e.prototype.getVariables=function(e,t,n){void 0===t&&(t=!1),void 0===n&&(n="");var r={personaId:this._personaId,names:e,errorTolerant:t,format:n};return this._scene.sendRequest("getVariables",r)},e.prototype.setVariables=function(e){var t={personaId:this._personaId,Variables:e};return this._scene.sendRequest("setVariables",t)},e.prototype.setVariablesOneway=function(e){var t={personaId:this._personaId,Variables:e};this._scene.sendOnewaySceneRequest("setVariables",t)},e.prototype.getVariablesList=function(){var e={personaId:this._personaId};return this._scene.sendRequest("getVariablesList",e)},e.prototype.getModelVariablesList=function(e){var t={personaId:this._personaId,Models:e};return this._scene.sendRequest("getModelVariablesList",t)},e.prototype.getModelChildren=function(e){var t={personaId:this._personaId,Models:e};return this._scene.sendRequest("getModelChildren",t)},e.prototype.getModelFilterSearchResult=function(e){var t={personaId:this._personaId,Models:e};return this._scene.sendRequest("getModelFilterSearchResult",t)},e.prototype.getModelVariableFilterSearchResult=function(e){var t={personaId:this._personaId,Models:e};return this._scene.sendRequest("getModelVariableFilterSearchResult",t)},e.prototype.getConnectorEntries=function(e){var t={personaId:this._personaId,model:e};return this._scene.sendRequest("getConnectorEntries",t)},e.prototype.startBlProfiling=function(){var e={personaId:this._personaId};return this._scene.sendRequest("startBlProfiling",e)},e.prototype.stopBlProfiling=function(e){var t={personaId:this._personaId,reverse:e};return this._scene.sendRequest("stopBlProfiling",t)},e.prototype.getModelHierarchy=function(e){var t={personaId:this._personaId,model:e};return this._scene.sendRequest("getModelHierarchy",t)},e.prototype.createMonitorSet=function(e,t){var n={personaId:this._personaId,setName:[{SetName:e}],variables:t};return this._scene.sendRequest("createMonitorSet",n)},e.prototype.removeMonitorSet=function(e){var t={personaId:this._personaId,setName:[{SetName:e}]};return this._scene.sendRequest("removeMonitorSet",t)},e.prototype.addVariableToMonitorSet=function(e,t){var n={personaId:this._personaId,setName:[{SetName:e}],variables:t};return this._scene.sendRequest("addVariableToMonitorSet",n)},e.prototype.removeVariableFromMonitorSet=function(e,t){var n={personaId:this._personaId,setName:[{SetName:e}],variables:t};return this._scene.sendRequest("removeVariableFromMonitorSet",n)},e.prototype.renderModel=function(e){var t={personaId:this._personaId,modelName:e};return this._scene.sendRequest("renderModel",t)},Object.defineProperty(e.prototype,"onConversationResultEvent",{get:function(){return this._onConversationResultEvent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onSpeechMarkerEvent",{get:function(){return this._onSpeechMarkerEvent},enumerable:!1,configurable:!0}),e}(),A=function(e,t){return A=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},A(e,t)};var L=function(){return L=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},L.apply(this,arguments)};function M(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))}function I(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(c){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(a=0)),a;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return a.label++,{value:s[1],done:!1};case 5:a.label++,r=s[1],s=[0];continue;case 7:s=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){a=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){a.label=s[1];break}if(6===s[0]&&a.label<o[1]){a.label=o[1],o=s;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(s);break}o[2]&&a.ops.pop(),a.trys.pop();continue}s=t.call(e,a)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,c])}}}Object.create;function N(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function x(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}function k(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))}Object.create;var U=function(){function e(){var e=this;this.state="pending",this.fate="unresolved",this.promise=new Promise((function(t,n){e._resolve=t,e._reject=n})),this.promise.then((function(){return e.state="fulfilled"}),(function(){return e.state="rejected"}))}return e.prototype.resolve=function(e){"resolved"!==this.fate?(this.fate="resolved",this._resolve(e)):console.error("Deferred cannot be resolved twice")},e.prototype.reject=function(e){"resolved"!==this.fate?(this.fate="resolved",this._reject(e)):console.error("Deferred cannot be resolved twice")},e.prototype.isResolved=function(){return"resolved"===this.fate},e.prototype.isPending=function(){return"pending"===this.state},e.prototype.isFulfilled=function(){return"fulfilled"===this.state},e.prototype.isRejected=function(){return"rejected"===this.state},e}(),D=function(){function e(){this._hasMicrophone=!1,this._hasCamera=!1,this._isAndroid=!1,this._isBrowserSupported=!1,this._isEdge=!1,this._isIos=!1,this._isAndroid=this.detectAndroid(),this._isEdge=this.detectEdge(),this._isIos=this.detectIos()}return e.prototype.detectEdge=function(){return this.userAgentMatches("Edge")},e.prototype.detectAndroid=function(){return this.userAgentMatches("Android")},e.prototype.detectIos=function(){return(/iPad|iPhone|iPod/i.test(navigator.platform)||navigator&&"MacIntel"===navigator.platform&&navigator.maxTouchPoints>1)&&!window.MSStream},e.prototype.userAgentMatches=function(e){var t=window.navigator.userAgent.match(e);return!!t&&t.length>0},e.prototype.detectWebRTCFeatures=function(){var e=this;return new Promise((function(t,n){window.SmIsUnderRuntimeHost&&(e._isBrowserSupported=!0,e._hasMicrophone=!0,e._hasCamera=!0,t(e));var r=!1;["RTCPeerConnection","webkitRTCPeerConnection","mozRTCPeerConnection","RTCIceGatherer"].forEach((function(e){r||e in window&&(r=!0)}));var o=navigator.userAgent.match(/iPhone|iPad|iPod/i)&&!window.MSStream,i=/^((?!chrome|android).)*safari/i.test(navigator.userAgent);r&&o&&!i&&(r=!1),e._isBrowserSupported=r,e._isBrowserSupported||t(e);var a=null;navigator.mediaDevices&&navigator.mediaDevices.enumerateDevices&&(a=function(e){Promise.resolve(navigator.mediaDevices.enumerateDevices()).then((function(t){void 0===t&&(t=[]),e(t)})).catch((function(){e([])}))});var s=window.MediaStreamTrack;!a&&s&&s.getSources&&(a=s.getSources.bind(s)),!a&&navigator.enumerateDevices&&(a=navigator.enumerateDevices.bind(navigator)),a?a((function(n){n.forEach((function(t){"audioinput"===t.kind&&(e._hasMicrophone=!0),"videoinput"===t.kind&&(e._hasCamera=!0)})),t(e)})):t(e)}))},Object.defineProperty(e.prototype,"hasMicrophone",{get:function(){return this._hasMicrophone},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"hasCamera",{get:function(){return this._hasCamera},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isAndroid",{get:function(){return this._isAndroid},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isBrowserSupported",{get:function(){return this._isBrowserSupported},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isEdge",{get:function(){return this._isEdge},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isIos",{get:function(){return this._isIos},enumerable:!1,configurable:!0}),e}(),j=["debug","log","warn","error"],B=function(){function e(e,t){void 0===e&&(e="log"),void 0===t&&(t=!0),this.isEnabled=t,this.availableLogLevels=[],this._minLogLevel="log",this.setMinLogLevel(e)}return e.prototype.log=function(e){for(var t=[],n=1;n<arguments.length;n++)t[n-1]=arguments[n];this.isEnabled&&this.availableLogLevels.includes(e)&&console[e].apply(console,k([],x(t),!1))},e.prototype.enableLogging=function(e){this.isEnabled=e},e.prototype.getMinLogLevel=function(){return this._minLogLevel},e.prototype.setMinLogLevel=function(e){var t=j.indexOf(e);this._minLogLevel=e,this.availableLogLevels=j.slice(t)},e}();function V(e,t){var n=new Error(e);return n.name=t,n}var F,X,G=function(){function e(e,t){void 0===t&&(t=new B);var n=this;this.logger=t,this._isMicrophoneConnected=!1,this._isCameraConnected=!1,this._onConnectedStorage=function(e,t,n,r){},this._closed=!1,this._outgoingQueue=[],this._microphoneMuteDelay=-1,this._offsetX=0,this._offsetY=0,e&&(this._viewport_element=e),window.SmRuntimeHostReceiveMessage=this.receiveMessage.bind(this),"function"==typeof window.SmRuntimeHostStyleViewportElement&&window.SmRuntimeHostStyleViewportElement(this._viewport_element),this._onClose=function(e){},this._onMessage=function(e){},this._onUserText=function(e){},this.sendVideoBounds(0,0),setTimeout((function(){n.sendVideoBounds(0,0)}),3e3),this._features=new D,this.log("Local session created!")}return e.prototype.receiveMessage=function(e){var t,n,r=JSON.parse(e);this.log("message received: ".concat(e)),this._onMessage(r),"state"===r.name&&"scene"===r.category&&"idle"===(null===(n=null===(t=r.body)||void 0===t?void 0:t.session)||void 0===n?void 0:n.state)&&(this.log("Local session ending - conversationEnded"),this.close(!0,"conversationEnded"))},Object.defineProperty(e.prototype,"onConnected",{set:function(e){this._onConnectedStorage=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onClose",{set:function(e){this._onClose=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMessage",{set:function(e){this._onMessage=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onUserText",{set:function(e){this._onUserText=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loggingEnabled",{get:function(){return this.logger.isEnabled},set:function(e){this.logger.log("warn","loggingEnabled is deprecated and will be removed in a future version. Please use setLogging(boolean)"),this.logger.enableLogging(e)},enumerable:!1,configurable:!0}),e.prototype.setMinLogLevel=function(e){this.logger.setMinLogLevel(e)},e.prototype.setLogging=function(e){this.logger.enableLogging(e)},e.prototype.log=function(e){this.logger.log("log",e)},e.prototype.sendVideoBounds=function(e,t){var n=this;setTimeout((function(){var e=n._viewport_element;if(e){var t=document.defaultView||window,r=parseInt(t.getComputedStyle(e).width,10),o=parseInt(t.getComputedStyle(e).height,10);for(n._offsetX=0,n._offsetY=0;e&&!isNaN(e.offsetLeft)&&!isNaN(e.offsetTop);)n._offsetX+=e.offsetLeft-e.scrollLeft,n._offsetY+=e.offsetTop-e.scrollTop,e=e.offsetParent;if(document.documentElement){var i=document.documentElement.scrollLeft,a=document.documentElement.scrollTop;n._offsetX-=i,n._offsetY-=a}n.log("Updating bounds: x =  ".concat(n._offsetX," , y = ").concat(n._offsetY,"', w = ").concat(r,", h = ").concat(o));var s={name:"videoBounds",body:{top:n._offsetY,left:n._offsetX,bottom:n._offsetY+o,right:n._offsetX+r},category:"local",kind:"event"};n.sendMessage(s)}}),0)},e.prototype.hideVideo=function(){var e={name:"videoBounds",body:{top:0,left:0,bottom:0,right:0},category:"local",kind:"event"};this.sendMessage(e)},e.prototype.sendRtcEvent=function(e,t){},e.prototype.connect=function(){return M(this,void 0,Promise,(function(){var e,t,n,r=this;return I(this,(function(o){switch(o.label){case 0:return e=new U,this.log("Local session connecting!"),this._closed=!1,[4,this._features.detectWebRTCFeatures()];case 1:return t=o.sent(),this._closed=!1,this._sessionId=void 0,this._isMicrophoneConnected=t.hasMicrophone,this._isCameraConnected=t.hasCamera,"number"==typeof window.local_websocket_port?(this._serverConnection=new WebSocket("ws://localhost:"+window.local_websocket_port),this.log("websocket open"),this._serverConnection.onmessage=function(e){r.gotMessageFromServer(e)},this._serverConnection.onerror=function(t){e.isPending()&&e.reject(V("websocket failed","serverConnectionFailed"))},this._serverConnection.onopen=function(t){window.SmRuntimeHostReceiveMessage=function(){},r.log("Local session connected!");for(var n=0;n<r._outgoingQueue.length;n++)r._serverConnection.send(JSON.stringify(r._outgoingQueue[n])),r.logger.log("log","SmLocalSession.prototype.sendMessage, forwarding message to Web Socket: "+r._outgoingQueue[n]);r._outgoingQueue=[],e.isPending()&&e.resolve()},this._serverConnection.onclose=function(t){r.logger.log("log","websocket closed: code(".concat(t.code,"), reason(").concat(t.reason,"), clean(").concat(t.wasClean,")")),e.isRejected||r.close(!1,"normal")}):(this.log("local_websocket_port not found! Failed to create WebSocket"),e.isPending()&&e.reject(V("websocket failed","local_websocket_port not found"))),n={name:"startSession",body:{},category:"scene",kind:"request"},this.sendMessage(n),[2,e.promise]}}))}))},e.prototype.gotMessageFromServer=function(e){var t=e.data,n=JSON.parse(t),r=n.category,o=n.name,i=n.body;"webrtc"!==r?this._onMessage(n):"close"===o&&this.close(!1,i.reason),"state"===o&&"scene"===r&&null!==i.session&&void 0!==i.session&&"idle"===i.session.state&&(this.log("Local session ending due to server idle message"),this.close(!0,"conversationEnded"))},e.prototype.sendMessage=function(e){var t=JSON.stringify(e);this._serverConnection&&this._serverConnection.readyState===WebSocket.OPEN?(this._serverConnection.send(t),this.log("SmLocalSession.prototype.sendMessage, forwarding message to Web Socket: ".concat(t))):this._outgoingQueue.push(e)},e.prototype.sendUserText=function(e){this.logger.log("log","SmLocalSession.prototype.sendUserText, discarding text: "+e)},e.prototype.close=function(e,t){if(void 0===e&&(e=!0),void 0===t&&(t="normal"),!this._closed&&(this._closed=!0,this._onClose(t),this._isMicrophoneConnected=!1,this._isCameraConnected=!1,this.hideVideo(),this._serverConnection)){this.log("closing server connection");this._serverConnection.close(1e3,t)}},Object.defineProperty(e.prototype,"peerConnection",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userMediaStream",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"serverConnection",{get:function(){return this._serverConnection},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sessionId",{get:function(){return this._sessionId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isMicrophoneConnected",{get:function(){return this._isMicrophoneConnected},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCameraConnected",{get:function(){return this._isCameraConnected},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"features",{get:function(){return this._features},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"microphoneMuteDelay",{get:function(){return this._microphoneMuteDelay},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"microphoneMuted",{get:function(){return"function"==typeof window.SmRuntimeHostIsMicrophoneMuted&&window.SmRuntimeHostIsMicrophoneMuted()},set:function(e){"function"==typeof window.SmRuntimeHostMuteMicrophone&&window.SmRuntimeHostMuteMicrophone(e)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offsetX",{get:function(){return this._offsetX},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offsetY",{get:function(){return this._offsetY},enumerable:!1,configurable:!0}),e.prototype.isMicrophoneActive=function(){return this.isMicrophoneConnected&&!this.microphoneMuted},e.prototype.isCameraActive=function(){return this.isCameraConnected},e.prototype.setMediaDeviceActive=function(e){e.microphone,e.camera;return M(this,void 0,Promise,(function(){return I(this,(function(e){throw V("setMediaDeviceActive not supported on LocalSession","notSupported")}))}))},e}();!function(e){e.Showcards="showcards",e.Hidecards="hidecards",e.Feature="feature",e.Marker="marker"}(F||(F={})),function(e){e.UI_CONTENT_AWARENESS="UI_CONTENT_AWARENESS",e.UI_SDK_CAMERA_CONTROL="UI_SDK_CAMERA_CONTROL"}(X||(X={}));var z,H,q,K=function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.requestName="",t.status=0,t}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Class extends value "+String(t)+" is not a constructor or null");function n(){this.constructor=e}A(e,t),e.prototype=null===t?Object.create(t):(n.prototype=t.prototype,new n)}(t,e),Object.defineProperty(t.prototype,"message",{get:function(){return"Scene response failed, status: ".concat(this.status)},enumerable:!1,configurable:!0}),t}(Error);!function(e){e[e.None=0]="None",e[e.Microphone=1]="Microphone",e[e.MicrophoneAndCamera=2]="MicrophoneAndCamera",e[e.Camera=3]="Camera"}(z||(z={})),function(e){e.PAGE_METADATA="PAGE_METADATA"}(H||(H={})),function(e){e.Disconnected="Disconnected",e.SearchingForDigitalPerson="SearchingForDigitalPerson",e.DownloadingAssets="DownloadingAssets",e.ConnectingToDigitalPerson="ConnectingToDigitalPerson",e.Connected="Connected"}(q||(q={}));var W,J,Q,Y=function(){function e(e,t,n,r,o,i,a,s,c,u){var l=this;this._connectPendingRemoteStream=null,this._resumeRequested=!1,this._isResumedSession=!1,this._outgoingQueue=[],this._controlOpen=!1,this._controlQueue=[],this._requestedUserMedia=z.None,this._requiredUserMedia=z.None,this._onConnected=function(e,t,n,r){},this._pendingLog=[],this._closed=!1,this._shouldLogToServer=!1,this._microphoneMuteDelay=-1,this._changeUserMediaQueue=new Array,this._removeListeners=new Array,this._videoOptions={frameRate:10,width:640,height:480,facingMode:"user"},this._audioOptions={noiseSuppression:!1,autoGainControl:!1,channelCount:1,sampleRate:16e3,sampleSize:16,echoCancellation:!0},this._videoElement=e,this._serverUri=t,this._connectUserText=n||"",this._accessToken=r,this._audioOnly=o,this._audioOptions.echoCancellation=s,this._requiredUserMedia=a,this._requestedUserMedia=i,this._logger=c,this._onClose=function(e){},this._onMessage=function(e){},this._onUserText=function(e){},this._sessionError=function(e){l.log("session error: ".concat(e),"error")},this._features=new D,this._connectionState=u}return Object.defineProperty(e.prototype,"onConnected",{set:function(e){this._onConnected=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onClose",{set:function(e){this._onClose=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMessage",{set:function(e){this._onMessage=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onUserText",{set:function(e){this._onUserText=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loggingEnabled",{get:function(){return this._logger.isEnabled},set:function(e){this.log("loggingEnabled is deprecated and will be removed in a future version. Please use setLogging(boolean)","warn"),this._logger.enableLogging(e)},enumerable:!1,configurable:!0}),e.prototype.setMinLogLevel=function(e){this._logger.setMinLogLevel(e)},e.prototype.setLogging=function(e){this._logger.enableLogging(e)},e.prototype.log=function(e,t){if(void 0===t&&(t="debug"),this._logger.isEnabled){var n=new Date,r="smsdk: ".concat(n.toISOString(),": ").concat(e);this._shouldLogToServer&&this.logToServer(r),this._logger.log(t,r)}},e.prototype.logToServer=function(e){this.sessionId?this.sendlogMessage([e]):this._pendingLog.push(e)},e.prototype.sendlogMessage=function(e){if(this._sessionId&&e&&e.length>0){var t={category:"diagnostics",kind:"event",name:"log",body:{name:"browser",text:e}};this.sendMessage(t)}},e.prototype.connect=function(e){return M(this,void 0,Promise,(function(){var t,n,r=this;return I(this,(function(o){return t=new U,this._closed=!1,e&&(this._connectUserText=e),this._serverUri&&(this._serverUri.startsWith("ws:")||this._serverUri.startsWith("wss:"))?(this.selectUserMedia(this._requestedUserMedia,this._requiredUserMedia,t,this.getUserMediaSuccess.bind(this)),[2,t.promise]):((n=new XMLHttpRequest).open("GET","/api/jwt"+window.location.search),n.onreadystatechange=function(e){return M(r,void 0,void 0,(function(){var e;return I(this,(function(r){return n.readyState===XMLHttpRequest.DONE&&(200===n.status?(this.log("JWT request returned: ".concat(n.responseText)),e=JSON.parse(n.responseText),this._serverUri=e.url,this._accessToken=e.jwt,this.selectUserMedia(this._requestedUserMedia,this._requiredUserMedia,t,this.getUserMediaSuccess.bind(this))):(this.log("JWT Request failed, status: ".concat(n.statusText),"error"),t.reject(V("Failed to acquire jwt at /api/jwt","noServer")))),[2]}))}))},n.send(),[2,t.promise])}))}))},e.prototype.webcamRequested=function(e,t){return!this._audioOnly&&[z.MicrophoneAndCamera,z.Camera].some((function(n){return[e,t].includes(n)}))},e.prototype.micRequested=function(e,t){return[z.Microphone,z.MicrophoneAndCamera].some((function(n){return[e,t].includes(n)}))},e.prototype.getMediaConstraints=function(e,t){var n=navigator.mediaDevices.getSupportedConstraints();return this.log("Browser supports media constraints: ".concat(n)),{audio:!!this.micRequested(e,t)&&this.buildAudioOptions(),video:!!this.webcamRequested(e,t)&&this._videoOptions}},e.prototype.buildAudioOptions=function(){var e=navigator.mediaDevices.getSupportedConstraints(),t=L({},this._audioOptions);return Object.keys(t).forEach((function(n){e[n]||delete t[n]})),t},e.prototype.selectUserMedia=function(e,t,n,r){var o=this;if(e!==z.None||t!==z.None)if(navigator.mediaDevices.getUserMedia){var i=this.getMediaConstraints(e,t);this.log("Best video constraints: ".concat(i)),navigator.mediaDevices.getUserMedia(i).then((function(e){r(e,n)})).catch((function(i){t===e?(o.log("getUserMedia could not get required media, error given: ".concat(i),"error"),n.reject(o.MakeErrorForUserMedia(i))):t!==z.None?o.getUserMediaRequiredOnlyFallback(t,n,r):e===z.MicrophoneAndCamera?o.getUserMediaAudioOnlyFallback(n,r):r(null,n)}))}else n.reject(V("Your browser does not support getUserMedia API","notSupported"));else r(null,n)},e.prototype.getUserMediaRequiredOnlyFallback=function(e,t,n){var r=this;this.log("Retrying with required media only");var o=this.getMediaConstraints(z.None,e);return this.log("Attempt constraints: ".concat(o)),navigator.mediaDevices.getUserMedia(o).then((function(e){n(e,t)})).catch((function(e){r.log("getUserMedia could not get required media, error given: ".concat(e),"error"),t.reject(r.MakeErrorForUserMedia(e))}))},e.prototype.getUserMediaAudioOnlyFallback=function(e,t){var n=this;this.log("Retrying with microphone only");var r={video:!1,audio:this.buildAudioOptions()};return this.log("Attempt constraints: ".concat(r)),navigator.mediaDevices.getUserMedia(r).then((function(n){t(n,e)})).catch((function(r){n.log("getUserMedia could not get microphone audio, error given: ".concat(r),"error"),t(null,e)}))},e.prototype.MakeErrorForUserMedia=function(e){return V(e.message,"noUserMedia")},e.prototype.getUserMediaSuccess=function(e,t){var n=this;this.log("Got user media"),this._localStream=e,this.microphoneMuted=!0,this.log("connecting to: ".concat(this._serverUri)),this._accessToken?this._serverConnection=new WebSocket(this._serverUri+"?access_token="+this._accessToken):this._serverConnection=new WebSocket(this._serverUri),this._serverConnection.onmessage=function(e){try{n.gotMessageFromServer(e,t)}catch(e){n.log("unexpected exception processing received message: ".concat(e),"error")}},this._serverConnection.onerror=function(e){t.isPending()&&t.reject(V("websocket failed","serverConnectionFailed"))},this._serverConnection.onopen=function(e){n.log("Websocket open"),n._connectionState.setConnectionState(q.SearchingForDigitalPerson)},this._serverConnection.onclose=function(e){n.log("websocket closed: code(".concat(e.code,"), reason(").concat(e.reason,"), clean(").concat(e.wasClean,")")),t.isRejected||n.close(!1,"normal",t)}},e.prototype.hasTurnServer=function(e){var t,n,r,o;if(!e)return!1;try{for(var i=N(e),a=i.next();!a.done;a=i.next()){var s=a.value;if(s&&s.urls)try{for(var c=(r=void 0,N(s.urls)),u=c.next();!u.done;u=c.next()){if(0===u.value.indexOf("turn:"))return!0}}catch(e){r={error:e}}finally{try{u&&!u.done&&(o=c.return)&&o.call(c)}finally{if(r)throw r.error}}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return!1},e.prototype.gotMessageFromServer=function(e,t){var n,r,o=this,i=e.data;this.log("message received: ".concat(i));var a=JSON.parse(i),s=a.category,c=a.name,u=a.body;if("webrtc"!==s)return null!==this._controlConnection&&"scene"===s&&(this._controlOpen&&this._serverConnection.readyState===WebSocket.OPEN?this._controlConnection.send(i):this._controlQueue.push(i)),void this._onMessage(a);if("event"===a.kind)if("established"===c){this._connectionState.setConnectionState(q.DownloadingAssets);var l={iceServers:[]};if(u.iceServers&&(l.iceServers=u.iceServers,this.hasTurnServer(u.iceServers)&&(this.log("Detected turn server, forcing relay mode"),l.iceTransportPolicy="relay")),this.log("selected ice servers: ".concat(l.iceServers)),u.settings&&"number"==typeof u.settings.microphoneMuteDelay&&(this._microphoneMuteDelay=u.settings.microphoneMuteDelay),this.log("microphone mute delay after persona speech: ".concat(this._microphoneMuteDelay)),this._shouldLogToServer=null!==(r=null===(n=u.settings)||void 0===n?void 0:n.logToServer)&&void 0!==r&&r,this._peerConnection=new RTCPeerConnection(l),this._peerConnection.onicecandidate=this.gotIceCandidate.bind(this),"ontrack"in this._peerConnection&&!this._features.isEdge?(this._peerConnection.ontrack=function(e){"video"!==e.track.kind&&"audio"!==e.track.kind||o._remoteStream&&(o._audioOnly||"video"!==e.track.kind)||o.onRemoteStream(e.streams[0])},this._videoElement.addEventListener("loadeddata",this.onVideoLoaded.bind(this)),this._removeListeners.push({target:this._videoElement,name:"loadeddata",callback:this.onVideoLoaded})):this._peerConnection.onaddstream=function(e){o.onRemoteStream(e.stream)},this._peerConnection.oniceconnectionstatechange=function(e){o.log("ICE connection state: ".concat(o._peerConnection.iceConnectionState)),"failed"===o._peerConnection.iceConnectionState&&(V("ice connection failed","mediaStreamFailed"),t&&t.isPending()&&(o._serverConnection.close(),!o._controlConnection||o._controlConnection.readyState!==WebSocket.OPEN&&o._controlConnection.readyState!==WebSocket.CONNECTING||o._controlConnection.close(),t.reject(V("ice connection failed","mediaStreamFailed"))))},this.log("adding local media stream if any"),this._localStream)if(this._peerConnection.addTrack)try{this.log("adding local media stream by track"),this._localStream.getTracks().forEach((function(e){o._peerConnection.addTrack(e,o._localStream)}))}catch(e){this.log("error: ".concat(e),"error")}else this._peerConnection.addStream(this._localStream),this.log("adding local media stream by stream");if(this._peerConnection.addTransceiver("audio",{direction:"sendrecv"}),this._peerConnection.addTransceiver("video",{direction:"sendrecv"}),u.resumeSessionId){var p={voiceActivityDetection:!1,iceRestart:!0};this._sessionId=u.resumeSessionId,this._isResumedSession=!0,this.log("established, trying to resume session with session_id = ".concat(u.resumeSessionId)),this.createOffer(this._peerConnection,p).then((function(e){o.createdDescription.bind(o),o.createdDescription(e,"updateOffer")})).catch(this._sessionError.bind(this))}else{p={voiceActivityDetection:!1,iceRestart:!1};this._isResumedSession=!1,this.createOffer(this._peerConnection,p).then(this.createdDescription.bind(this)).catch(this._sessionError.bind(this))}}else if("accepted"===c){this._connectionState.setConnectionState(q.ConnectingToDigitalPerson),this.log("accepted, session_id = ".concat(u.sessionId)),this._sessionId=u.sessionId,this._resumeRequested=u.resumeRequested,this._server=u.server,this._sceneId=u.sceneId;for(var f=0;f<this._outgoingQueue.length;f++)this._outgoingQueue[f].body.sessionId=this._sessionId,this.sendMessage(this._outgoingQueue[f]);this._outgoingQueue=[];var h=function(){o&&o.sendCameraRotation()};window.addEventListener("orientationchange",h),this._removeListeners.push({target:window,name:"orientationchange",callback:h}),this.sendCameraRotation();var d=(document.defaultView||window).getComputedStyle(this._videoElement),_=parseInt("".concat(d.width),10),v=parseInt("".concat(d.height),10);this.log("accepted, sending video width/height: ".concat(_," / ").concat(v)),this.sendVideoBounds(_,v),this.sendlogMessage(this._pendingLog),this._pendingLog=[],u.controlUrl&&(this._controlUrl=u.controlUrl,this._controlQueue=[],this._controlOpen=!1,this._controlConnection=new WebSocket(u.controlUrl+"?access_token="+this._accessToken),this._controlConnection.onmessage=function(e){var t=e.data;t&&o._serverConnection.readyState===WebSocket.OPEN&&o._serverConnection.send(t)},this._controlConnection.onerror=function(){o.close(!0,"controlFailed",t)},this._controlConnection.onopen=function(e){if(o.log("control websocket open"),!o._controlOpen){o._controlOpen=!0;for(var t=0;t<o._controlQueue.length;t++)o.log("control websocket now open, forwarding queued message: ".concat(o._controlQueue[t])),o._controlConnection.send(o._controlQueue[t]);o._controlQueue=[]}},this._controlConnection.onclose=function(e){o.log("control closed: code(".concat(e.code,"), reason(").concat(e.reason,"), clean(").concat(e.wasClean,")")),o.close(!0,"controlDisconnected",t)})}else if("answer"===c){this.log("set remote description"),this.log(JSON.stringify(u));var y={sdp:u.sdp,type:"answer"};this.setRemoteDescription(this._peerConnection,y).then((function(){})).catch(this._sessionError.bind(this))}else if("connected"===c)this._remoteStream?(this._connectionState.setConnectionState(q.Connected),this.onConnectedSuccess(),t&&t.resolve(u.sessionId)):(this.log("Connected but no remote media stream available"),this._connectPendingRemoteStream=function(){o.onConnectedSuccess(),t&&t.resolve(u.sessionId)});else if("ice"===c){this.log("add ice candidate");var g=void 0;if(u.complete)this._features.isEdge&&(g=this._peerConnection.addIceCandidate(new RTCIceCandidate({candidate:"",sdpMid:"",sdpMLineIndex:0})));else{var m=new RTCIceCandidate({candidate:u.candidate,sdpMid:u.sdpMid,sdpMLineIndex:u.sdpMLineIndex});g=this._peerConnection.addIceCandidate(m)}g&&g.catch(this._sessionError.bind(this))}else if("offer"===c){this._sessionId=u.sessionId;y={sdp:u.sdp,type:"offer"};this.setRemoteDescription(this._peerConnection,y).then((function(){return o.createAnswer(o._peerConnection)})).then(this.createdDescription.bind(this)).catch(this._sessionError.bind(this))}else"userText"===c?(this.log("rtc - user text message received: ".concat(u.userText)),this._onUserText(u.userText)):"close"===c&&this.close(!1,u.reason,t)},e.prototype.gotIceCandidate=function(e){e.candidate?(this.log("got local ice candidate"),this.sendRtcEvent("ice",{complete:!1,candidate:e.candidate.candidate,sdpMid:e.candidate.sdpMid,sdpMLineIndex:e.candidate.sdpMLineIndex})):(this.log("end ice candidate"),this.sendRtcEvent("ice",{complete:!0,candidate:"",sdpMid:"",sdpMLineIndex:0}))},e.prototype.createdDescription=function(e,t){var n=this;void 0===t&&(t="offer"),this.log("got description");var r={sdp:e.sdp,type:e.type};this.log(JSON.stringify({sdp:r})),this.setLocalDescription(this._peerConnection,e).then((function(){n.log("send sdp offer to server"),n.sendRtcEvent(t,{sdp:n._peerConnection.localDescription?n._peerConnection.localDescription.sdp:null,type:n._peerConnection.localDescription?n._peerConnection.localDescription.type:null,user_text:n._connectUserText,features:{videoStartedEvent:!0}})})).catch(this._sessionError.bind(this))},e.prototype.onRemoteStream=function(e){this.log("got remote stream"),this._remoteStream=e,this.log("ICE connection state: ".concat(this._peerConnection.iceConnectionState)),this._connectPendingRemoteStream&&(this._connectPendingRemoteStream(),this._connectPendingRemoteStream=null)},e.prototype.onConnectedSuccess=function(){var e,t,n=this;this._onConnected(this._resumeRequested,this._isResumedSession,this._server,this.sessionId),this._videoElement.hidden=!1,this._videoElement.srcObject=this._remoteStream;var r=function(e){return M(n,void 0,void 0,(function(){return I(this,(function(t){return this._remoteStream&&this._remoteStream.addTrack(e.track),[2]}))}))};this._peerConnection.addEventListener("track",r),this._removeListeners.push({target:this._peerConnection,name:"track",callback:r}),this.log("video enabled"),this.sendUserCamera(),null===(e=this._onMicrophoneActive)||void 0===e||e.call(this.isMicrophoneActive()),null===(t=this._onCameraActive)||void 0===t||t.call(this.isCameraActive())},e.prototype.onVideoLoaded=function(e){var t=this;this.log("video has loaded");var n=function(){t.log("video has started playing"),t.sendRtcEvent("videoStarted",{}),t.microphoneMuted=!1};if(this._videoElement.muted){var r=function(){n(),t._videoElement.removeEventListener("volumechange",r)};this._videoElement.addEventListener("volumechange",r,!1)}else n()},e.prototype.sendRtcEvent=function(e,t){if(null!==this._serverConnection){this._sessionId&&(t.sessionId=this._sessionId);var n={category:"webrtc",kind:"event",name:e,body:t};this._sessionId||"offer"===e?this.sendMessage(n):this._outgoingQueue.push(n)}},e.prototype.sendVideoBounds=function(e,t){this.sendRtcEvent("videoBounds",{width:e,height:t})},e.prototype.sendUserCamera=function(e){var t={active:this.isCameraActive()};void 0!==e&&(t.rotation=e),this.sendRtcEvent("userCamera",t)},e.prototype.sendCameraRotation=function(){if(this._features.isIos){var e=window.orientation;this.log("send updated camera rotation, device orientation: ".concat(e));var t=0;0===e?t=90:90===e?t=180:180===e?t=270:-90===e&&(t=0),this.sendUserCamera(t)}},e.prototype.sendMessage=function(e){this._serverConnection&&(this._serverConnection.readyState===WebSocket.OPEN?this._serverConnection.send(JSON.stringify(e)):this.log("server connection not ready, discarding message: ".concat(e)))},e.prototype.sendUserText=function(e){this.sendRtcEvent("userText",{userText:e})},e.prototype.hasCamera=function(e){return e===z.Camera||e===z.MicrophoneAndCamera},e.prototype.hasMicrophone=function(e){return e===z.Microphone||e===z.MicrophoneAndCamera},e.prototype.makeUserMedia=function(e,t){return e&&t?z.MicrophoneAndCamera:e?z.Microphone:t?z.Camera:z.None},e.prototype.findSenderTrackByKind=function(e){var t,n,r;if(!this._peerConnection)return null;var o=this._peerConnection.getSenders();try{for(var i=N(o),a=i.next();!a.done;a=i.next()){var s=a.value;if(s.track&&(null===(r=s.track)||void 0===r?void 0:r.kind)===e)return s.track}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return null},e.prototype.findSenderByKind=function(e){var t,n,r,o,i,a;if(!this._peerConnection)return null;try{for(var s=N(this._peerConnection.getTransceivers()),c=s.next();!c.done;c=s.next()){var u=c.value;if("sendrecv"===u.direction&&(null===(a=null===(i=u.receiver)||void 0===i?void 0:i.track)||void 0===a?void 0:a.kind)===e)return u.sender}}catch(e){t={error:e}}finally{try{c&&!c.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}try{for(var l=N(this._peerConnection.getSenders()),p=l.next();!p.done;p=l.next()){var f=p.value;if(null===f.track||f.track.kind===e)return f}}catch(e){r={error:e}}finally{try{p&&!p.done&&(o=l.return)&&o.call(l)}finally{if(r)throw r.error}}return null},e.prototype.processChangeUserMediaQueue=function(){var e,t,n,r;return M(this,void 0,void 0,(function(){var o,i,a,s;return I(this,(function(c){switch(c.label){case 0:if(!(o=this._changeUserMediaQueue.length>0?this._changeUserMediaQueue[0]:void 0))return[3,5];c.label=1;case 1:return c.trys.push([1,3,,4]),i=this.isMicrophoneActive(),a=this.isCameraActive(),[4,this.changeUserMediaInternal(this.makeUserMedia(null!==(e=o.microphone)&&void 0!==e?e:i,null!==(t=o.camera)&&void 0!==t?t:a))];case 2:return c.sent(),void 0!==o.microphone&&o.microphone!==i&&(null===(n=this._onMicrophoneActive)||void 0===n||n.call(this.isMicrophoneActive())),void 0!==o.camera&&o.camera!==a&&(null===(r=this._onCameraActive)||void 0===r||r.call(this.isCameraActive())),o.deferred.resolve(),[3,4];case 3:return s=c.sent(),o.deferred.reject(s),[3,4];case 4:this._changeUserMediaQueue.shift(),c.label=5;case 5:if(o)return[3,0];c.label=6;case 6:return[2]}}))}))},e.prototype.changeUserMediaInternal=function(e){return M(this,void 0,Promise,(function(){var t,n,r,o,i,a,s,c=this;return I(this,(function(u){switch(u.label){case 0:return t=this.findSenderTrackByKind("audio"),n=this.findSenderTrackByKind("video"),r=this.hasMicrophone(e)&&(!t||"ended"===t.readyState),o=this.hasCamera(e)&&(!n||"ended"===n.readyState),i=null,r||o?(a=this.makeUserMedia(r,o),s=new U,this.selectUserMedia(a,a,s,(function(e,t){return M(c,void 0,void 0,(function(){return I(this,(function(n){return i=e,t.resolve(),[2]}))}))})),[4,s.promise]):[3,2];case 1:u.sent(),this._localStream||(this._localStream=new MediaStream),u.label=2;case 2:return[4,this.updateSenderTrack("audio",this.hasMicrophone(e),i)];case 3:return u.sent(),[4,this.updateSenderTrack("video",this.hasCamera(e),i)];case 4:return u.sent(),this.sendUserCamera(),[2]}}))}))},e.prototype.updateSenderTrack=function(e,t,n){var r,o;return M(this,void 0,Promise,(function(){var i,a,s,c;return I(this,(function(u){switch(u.label){case 0:if(i=this.findSenderByKind(e),a=null==i?void 0:i.track,!i||a&&t===a.enabled)return[3,7];if(this.log("new user "+e+" active state = "+t),!t)return[3,6];u.label=1;case 1:return u.trys.push([1,4,,5]),a&&(null===(r=this._localStream)||void 0===r||r.removeTrack(a)),n?(s=this.getTrackByKind(n,e))?(null===(o=this._localStream)||void 0===o||o.addTrack(s),i.track===s?[3,3]:(this.log("replacing user "+e+" track"),[4,i.replaceTrack(s)])):[3,3]:[3,3];case 2:u.sent(),u.label=3;case 3:return[3,5];case 4:throw c=u.sent(),this.log("failed to get user ".concat(e," track, error: ").concat(c),"error"),V("failed to get user "+e+": "+c,"failedUpgrade");case 5:return[3,7];case 6:a&&(a.enabled=!1,a.stop()),u.label=7;case 7:return[2]}}))}))},e.prototype.getTrackByKind=function(e,t){var n,r;if(e)try{for(var o=N(e.getTracks()),i=o.next();!i.done;i=o.next()){var a=i.value;if(a.kind===t)return a}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}},e.prototype.isSenderTrackEnabled=function(e){var t=this.findSenderTrackByKind(e);return Boolean(null==t?void 0:t.enabled)},e.prototype.isMicrophoneActive=function(){return this.isSenderTrackEnabled("audio")},e.prototype.isCameraActive=function(){return this.isSenderTrackEnabled("video")},e.prototype.setMediaDeviceActive=function(e){var t=e.microphone,n=e.camera;return M(this,void 0,Promise,(function(){var e;return I(this,(function(r){return e=new U,this._changeUserMediaQueue.push({microphone:t,camera:n,deferred:e}),1===this._changeUserMediaQueue.length&&this.processChangeUserMediaQueue(),[2,e.promise]}))}))},e.prototype.close=function(e,t,n){var r,o;if(void 0===e&&(e=!0),void 0===t&&(t="normal"),!this._closed){if(this._closed=!0,this._peerConnection)try{this._peerConnection.close()}catch(e){this.log("error: ".concat(e),"error")}if(this._localStream)try{var i=this._localStream.getTracks();for(var a in i)i[a].stop()}catch(e){this.log("error: ".concat(e),"error")}e&&this.sendRtcEvent("close",{reason:"normal"}),n&&(n.isResolved()?this._onClose(t):n.reject(V("websocket closed: "+t,t))),this._serverConnection&&(this.log("closing server connection"),this._serverConnection.close()),this._controlConnection&&this._controlConnection.close();try{for(var s=N(this._removeListeners),c=s.next();!c.done;c=s.next()){var u=c.value;u.target.removeEventListener(u.name,u.callback)}}catch(e){r={error:e}}finally{try{c&&!c.done&&(o=s.return)&&o.call(s)}finally{if(r)throw r.error}}}},e.prototype.createOffer=function(e,t){return e.createOffer(t)},e.prototype.setRemoteDescription=function(e,t){return e.setRemoteDescription(t)},e.prototype.setLocalDescription=function(e,t){return e.setLocalDescription(t)},e.prototype.createAnswer=function(e){return e.createAnswer()},Object.defineProperty(e.prototype,"peerConnection",{get:function(){return this._peerConnection},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"serverConnection",{get:function(){return this._serverConnection},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sessionId",{get:function(){return this._sessionId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"server",{get:function(){return this._server},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sceneId",{get:function(){return this._sceneId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isMicrophoneConnected",{get:function(){return!!this.findSenderTrackByKind("audio")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCameraConnected",{get:function(){return!!this.findSenderTrackByKind("video")},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"features",{get:function(){return this._features},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"microphoneMuteDelay",{get:function(){return this._microphoneMuteDelay},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"userMediaStream",{get:function(){return this._localStream},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"microphoneMuted",{get:function(){if(!this._localStream)return!0;var e=this._localStream.getAudioTracks();return!e||e.length<1||!e[0].enabled},set:function(e){var t,n;if(this._localStream){var r=this._localStream.getAudioTracks();if(r&&!(r.length<1)){var o=this.findSenderByKind("audio");if("live"===(null===(t=null==o?void 0:o.track)||void 0===t?void 0:t.readyState)&&o.track===r[0]){var i=!e;r[0].enabled=i,this.log("microphone muted active notification: ".concat(i)),null===(n=this._onMicrophoneActive)||void 0===n||n.call(i)}}}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"webcamMuted",{get:function(){if(!this._localStream)return!0;var e=this._localStream.getVideoTracks();return!e||e.length<1||!e[0].enabled},set:function(e){var t,n;if(this._localStream){var r=this._localStream.getVideoTracks();if(r&&!(r.length<1)){var o=this.findSenderByKind("video");if("live"===(null===(t=null==o?void 0:o.track)||void 0===t?void 0:t.readyState)&&o.track===r[0]){var i=!e;r[0].enabled=i,null===(n=this._onCameraActive)||void 0===n||n.call(i)}}}},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offsetX",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offsetY",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"microphoneActiveCallbacks",{set:function(e){this._onMicrophoneActive=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"cameraActiveCallbacks",{set:function(e){this._onCameraActive=e},enumerable:!1,configurable:!0}),e}(),Z=function(){function e(e,t,n){void 0===n&&(n=new B);var r=this;this.logger=n,this._outgoingQueue=[],this._onConnectedStorage=function(e,t,n,r){},this._pendingLog=[],this._closed=!1,this._shouldLogToServer=!1,this._serverUri=e,this._accessToken=t,this._onClose=function(e){},this._onMessage=function(e){},this._sessionError=function(e){r.logger.log("error","session error: ".concat(e))},this._features=new D}return Object.defineProperty(e.prototype,"onConnected",{set:function(e){this._onConnectedStorage=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onClose",{set:function(e){this._onClose=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMessage",{set:function(e){this._onMessage=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"loggingEnabled",{get:function(){return this.logger.isEnabled},set:function(e){this.logger.log("warn","loggingEnabled is deprecated and will be removed in a future version. Please use setLogging(boolean)"),this.logger.enableLogging(e)},enumerable:!1,configurable:!0}),e.prototype.setMinLogLevel=function(e){this.logger.setMinLogLevel(e)},e.prototype.setLogging=function(e){this.logger.enableLogging(e)},e.prototype.log=function(e){this.loggingEnabled&&(this._shouldLogToServer?this.logToServer(e):this.logger.log("log",e))},e.prototype.logToServer=function(e){this.sessionId?this.sendlogMessage([e]):this._pendingLog.push(e)},e.prototype.sendlogMessage=function(e){if(this._sessionId&&e&&e.length>0){var t={category:"diagnostics",kind:"event",name:"log",body:{name:"browser",text:e}};this.sendMessage(t)}},e.prototype.connect=function(){return M(this,void 0,Promise,(function(){var e;return I(this,(function(t){return e=new U,this._closed=!1,this._serverUri&&(this._serverUri.startsWith("ws:")||this._serverUri.startsWith("wss:"))&&this.connectByWebSocket(e),[2,e.promise]}))}))},e.prototype.connectByWebSocket=function(e){var t=this;this.log("connecting to: ".concat(this._serverUri)),this._accessToken?this._serverConnection=new WebSocket(this._serverUri+"?access_token="+this._accessToken):this._serverConnection=new WebSocket(this._serverUri),this._serverConnection.onmessage=function(n){t.gotMessageFromServer(n,e)},this._serverConnection.onerror=function(t){e.isPending()&&e.reject(V("websocket failed","serverConnectionFailed"))},this._serverConnection.onopen=function(n){t.log("websocket open"),e.resolve()},this._serverConnection.onclose=function(n){t.log("websocket closed: code(".concat(n.code,"), reason(").concat(n.reason,"), clean(").concat(n.wasClean,")")),e.isRejected||t.close(!1,"normal",e)}},e.prototype.gotMessageFromServer=function(e,t){var n=e.data;this.log("message received: ".concat(n));var r=JSON.parse(n),o=r.category,i=r.name,a=r.body;if("webrtc"===o){if("event"===r.kind)if("accepted"===i){this.log("accepted, session_id = ".concat(a.sessionId)),this._sessionId=a.sessionId;for(var s=0;s<this._outgoingQueue.length;s++)this._outgoingQueue[s].body.sessionId=this._sessionId,this.sendMessage(this._outgoingQueue[s]);this._outgoingQueue=[],this.sendlogMessage(this._pendingLog),this._pendingLog=[]}else"close"===i&&this.close(!1,a.reason,t)}else this._onMessage(r)},e.prototype.sendMessage=function(e){this._serverConnection&&(this._serverConnection.readyState===WebSocket.OPEN?this._serverConnection.send(JSON.stringify(e)):this.log("not ready, discarding message: ".concat(e)))},e.prototype.close=function(e,t,n){void 0===e&&(e=!0),void 0===t&&(t="normal"),this._closed||(this._closed=!0,n&&(n.isResolved()?this._onClose(t):n.reject(V("websocket closed: "+t,t))),this._serverConnection&&(this.log("closing server connection"),this._serverConnection.close()))},Object.defineProperty(e.prototype,"serverConnection",{get:function(){return this._serverConnection},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"sessionId",{get:function(){return this._sessionId},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"peerConnection",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"features",{get:function(){return this._features},enumerable:!1,configurable:!0}),e.prototype.sendRtcEvent=function(e,t){},e.prototype.sendVideoBounds=function(e,t){},e.prototype.sendUserText=function(e){this.logger.log("error","WebSocketSession discarding text: "+e)},Object.defineProperty(e.prototype,"microphoneMuteDelay",{get:function(){},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"microphoneMuted",{get:function(){return null},set:function(e){},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onUserText",{set:function(e){},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isMicrophoneConnected",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCameraConnected",{get:function(){return null},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offsetX",{get:function(){return 0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"offsetY",{get:function(){return 0},enumerable:!1,configurable:!0}),e.prototype.isMicrophoneActive=function(){return!1},e.prototype.isCameraActive=function(){return!1},e.prototype.setMediaDeviceActive=function(e){e.microphone,e.camera;return M(this,void 0,Promise,(function(){return I(this,(function(e){throw V("setMediaDeviceActive not supported on WebSocketSession","notSupported")}))}))},e}();!function(e){e.Scene="scene"}(W||(W={})),function(e){e.Response="response",e.Request="request"}(J||(J={})),function(e){e.Idle="idle",e.Animating="animating",e.Speaking="speaking"}(Q||(Q={}));var $,ee=[],te="ResizeObserver loop completed with undelivered notifications.";!function(e){e.BORDER_BOX="border-box",e.CONTENT_BOX="content-box",e.DEVICE_PIXEL_CONTENT_BOX="device-pixel-content-box"}($||($={}));var ne,re=function(e){return Object.freeze(e)},oe=function(e,t){this.inlineSize=e,this.blockSize=t,re(this)},ie=function(){function e(e,t,n,r){return this.x=e,this.y=t,this.width=n,this.height=r,this.top=this.y,this.left=this.x,this.bottom=this.top+this.height,this.right=this.left+this.width,re(this)}return e.prototype.toJSON=function(){var e=this;return{x:e.x,y:e.y,top:e.top,right:e.right,bottom:e.bottom,left:e.left,width:e.width,height:e.height}},e.fromRect=function(t){return new e(t.x,t.y,t.width,t.height)},e}(),ae=function(e){return e instanceof SVGElement&&"getBBox"in e},se=function(e){if(ae(e)){var t=e.getBBox(),n=t.width,r=t.height;return!n&&!r}var o=e,i=o.offsetWidth,a=o.offsetHeight;return!(i||a||e.getClientRects().length)},ce=function(e){var t;if(e instanceof Element)return!0;var n=null===(t=null==e?void 0:e.ownerDocument)||void 0===t?void 0:t.defaultView;return!!(n&&e instanceof n.Element)},ue="undefined"!=typeof window?window:{},le=new WeakMap,pe=/auto|scroll/,fe=/^tb|vertical/,he=/msie|trident/i.test(ue.navigator&&ue.navigator.userAgent),de=function(e){return parseFloat(e||"0")},_e=function(e,t,n){return void 0===e&&(e=0),void 0===t&&(t=0),void 0===n&&(n=!1),new oe((n?t:e)||0,(n?e:t)||0)},ve=re({devicePixelContentBoxSize:_e(),borderBoxSize:_e(),contentBoxSize:_e(),contentRect:new ie(0,0,0,0)}),ye=function(e,t){if(void 0===t&&(t=!1),le.has(e)&&!t)return le.get(e);if(se(e))return le.set(e,ve),ve;var n=getComputedStyle(e),r=ae(e)&&e.ownerSVGElement&&e.getBBox(),o=!he&&"border-box"===n.boxSizing,i=fe.test(n.writingMode||""),a=!r&&pe.test(n.overflowY||""),s=!r&&pe.test(n.overflowX||""),c=r?0:de(n.paddingTop),u=r?0:de(n.paddingRight),l=r?0:de(n.paddingBottom),p=r?0:de(n.paddingLeft),f=r?0:de(n.borderTopWidth),h=r?0:de(n.borderRightWidth),d=r?0:de(n.borderBottomWidth),_=p+u,v=c+l,y=(r?0:de(n.borderLeftWidth))+h,g=f+d,m=s?e.offsetHeight-g-e.clientHeight:0,E=a?e.offsetWidth-y-e.clientWidth:0,T=o?_+y:0,S=o?v+g:0,b=r?r.width:de(n.width)-T-E,O=r?r.height:de(n.height)-S-m,R=b+_+E+y,w=O+v+m+g,C=re({devicePixelContentBoxSize:_e(Math.round(b*devicePixelRatio),Math.round(O*devicePixelRatio),i),borderBoxSize:_e(R,w,i),contentBoxSize:_e(b,O,i),contentRect:new ie(p,c,b,O)});return le.set(e,C),C},ge=function(e,t,n){var r=ye(e,n),o=r.borderBoxSize,i=r.contentBoxSize,a=r.devicePixelContentBoxSize;switch(t){case $.DEVICE_PIXEL_CONTENT_BOX:return a;case $.BORDER_BOX:return o;default:return i}},me=function(e){var t=ye(e);this.target=e,this.contentRect=t.contentRect,this.borderBoxSize=re([t.borderBoxSize]),this.contentBoxSize=re([t.contentBoxSize]),this.devicePixelContentBoxSize=re([t.devicePixelContentBoxSize])},Ee=function(e){if(se(e))return 1/0;for(var t=0,n=e.parentNode;n;)t+=1,n=n.parentNode;return t},Te=function(){var e=1/0,t=[];ee.forEach((function(n){if(0!==n.activeTargets.length){var r=[];n.activeTargets.forEach((function(t){var n=new me(t.target),o=Ee(t.target);r.push(n),t.lastReportedSize=ge(t.target,t.observedBox),o<e&&(e=o)})),t.push((function(){n.callback.call(n.observer,r,n.observer)})),n.activeTargets.splice(0,n.activeTargets.length)}}));for(var n=0,r=t;n<r.length;n++){(0,r[n])()}return e},Se=function(e){ee.forEach((function(t){t.activeTargets.splice(0,t.activeTargets.length),t.skippedTargets.splice(0,t.skippedTargets.length),t.observationTargets.forEach((function(n){n.isActive()&&(Ee(n.target)>e?t.activeTargets.push(n):t.skippedTargets.push(n))}))}))},be=function(){var e,t=0;for(Se(t);ee.some((function(e){return e.activeTargets.length>0}));)t=Te(),Se(t);return ee.some((function(e){return e.skippedTargets.length>0}))&&("function"==typeof ErrorEvent?e=new ErrorEvent("error",{message:te}):((e=document.createEvent("Event")).initEvent("error",!1,!1),e.message=te),window.dispatchEvent(e)),t>0},Oe=[],Re=function(e){if(!ne){var t=0,n=document.createTextNode("");new MutationObserver((function(){return Oe.splice(0).forEach((function(e){return e()}))})).observe(n,{characterData:!0}),ne=function(){n.textContent="".concat(t?t--:t++)}}Oe.push(e),ne()},we=0,Ce={attributes:!0,characterData:!0,childList:!0,subtree:!0},Pe=["resize","load","transitionend","animationend","animationstart","animationiteration","keyup","keydown","mouseup","mousedown","mouseover","mouseout","blur","focus"],Ae=function(e){return void 0===e&&(e=0),Date.now()+e},Le=!1,Me=new(function(){function e(){var e=this;this.stopped=!0,this.listener=function(){return e.schedule()}}return e.prototype.run=function(e){var t=this;if(void 0===e&&(e=250),!Le){Le=!0;var n,r=Ae(e);n=function(){var n=!1;try{n=be()}finally{if(Le=!1,e=r-Ae(),!we)return;n?t.run(1e3):e>0?t.run(e):t.start()}},Re((function(){requestAnimationFrame(n)}))}},e.prototype.schedule=function(){this.stop(),this.run()},e.prototype.observe=function(){var e=this,t=function(){return e.observer&&e.observer.observe(document.body,Ce)};document.body?t():ue.addEventListener("DOMContentLoaded",t)},e.prototype.start=function(){var e=this;this.stopped&&(this.stopped=!1,this.observer=new MutationObserver(this.listener),this.observe(),Pe.forEach((function(t){return ue.addEventListener(t,e.listener,!0)})))},e.prototype.stop=function(){var e=this;this.stopped||(this.observer&&this.observer.disconnect(),Pe.forEach((function(t){return ue.removeEventListener(t,e.listener,!0)})),this.stopped=!0)},e}()),Ie=function(e){!we&&e>0&&Me.start(),!(we+=e)&&Me.stop()},Ne=function(){function e(e,t){this.target=e,this.observedBox=t||$.CONTENT_BOX,this.lastReportedSize={inlineSize:0,blockSize:0}}return e.prototype.isActive=function(){var e,t=ge(this.target,this.observedBox,!0);return e=this.target,ae(e)||function(e){switch(e.tagName){case"INPUT":if("image"!==e.type)break;case"VIDEO":case"AUDIO":case"EMBED":case"OBJECT":case"CANVAS":case"IFRAME":case"IMG":return!0}return!1}(e)||"inline"!==getComputedStyle(e).display||(this.lastReportedSize=t),this.lastReportedSize.inlineSize!==t.inlineSize||this.lastReportedSize.blockSize!==t.blockSize},e}(),xe=function(e,t){this.activeTargets=[],this.skippedTargets=[],this.observationTargets=[],this.observer=e,this.callback=t},ke=new WeakMap,Ue=function(e,t){for(var n=0;n<e.length;n+=1)if(e[n].target===t)return n;return-1},De=function(){function e(){}return e.connect=function(e,t){var n=new xe(e,t);ke.set(e,n)},e.observe=function(e,t,n){var r=ke.get(e),o=0===r.observationTargets.length;Ue(r.observationTargets,t)<0&&(o&&ee.push(r),r.observationTargets.push(new Ne(t,n&&n.box)),Ie(1),Me.schedule())},e.unobserve=function(e,t){var n=ke.get(e),r=Ue(n.observationTargets,t),o=1===n.observationTargets.length;r>=0&&(o&&ee.splice(ee.indexOf(n),1),n.observationTargets.splice(r,1),Ie(-1))},e.disconnect=function(e){var t=this,n=ke.get(e);n.observationTargets.slice().forEach((function(n){return t.unobserve(e,n.target)})),n.activeTargets.splice(0,n.activeTargets.length)},e}(),je=function(){function e(e){if(0===arguments.length)throw new TypeError("Failed to construct 'ResizeObserver': 1 argument required, but only 0 present.");if("function"!=typeof e)throw new TypeError("Failed to construct 'ResizeObserver': The callback provided as parameter 1 is not a function.");De.connect(this,e)}return e.prototype.observe=function(e,t){if(0===arguments.length)throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!ce(e))throw new TypeError("Failed to execute 'observe' on 'ResizeObserver': parameter 1 is not of type 'Element");De.observe(this,e,t)},e.prototype.unobserve=function(e){if(0===arguments.length)throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': 1 argument required, but only 0 present.");if(!ce(e))throw new TypeError("Failed to execute 'unobserve' on 'ResizeObserver': parameter 1 is not of type 'Element");De.unobserve(this,e)},e.prototype.disconnect=function(){De.disconnect(this)},e.toString=function(){return"function ResizeObserver () { [polyfill code] }"},e}();const Be=function(){return Promise.all(Array.from(document.images).filter((function(e){return!e.complete})).map((function(e){return new Promise((function(t){e.onload=t,e.onerror=t}))})))};var Ve=function(){function e(e,t,n){void 0===t&&(t=300),void 0===n&&(n=new B);var r=this;this.scene=e,this.debounceTime=t,this.logger=n,this.VIDEO_FRAME_STR="data-sm-video",this.VIDEO_FRAME_STR_BRACKETED="[".concat(this.VIDEO_FRAME_STR,"]"),this.CONTENT_STR="data-sm-content",this.CONTENT_STR_BRACKETED="[".concat(this.CONTENT_STR,"]"),this.CUE_ATTRIBUTES=[this.VIDEO_FRAME_STR,this.CONTENT_STR],this.CUE_ATTRIBUTES_BRACKETED=[this.VIDEO_FRAME_STR_BRACKETED,this.CONTENT_STR_BRACKETED].join(),this.RESIZE_OBSERVER_BOX_OPTIONS="border-box",this.callMeasure=!1,this.contentCollection={},this.videoFrame=null,this.debouncedMeasure=function(e,t){void 0===t&&(t=500);var n=-1;return function(){n&&clearTimeout(n),n=setTimeout((function(){return e()}),t)}}((function(){return r.measureInternal()}),t),this.resizeObserver=new je((function(){return r.measureDebounced()})),this.getInitialElements(),this.mutationObserver=new MutationObserver((function(e){return r.mutationCallback(e)})),this.setupEventListeners(),this.observeMutations(),this.measureInternal()}return e.prototype.isLoggingEnabled=function(){return this.logger.isEnabled},e.prototype.setLogging=function(e){this.logger.enableLogging(e)},e.prototype.getMinLogLevel=function(){return this.logger.getMinLogLevel()},e.prototype.setMinLogLevel=function(e){this.logger.setMinLogLevel(e)},e.prototype.setupEventListeners=function(){var e=this;window.addEventListener("resize",(function(){return e.measureDebounced()}))},e.prototype.getInitialElements=function(){var e=this,t=document.querySelector(this.VIDEO_FRAME_STR_BRACKETED),n=document.querySelectorAll(this.CONTENT_STR_BRACKETED);this.trackVideoElement(t),Array.from(n).map((function(t){return e.trackContentElement(t)}))},e.prototype.observeMutations=function(){var e=document.documentElement||document.body;this.mutationObserver.observe(e,{attributeFilter:this.CUE_ATTRIBUTES,attributeOldValue:!0,childList:!0,subtree:!0})},e.prototype.disconnect=function(){var e=this;this.mutationObserver.disconnect(),this.resizeObserver.disconnect(),window.removeEventListener("resize",(function(){return e.measureDebounced()})),this.scene.contentAwareness=void 0},e.prototype.reconnect=function(){this.scene.contentAwareness=this,this.observeMutations(),this.setupEventListeners(),this.measure()},e.prototype.measure=function(){this.measureInternal()},e.prototype.measureDebounced=function(){this.debouncedMeasure()},e.prototype.measureInternal=function(){if(this.scene.isConnected()){var e=this.measureWindow(),t=this.measureVideoFrame(),n=this.measureContent();if(e&&t&&n){var r=this.buildUpdateContentAwarenessRequest(e.innerWidth,e.innerHeight,t,n);this.scene.sendRequest("updateContentAwareness",r)}}else this.logger.log("error","ContentAwareness: Scene does not exist or is not connected yet")},e.prototype.measureVideoFrame=function(){if(!this.videoFrame)return this.logger.log("warn","ContentAwareness: Unable to find a video element"),null;var e=this.videoFrame.getBoundingClientRect();return this.invalidDimensions(e)?(this.logger.log("warn","ContentAwareness: Video has a zero width and height"),null):{x1:Math.round(e.left),x2:Math.round(e.right),y1:Math.round(e.top),y2:Math.round(e.bottom)}},e.prototype.measureContent=function(){var e=this,t=[];return Object.keys(this.contentCollection).map((function(n){var r=e.contentCollection[n].getBoundingClientRect();if(e.invalidDimensions(r)&&e.logger.log("warn","ContentAwareness: Element '".concat(n,"' has a zero width and height")),e.invalidContent(r))return e.logger.log("warn","ContentAwareness: Element '".concat(n,"' is not being tracked")),void delete e.contentCollection[n];t.push({id:n,x1:Math.round(r.left),x2:Math.round(r.right),y1:Math.round(r.top),y2:Math.round(r.bottom)})})),t},e.prototype.invalidDimensions=function(e){return 0===e.width&&0===e.height},e.prototype.invalidContent=function(e){return 0===e.top&&0===e.bottom&&0===e.right&&0===e.left},e.prototype.measureWindow=function(){return{innerHeight:Math.round(window.innerHeight),innerWidth:Math.round(window.innerWidth)}},e.prototype.buildUpdateContentAwarenessRequest=function(e,t,n,r){return{viewWidth:e,viewHeight:t,videoFrame:n,content:r}},e.prototype.trackVideoElement=function(e){e&&(this.videoFrame&&(this.logger.log("warn","ContentAwareness: Already observing a video element, switching to new video element"),this.untrackVideoElement(this.videoFrame)),this.videoFrame=e,this.resizeObserver.observe(this.videoFrame,{box:this.RESIZE_OBSERVER_BOX_OPTIONS}))},e.prototype.trackContentElement=function(e){var t=e.getAttribute(this.CONTENT_STR);return!!t&&(this.contentCollection[t]=e,this.resizeObserver.observe(e,{box:this.RESIZE_OBSERVER_BOX_OPTIONS}),!0)},e.prototype.untrackContentElement=function(e){var t=e.getAttribute(this.CONTENT_STR);e===this.contentCollection[t]&&(delete this.contentCollection[t],this.resizeObserver.unobserve(e))},e.prototype.untrackVideoElement=function(e){e===this.videoFrame&&(this.videoFrame=null),this.resizeObserver.unobserve(e)},e.prototype.mutationCallback=function(e){var t=this,n=!1;this.callMeasure=!1;for(var r=0;r<e.length;++r)switch(e[r].type){case"childList":if(e[r].target.nodeType!==Node.ELEMENT_NODE)break;this.untrackRemovedNodeWithCUE(e[r].removedNodes),this.trackAddedNodeWithCUE(e[r].addedNodes);for(var o=0;o<e[r].addedNodes.length;o++)try{if(!(s=e[r].addedNodes[o]).hasAttribute)continue;var i="IMG"===s.tagName,a=!!s.querySelector("img");if(n=i||a)break}catch(t){this.logger.log("warn","ContentAwareness: Failed to track non-element node",e[r].addedNodes[o])}break;case"attributes":if(e[r].target.nodeType!==Node.ELEMENT_NODE)break;try{var s=e[r].target,c=e[r].attributeName;if(c===this.VIDEO_FRAME_STR)s.hasAttribute(c)?(this.trackVideoElement(s),this.callMeasure=!0):this.videoFrame&&this.untrackVideoElement(s);else if(c===this.CONTENT_STR){var u=s.getAttribute(c),l=e[r].oldValue;l&&(this.resizeObserver.unobserve(this.contentCollection[l]),delete this.contentCollection[l]),u&&(this.contentCollection[u]=s,this.resizeObserver.observe(s,{box:this.RESIZE_OBSERVER_BOX_OPTIONS})),this.callMeasure=!0}break}catch(t){this.logger.log("warn","ContentAwareness: Failed to track non-element node",e[r].target)}}this.callMeasure&&(n?Be().then((function(){t.measureDebounced()})):this.measureDebounced())},e.prototype.trackAddedNodeWithCUE=function(e){var t=this;e.forEach((function(e){try{var n=e;if(!n.hasAttribute)return;n.hasAttribute(t.VIDEO_FRAME_STR)?(t.trackVideoElement(n),t.callMeasure=!0):n.hasAttribute(t.CONTENT_STR)&&(t.callMeasure=t.trackContentElement(n)),null!==n.querySelector(t.CUE_ATTRIBUTES_BRACKETED)&&n.querySelectorAll(t.CUE_ATTRIBUTES_BRACKETED).forEach((function(e){e.hasAttribute(t.VIDEO_FRAME_STR)?(t.trackVideoElement(e),t.callMeasure=!0):e.hasAttribute(t.CONTENT_STR)&&(t.callMeasure=t.trackContentElement(e))}))}catch(n){t.logger.log("warn","ContentAwareness: Failed to track non-element node",e)}}))},e.prototype.untrackRemovedNodeWithCUE=function(e){var t=this;e.forEach((function(e){try{var n=e;if(!n.hasAttribute)return;n.hasAttribute(t.VIDEO_FRAME_STR)?t.untrackVideoElement(n):n.hasAttribute(t.CONTENT_STR)&&(t.untrackContentElement(n),t.callMeasure=!0),null!==n.querySelector(t.CUE_ATTRIBUTES_BRACKETED)&&n.querySelectorAll(t.CUE_ATTRIBUTES_BRACKETED).forEach((function(e){e.hasAttribute(t.VIDEO_FRAME_STR)?t.untrackVideoElement(e):e.hasAttribute(t.CONTENT_STR)&&(t.untrackContentElement(e),t.callMeasure=!0)}))}catch(n){t.logger.log("warn","ContentAwareness: Failed to track non-element node",e)}}))},e}(),Fe="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof e.g?e.g:{},Xe="1.2.0",Ge=/^(\d+)\.(\d+)\.(\d+)(-(.+))?$/;var ze=function(e){var t=new Set([e]),n=new Set,r=e.match(Ge);if(!r)return function(){return!1};var o=+r[1],i=+r[2],a=+r[3];if(null!=r[4])return function(t){return t===e};function s(e){return n.add(e),!1}function c(e){return t.add(e),!0}return function(e){if(t.has(e))return!0;if(n.has(e))return!1;var r=e.match(Ge);if(!r)return s(e);var u=+r[1],l=+r[2],p=+r[3];return null!=r[4]||o!==u?s(e):0===o?i===l&&a<=p?c(e):s(e):i<=l?c(e):s(e)}}(Xe),He=Xe.split(".")[0],qe=Symbol.for("opentelemetry.js.api."+He),Ke=Fe;function We(e,t,n,r){var o;void 0===r&&(r=!1);var i=Ke[qe]=null!==(o=Ke[qe])&&void 0!==o?o:{version:Xe};if(!r&&i[e]){var a=new Error("@opentelemetry/api: Attempted duplicate registration of API: "+e);return n.error(a.stack||a.message),!1}if(i.version!==Xe){a=new Error("@opentelemetry/api: All API registration versions must match");return n.error(a.stack||a.message),!1}return i[e]=t,n.debug("@opentelemetry/api: Registered a global for "+e+" v"+"1.2.0."),!0}function Je(e){var t,n,r=null===(t=Ke[qe])||void 0===t?void 0:t.version;if(r&&ze(r))return null===(n=Ke[qe])||void 0===n?void 0:n[e]}function Qe(e,t){t.debug("@opentelemetry/api: Unregistering a global for "+e+" v"+"1.2.0.");var n=Ke[qe];n&&delete n[e]}var Ye,Ze=function(){function e(e){this._namespace=e.namespace||"DiagComponentLogger"}return e.prototype.debug=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return $e("debug",this._namespace,e)},e.prototype.error=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return $e("error",this._namespace,e)},e.prototype.info=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return $e("info",this._namespace,e)},e.prototype.warn=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return $e("warn",this._namespace,e)},e.prototype.verbose=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];return $e("verbose",this._namespace,e)},e}();function $e(e,t,n){var r=Je("diag");if(r)return n.unshift(t),r[e].apply(r,n)}!function(e){e[e.NONE=0]="NONE",e[e.ERROR=30]="ERROR",e[e.WARN=50]="WARN",e[e.INFO=60]="INFO",e[e.DEBUG=70]="DEBUG",e[e.VERBOSE=80]="VERBOSE",e[e.ALL=9999]="ALL"}(Ye||(Ye={}));var et=function(){function e(){function e(e){return function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];var r=Je("diag");if(r)return r[e].apply(r,t)}}var t=this;t.setLogger=function(e,n){var r,o;if(void 0===n&&(n=Ye.INFO),e===t){var i=new Error("Cannot use diag as the logger for itself. Please use a DiagLogger implementation like ConsoleDiagLogger or a custom implementation");return t.error(null!==(r=i.stack)&&void 0!==r?r:i.message),!1}var a=Je("diag"),s=function(e,t){function n(n,r){var o=t[n];return"function"==typeof o&&e>=r?o.bind(t):function(){}}return e<Ye.NONE?e=Ye.NONE:e>Ye.ALL&&(e=Ye.ALL),t=t||{},{error:n("error",Ye.ERROR),warn:n("warn",Ye.WARN),info:n("info",Ye.INFO),debug:n("debug",Ye.DEBUG),verbose:n("verbose",Ye.VERBOSE)}}(n,e);if(a){var c=null!==(o=(new Error).stack)&&void 0!==o?o:"<failed to generate stacktrace>";a.warn("Current logger will be overwritten from "+c),s.warn("Current logger will overwrite one already registered from "+c)}return We("diag",s,t,!0)},t.disable=function(){Qe("diag",t)},t.createComponentLogger=function(e){return new Ze(e)},t.verbose=e("verbose"),t.debug=e("debug"),t.info=e("info"),t.warn=e("warn"),t.error=e("error")}return e.instance=function(){return this._instance||(this._instance=new e),this._instance},e}(),tt=function(){function e(e){this._entries=e?new Map(e):new Map}return e.prototype.getEntry=function(e){var t=this._entries.get(e);if(t)return Object.assign({},t)},e.prototype.getAllEntries=function(){return Array.from(this._entries.entries()).map((function(e){return[e[0],e[1]]}))},e.prototype.setEntry=function(t,n){var r=new e(this._entries);return r._entries.set(t,n),r},e.prototype.removeEntry=function(t){var n=new e(this._entries);return n._entries.delete(t),n},e.prototype.removeEntries=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=new e(this._entries),o=0,i=t;o<i.length;o++){var a=i[o];r._entries.delete(a)}return r},e.prototype.clear=function(){return new e},e}(),nt=Symbol("BaggageEntryMetadata"),rt=et.instance();function ot(e){return void 0===e&&(e={}),new tt(new Map(Object.entries(e)))}function it(e){return"string"!=typeof e&&(rt.error("Cannot create baggage metadata from unknown type: "+typeof e),e=""),{__TYPE__:nt,toString:function(){return e}}}var at={get:function(e,t){if(null!=e)return e[t]},keys:function(e){return null==e?[]:Object.keys(e)}},st={set:function(e,t,n){null!=e&&(e[t]=n)}};function ct(e){return Symbol.for(e)}var ut,lt=function e(t){var n=this;n._currentContext=t?new Map(t):new Map,n.getValue=function(e){return n._currentContext.get(e)},n.setValue=function(t,r){var o=new e(n._currentContext);return o._currentContext.set(t,r),o},n.deleteValue=function(t){var r=new e(n._currentContext);return r._currentContext.delete(t),r}},pt=new lt,ft=function(e,t){for(var n=0,r=t.length,o=e.length;n<r;n++,o++)e[o]=t[n];return e},ht=function(){function e(){}return e.prototype.active=function(){return pt},e.prototype.with=function(e,t,n){for(var r=[],o=3;o<arguments.length;o++)r[o-3]=arguments[o];return t.call.apply(t,ft([n],r))},e.prototype.bind=function(e,t){return t},e.prototype.enable=function(){return this},e.prototype.disable=function(){return this},e}(),dt=function(e,t){for(var n=0,r=t.length,o=e.length;n<r;n++,o++)e[o]=t[n];return e},_t="context",vt=new ht,yt=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalContextManager=function(e){return We(_t,e,et.instance())},e.prototype.active=function(){return this._getContextManager().active()},e.prototype.with=function(e,t,n){for(var r,o=[],i=3;i<arguments.length;i++)o[i-3]=arguments[i];return(r=this._getContextManager()).with.apply(r,dt([e,t,n],o))},e.prototype.bind=function(e,t){return this._getContextManager().bind(e,t)},e.prototype._getContextManager=function(){return Je(_t)||vt},e.prototype.disable=function(){this._getContextManager().disable(),Qe(_t,et.instance())},e}();!function(e){e[e.NONE=0]="NONE",e[e.SAMPLED=1]="SAMPLED"}(ut||(ut={}));var gt="0000000000000000",mt="00000000000000000000000000000000",Et={traceId:mt,spanId:gt,traceFlags:ut.NONE},Tt=function(){function e(e){void 0===e&&(e=Et),this._spanContext=e}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(e,t){return this},e.prototype.setAttributes=function(e){return this},e.prototype.addEvent=function(e,t){return this},e.prototype.setStatus=function(e){return this},e.prototype.updateName=function(e){return this},e.prototype.end=function(e){},e.prototype.isRecording=function(){return!1},e.prototype.recordException=function(e,t){},e}(),St=ct("OpenTelemetry Context Key SPAN");function bt(e){return e.getValue(St)||void 0}function Ot(){return bt(yt.getInstance().active())}function Rt(e,t){return e.setValue(St,t)}function wt(e){return e.deleteValue(St)}function Ct(e,t){return Rt(e,new Tt(t))}function Pt(e){var t;return null===(t=bt(e))||void 0===t?void 0:t.spanContext()}var At=/^([0-9a-f]{32})$/i,Lt=/^[0-9a-f]{16}$/i;function Mt(e){return At.test(e)&&e!==mt}function It(e){return Mt(e.traceId)&&(t=e.spanId,Lt.test(t)&&t!==gt);var t}function Nt(e){return new Tt(e)}var xt=yt.getInstance(),kt=function(){function e(){}return e.prototype.startSpan=function(e,t,n){if(Boolean(null==t?void 0:t.root))return new Tt;var r,o=n&&Pt(n);return"object"==typeof(r=o)&&"string"==typeof r.spanId&&"string"==typeof r.traceId&&"number"==typeof r.traceFlags&&It(o)?new Tt(o):new Tt},e.prototype.startActiveSpan=function(e,t,n,r){var o,i,a;if(!(arguments.length<2)){2===arguments.length?a=t:3===arguments.length?(o=t,a=n):(o=t,i=n,a=r);var s=null!=i?i:xt.active(),c=this.startSpan(e,o,s),u=Rt(s,c);return xt.with(u,a,void 0,c)}},e}();var Ut,Dt,jt,Bt=new kt,Vt=function(){function e(e,t,n,r){this._provider=e,this.name=t,this.version=n,this.options=r}return e.prototype.startSpan=function(e,t,n){return this._getTracer().startSpan(e,t,n)},e.prototype.startActiveSpan=function(e,t,n,r){var o=this._getTracer();return Reflect.apply(o.startActiveSpan,o,arguments)},e.prototype._getTracer=function(){if(this._delegate)return this._delegate;var e=this._provider.getDelegateTracer(this.name,this.version,this.options);return e?(this._delegate=e,this._delegate):Bt},e}(),Ft=new(function(){function e(){}return e.prototype.getTracer=function(e,t,n){return new kt},e}()),Xt=function(){function e(){}return e.prototype.getTracer=function(e,t,n){var r;return null!==(r=this.getDelegateTracer(e,t,n))&&void 0!==r?r:new Vt(this,e,t,n)},e.prototype.getDelegate=function(){var e;return null!==(e=this._delegate)&&void 0!==e?e:Ft},e.prototype.setDelegate=function(e){this._delegate=e},e.prototype.getDelegateTracer=function(e,t,n){var r;return null===(r=this._delegate)||void 0===r?void 0:r.getTracer(e,t,n)},e}();!function(e){e[e.NOT_RECORD=0]="NOT_RECORD",e[e.RECORD=1]="RECORD",e[e.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}(Ut||(Ut={})),function(e){e[e.INTERNAL=0]="INTERNAL",e[e.SERVER=1]="SERVER",e[e.CLIENT=2]="CLIENT",e[e.PRODUCER=3]="PRODUCER",e[e.CONSUMER=4]="CONSUMER"}(Dt||(Dt={})),function(e){e[e.UNSET=0]="UNSET",e[e.OK=1]="OK",e[e.ERROR=2]="ERROR"}(jt||(jt={}));var Gt=new RegExp("^(?:[a-z][_0-9a-z-*/]{0,255}|[a-z0-9][_0-9a-z-*/]{0,240}@[a-z][_0-9a-z-*/]{0,13})$"),zt=/^[ -~]{0,255}[!-~]$/,Ht=/,|=/;!function(){function e(e){this._internalState=new Map,e&&this._parse(e)}e.prototype.set=function(e,t){var n=this._clone();return n._internalState.has(e)&&n._internalState.delete(e),n._internalState.set(e,t),n},e.prototype.unset=function(e){var t=this._clone();return t._internalState.delete(e),t},e.prototype.get=function(e){return this._internalState.get(e)},e.prototype.serialize=function(){var e=this;return this._keys().reduce((function(t,n){return t.push(n+"="+e.get(n)),t}),[]).join(",")},e.prototype._parse=function(e){e.length>512||(this._internalState=e.split(",").reverse().reduce((function(e,t){var n=t.trim(),r=n.indexOf("=");if(-1!==r){var o=n.slice(0,r),i=n.slice(r+1,t.length);(function(e){return Gt.test(e)})(o)&&function(e){return zt.test(e)&&!Ht.test(e)}(i)&&e.set(o,i)}return e}),new Map),this._internalState.size>32&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,32))))},e.prototype._keys=function(){return Array.from(this._internalState.keys()).reverse()},e.prototype._clone=function(){var t=new e;return t._internalState=new Map(this._internalState),t}}();var qt="trace",Kt=function(){function e(){this._proxyTracerProvider=new Xt,this.wrapSpanContext=Nt,this.isSpanContextValid=It,this.deleteSpan=wt,this.getSpan=bt,this.getActiveSpan=Ot,this.getSpanContext=Pt,this.setSpan=Rt,this.setSpanContext=Ct}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalTracerProvider=function(e){var t=We(qt,this._proxyTracerProvider,et.instance());return t&&this._proxyTracerProvider.setDelegate(e),t},e.prototype.getTracerProvider=function(){return Je(qt)||this._proxyTracerProvider},e.prototype.getTracer=function(e,t){return this.getTracerProvider().getTracer(e,t)},e.prototype.disable=function(){Qe(qt,et.instance()),this._proxyTracerProvider=new Xt},e}(),Wt=function(){function e(){}return e.prototype.inject=function(e,t){},e.prototype.extract=function(e,t){return e},e.prototype.fields=function(){return[]},e}(),Jt=ct("OpenTelemetry Baggage Key");function Qt(e){return e.getValue(Jt)||void 0}function Yt(e,t){return e.setValue(Jt,t)}function Zt(e){return e.deleteValue(Jt)}var $t="propagation",en=new Wt,tn=function(){function e(){this.createBaggage=ot,this.getBaggage=Qt,this.setBaggage=Yt,this.deleteBaggage=Zt}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalPropagator=function(e){return We($t,e,et.instance())},e.prototype.inject=function(e,t,n){return void 0===n&&(n=st),this._getGlobalPropagator().inject(e,t,n)},e.prototype.extract=function(e,t,n){return void 0===n&&(n=at),this._getGlobalPropagator().extract(e,t,n)},e.prototype.fields=function(){return this._getGlobalPropagator().fields()},e.prototype.disable=function(){Qe($t,et.instance())},e.prototype._getGlobalPropagator=function(){return Je($t)||en},e}(),nn=yt.getInstance(),rn=Kt.getInstance(),on=tn.getInstance(),an=et.instance();const sn=function(e,t){return void 0===t&&(t=z.None),e?e.camera&&e.microphone?z.MicrophoneAndCamera:e.camera?z.Camera:e.microphone?z.Microphone:z.None:t};function cn(e){try{if(!e)return;var t=new URL(e);return t.pathname="",t.search="",t.toString()}catch(e){return}}var un;!function(e){e.dpSpeaking="dpSpeaking",e.userSpeaking="userSpeaking",e.dpProcessing="dpProcessing",e.idle="idle"}(un||(un={}));var ln,pn=function(){function e(e){void 0===e&&(e=new B),this.logger=e,this._conversationState=un.idle,this._userActive=!1,this._onConversationStateUpdated=new C}return e.prototype.processStateMessage=function(e){if(e&&e.persona&&Object.keys(e.persona).length>0){var t=Object.keys(e.persona)[0];if(!this._userActive&&e.persona[t].speechState){var n=e.persona[t].speechState;n===Q.Idle?this.setSpeechState(un.idle):n===Q.Speaking&&this.setSpeechState(un.dpSpeaking)}}},e.prototype.processRecognizeResultsMessage=function(e){this._userActive=!0;var t=0!==e.status,n=e.results&&e.results.some((function(e){return e.final}));if(t){var r=void 0!==e.errorMessage?e.errorMessage:"recognizeResults sent back a message with non-zero status but no error message.";this.logger.log("error",r)}else n?this.setSpeechState(un.dpProcessing):this.setSpeechState(un.userSpeaking);this._userActive=!1},e.prototype.setSpeechState=function(e){this._conversationState!==e&&(this._conversationState=e,this._onConversationStateUpdated.call(this._conversationState))},e.prototype.getSpeechState=function(){return this._conversationState},Object.defineProperty(e.prototype,"onConversationStateUpdated",{get:function(){return this._onConversationStateUpdated},enumerable:!1,configurable:!0}),e.prototype.reset=function(){this._userActive=!1,this._conversationState=un.idle,this._onConversationStateUpdated.call(this._conversationState)},e}(),fn=function(){function e(){}return e.prototype.format=function(e){var t,n=null===(t=e.provider.meta.dialogflow)||void 0===t?void 0:t.queryResult.fulfillmentMessages,r=null==n?void 0:n.find((function(e){return Boolean(null==e?void 0:e.payload)}));return r?this.formatLegacyDialogflow(r):this.formatContextData(e.output.context)},e.prototype.formatLegacyDialogflow=function(e){var t=this,n=e.payload.soulmachines;return Object.keys(n).map((function(e){return{id:e,data:L({id:e},t.formatCardData(n[e]))}}))},e.prototype.formatContextData=function(e){var t=this;return this.allowedIds(e).map((function(n){var r=n.replace("public-","");return{id:r,data:L({id:r},t.formatCardData(e[n]))}}))},e.prototype.allowedIds=function(e){return Object.keys(e).filter((function(e){return!0===/public-/.test(e)})).filter((function(e){return!1===/\.original/gm.test(e)}))},e.prototype.formatCardData=function(e){var t="string"==typeof e?JSON.parse(e):e,n=t.component,r=t.type,o=function(e,t){var n={};for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&t.indexOf(r)<0&&(n[r]=e[r]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(r=Object.getOwnPropertySymbols(e);o<r.length;o++)t.indexOf(r[o])<0&&Object.prototype.propertyIsEnumerable.call(e,r[o])&&(n[r[o]]=e[r[o]])}return n}(t,["component","type"]);return L({type:r||n},o)},e}(),hn=function(){function e(e,t,n){void 0===e&&(e=new B),void 0===t&&(t=new pn),void 0===n&&(n=new fn),this.logger=e,this.conversationState=t,this.contentCardFormatter=n,this._onCardChanged=new C,this._autoClearCards=!1,this.cardData=new Map,this.activeCardIds=new Set}return e.prototype.processStateMessage=function(e){this.conversationState.processStateMessage(e)},e.prototype.processRecognizeResultsMessage=function(e){this.conversationState.processRecognizeResultsMessage(e)},Object.defineProperty(e.prototype,"onConversationStateUpdated",{get:function(){return this.conversationState.onConversationStateUpdated},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"autoClearCards",{set:function(e){this._autoClearCards=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onCardChanged",{get:function(){return this._onCardChanged},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"activeCards",{get:function(){var e=this,t=[];return this.activeCardIds.forEach((function(n){var r=e.cardData.get(n);r?t.push(r):e.logger.log("error","card data for ".concat(n," does not exist"))})),t},enumerable:!1,configurable:!0}),e.prototype.onSpeechMarker=function(e){var t=e.arguments;e.name===F.Showcards?this.addActiveCardIds(t):e.name===F.Hidecards&&this.removeActiveCards(t),0===t.length&&e.name===F.Hidecards&&this.clearActiveCards()},e.prototype.onConversationResult=function(e){var t=this,n=this.contentCardFormatter.format(e);this._autoClearCards&&this.clearActiveCards(),n.map((function(e){var n=e.id,r=e.data;t.cardData.set(n,r)}))},e.prototype.reset=function(){this.clearActiveCards(),this.cardData.clear(),this.conversationState.reset()},e.prototype.clearActiveCards=function(){this.activeCardIds.clear(),this.onCardChanged.call(this.activeCards)},e.prototype.addActiveCardIds=function(e){this.activeCardIds=new Set(k(k([],x(this.activeCardIds),!1),x(e),!1)),this.onCardChanged.call(this.activeCards)},e.prototype.removeActiveCards=function(e){var t=this;e.forEach((function(e){return t.activeCardIds.delete(e)})),this.onCardChanged.call(this.activeCards)},e}(),dn=function(){function e(e){var t=this;this.scene=e,this._previousUrl=window.location.href,this._observer=new MutationObserver((function(){return t.observeDocumentChanges()}))}return e.prototype.observeUrlChanges=function(){this._observer.observe(document,{subtree:!0,childList:!0})},e.prototype.disconnect=function(){this._observer.disconnect()},e.prototype.send=function(){var e={personaId:this.scene.currentPersonaId,text:H.PAGE_METADATA,variables:{pageUrl:window.location.href.split("?")[0]},optionalArgs:{}};this.scene.sendRequest("conversationSend",e)},e.prototype.observeDocumentChanges=function(){window.location.href!==this._previousUrl&&(this._previousUrl=window.location.href,this.send())},e}(),_n=Object.keys(q).length,vn=function(){function e(){this._connectionState={name:q.Disconnected,totalSteps:_n,currentStep:0,percentageLoaded:0},this._onConnectionStateUpdated=new C}return e.prototype.setConnectionState=function(e){if(this._connectionState.name!==e){var t=Object.keys(q).indexOf(e),n={name:e,currentStep:t,totalSteps:_n,percentageLoaded:100/(_n-1)*t};this._connectionState=n,this._onConnectionStateUpdated.call(n)}},e.prototype.getConnectionState=function(){return this._connectionState},Object.defineProperty(e.prototype,"onConnectionStateUpdated",{get:function(){return this._onConnectionStateUpdated},enumerable:!1,configurable:!0}),e.prototype.reset=function(){this.setConnectionState(q.Disconnected)},e}(),yn="process.runtime.name",gn="service.name",mn="service.version",En="telemetry.sdk.name",Tn="telemetry.sdk.language",Sn="telemetry.sdk.version",bn=((ln={})[En]="opentelemetry",ln[yn]="browser",ln[Tn]="webjs",ln[Sn]="1.8.0",ln);var On,Rn=function(){function e(e){this.attributes=e}return e.empty=function(){return e.EMPTY},e.default=function(){var t;return new e(((t={})[gn]="unknown_service",t[Tn]=bn[Tn],t[En]=bn[En],t[Sn]=bn[Sn],t))},e.prototype.merge=function(t){return t&&Object.keys(t.attributes).length?new e(Object.assign({},this.attributes,t.attributes)):this},e.EMPTY=new e({}),e}();!function(e){e.AlwaysOff="always_off",e.AlwaysOn="always_on",e.ParentBasedAlwaysOff="parentbased_always_off",e.ParentBasedAlwaysOn="parentbased_always_on",e.ParentBasedTraceIdRatio="parentbased_traceidratio",e.TraceIdRatio="traceidratio"}(On||(On={}));var wn="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof e.g?e.g:{},Cn=["OTEL_BSP_EXPORT_TIMEOUT","OTEL_BSP_MAX_EXPORT_BATCH_SIZE","OTEL_BSP_MAX_QUEUE_SIZE","OTEL_BSP_SCHEDULE_DELAY","OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_EVENT_COUNT_LIMIT","OTEL_SPAN_LINK_COUNT_LIMIT","OTEL_EXPORTER_OTLP_TIMEOUT","OTEL_EXPORTER_OTLP_TRACES_TIMEOUT","OTEL_EXPORTER_OTLP_METRICS_TIMEOUT","OTEL_EXPORTER_JAEGER_AGENT_PORT"];function Pn(e){return Cn.indexOf(e)>-1}var An=["OTEL_NO_PATCH_MODULES","OTEL_PROPAGATORS"];function Ln(e){return An.indexOf(e)>-1}var Mn=1/0,In={CONTAINER_NAME:"",ECS_CONTAINER_METADATA_URI_V4:"",ECS_CONTAINER_METADATA_URI:"",HOSTNAME:"",KUBERNETES_SERVICE_HOST:"",NAMESPACE:"",OTEL_BSP_EXPORT_TIMEOUT:3e4,OTEL_BSP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BSP_MAX_QUEUE_SIZE:2048,OTEL_BSP_SCHEDULE_DELAY:5e3,OTEL_EXPORTER_JAEGER_AGENT_HOST:"",OTEL_EXPORTER_JAEGER_AGENT_PORT:6832,OTEL_EXPORTER_JAEGER_ENDPOINT:"",OTEL_EXPORTER_JAEGER_PASSWORD:"",OTEL_EXPORTER_JAEGER_USER:"",OTEL_EXPORTER_OTLP_ENDPOINT:"",OTEL_EXPORTER_OTLP_TRACES_ENDPOINT:"",OTEL_EXPORTER_OTLP_METRICS_ENDPOINT:"",OTEL_EXPORTER_OTLP_HEADERS:"",OTEL_EXPORTER_OTLP_TRACES_HEADERS:"",OTEL_EXPORTER_OTLP_METRICS_HEADERS:"",OTEL_EXPORTER_OTLP_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_TRACES_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_METRICS_TIMEOUT:1e4,OTEL_EXPORTER_ZIPKIN_ENDPOINT:"http://localhost:9411/api/v2/spans",OTEL_LOG_LEVEL:Ye.INFO,OTEL_NO_PATCH_MODULES:[],OTEL_PROPAGATORS:["tracecontext","baggage"],OTEL_RESOURCE_ATTRIBUTES:"",OTEL_SERVICE_NAME:"",OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT:Mn,OTEL_ATTRIBUTE_COUNT_LIMIT:128,OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT:Mn,OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT:128,OTEL_SPAN_EVENT_COUNT_LIMIT:128,OTEL_SPAN_LINK_COUNT_LIMIT:128,OTEL_TRACES_EXPORTER:"otlp",OTEL_TRACES_SAMPLER:On.ParentBasedAlwaysOn,OTEL_TRACES_SAMPLER_ARG:"",OTEL_EXPORTER_OTLP_INSECURE:"",OTEL_EXPORTER_OTLP_TRACES_INSECURE:"",OTEL_EXPORTER_OTLP_METRICS_INSECURE:"",OTEL_EXPORTER_OTLP_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_COMPRESSION:"",OTEL_EXPORTER_OTLP_TRACES_COMPRESSION:"",OTEL_EXPORTER_OTLP_METRICS_COMPRESSION:"",OTEL_EXPORTER_OTLP_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_TRACES_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_METRICS_PROTOCOL:"http/protobuf",OTEL_EXPORTER_OTLP_METRICS_TEMPORALITY_PREFERENCE:"cumulative"};function Nn(e,t,n,r,o){if(void 0===r&&(r=-1/0),void 0===o&&(o=1/0),void 0!==n[e]){var i=Number(n[e]);isNaN(i)||(t[e]=i<r?r:i>o?o:i)}}function xn(e,t,n,r){void 0===r&&(r=",");var o=n[e];"string"==typeof o&&(t[e]=o.split(r).map((function(e){return e.trim()})))}var kn={ALL:Ye.ALL,VERBOSE:Ye.VERBOSE,DEBUG:Ye.DEBUG,INFO:Ye.INFO,WARN:Ye.WARN,ERROR:Ye.ERROR,NONE:Ye.NONE};function Un(e,t,n){var r=n[e];if("string"==typeof r){var o=kn[r.toUpperCase()];null!=o&&(t[e]=o)}}function Dn(e){var t={};for(var n in In){var r=n;if("OTEL_LOG_LEVEL"===r)Un(r,t,e);else if(Pn(r))Nn(r,t,e);else if(Ln(r))xn(r,t,e);else{var o=e[r];null!=o&&(t[r]=String(o))}}return t}function jn(){var e=Dn(wn);return Object.assign({},In,e)}var Bn,Vn=function(){function e(){var e=this;this._promise=new Promise((function(t,n){e._resolve=t,e._reject=n}))}return Object.defineProperty(e.prototype,"promise",{get:function(){return this._promise},enumerable:!1,configurable:!0}),e.prototype.resolve=function(e){this._resolve(e)},e.prototype.reject=function(e){this._reject(e)},e}(),Fn=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},Xn=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},Gn=function(){function e(e,t){this._callback=e,this._that=t,this._isCalled=!1,this._deferred=new Vn}return Object.defineProperty(e.prototype,"isCalled",{get:function(){return this._isCalled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"promise",{get:function(){return this._deferred.promise},enumerable:!1,configurable:!0}),e.prototype.call=function(){for(var e,t=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];if(!this._isCalled){this._isCalled=!0;try{Promise.resolve((e=this._callback).call.apply(e,Xn([this._that],Fn(n),!1))).then((function(e){return t._deferred.resolve(e)}),(function(e){return t._deferred.reject(e)}))}catch(e){this._deferred.reject(e)}}return this._deferred.promise},e}(),zn=ct("OpenTelemetry SDK Context Key SUPPRESS_TRACING");function Hn(e){return!0===e.getValue(zn)}!function(e){e[e.SUCCESS=0]="SUCCESS",e[e.FAILED=1]="FAILED"}(Bn||(Bn={}));var qn=function(e){an.error(function(e){return"string"==typeof e?e:JSON.stringify(function(e){for(var t={},n=e;null!==n;)Object.getOwnPropertyNames(n).forEach((function(e){if(!t[e]){var r=n[e];r&&(t[e]=String(r))}})),n=Object.getPrototypeOf(n);return t}(e))}(e))};function Kn(e){try{qn(e)}catch(e){}}var Wn,Jn,Qn=function(){function e(e,t){this._exporter=e,this._finishedSpans=[];var n=jn();this._maxExportBatchSize="number"==typeof(null==t?void 0:t.maxExportBatchSize)?t.maxExportBatchSize:n.OTEL_BSP_MAX_EXPORT_BATCH_SIZE,this._maxQueueSize="number"==typeof(null==t?void 0:t.maxQueueSize)?t.maxQueueSize:n.OTEL_BSP_MAX_QUEUE_SIZE,this._scheduledDelayMillis="number"==typeof(null==t?void 0:t.scheduledDelayMillis)?t.scheduledDelayMillis:n.OTEL_BSP_SCHEDULE_DELAY,this._exportTimeoutMillis="number"==typeof(null==t?void 0:t.exportTimeoutMillis)?t.exportTimeoutMillis:n.OTEL_BSP_EXPORT_TIMEOUT,this._shutdownOnce=new Gn(this._shutdown,this),this._maxExportBatchSize>this._maxQueueSize&&(an.warn("BatchSpanProcessor: maxExportBatchSize must be smaller or equal to maxQueueSize, setting maxExportBatchSize to match maxQueueSize"),this._maxExportBatchSize=this._maxQueueSize)}return e.prototype.forceFlush=function(){return this._shutdownOnce.isCalled?this._shutdownOnce.promise:this._flushAll()},e.prototype.onStart=function(e,t){},e.prototype.onEnd=function(e){this._shutdownOnce.isCalled||0!=(e.spanContext().traceFlags&ut.SAMPLED)&&this._addToBuffer(e)},e.prototype.shutdown=function(){return this._shutdownOnce.call()},e.prototype._shutdown=function(){var e=this;return Promise.resolve().then((function(){return e.onShutdown()})).then((function(){return e._flushAll()})).then((function(){return e._exporter.shutdown()}))},e.prototype._addToBuffer=function(e){this._finishedSpans.length>=this._maxQueueSize||(this._finishedSpans.push(e),this._maybeStartTimer())},e.prototype._flushAll=function(){var e=this;return new Promise((function(t,n){for(var r=[],o=0,i=Math.ceil(e._finishedSpans.length/e._maxExportBatchSize);o<i;o++)r.push(e._flushOneBatch());Promise.all(r).then((function(){t()})).catch(n)}))},e.prototype._flushOneBatch=function(){var e=this;return this._clearTimer(),0===this._finishedSpans.length?Promise.resolve():new Promise((function(t,n){var r=setTimeout((function(){n(new Error("Timeout"))}),e._exportTimeoutMillis);nn.with(function(e){return e.setValue(zn,!0)}(nn.active()),(function(){e._exporter.export(e._finishedSpans.splice(0,e._maxExportBatchSize),(function(e){var o;clearTimeout(r),e.code===Bn.SUCCESS?t():n(null!==(o=e.error)&&void 0!==o?o:new Error("BatchSpanProcessor: span export failed"))}))}))}))},e.prototype._maybeStartTimer=function(){var e=this;void 0===this._timer&&(this._timer=setTimeout((function(){e._flushOneBatch().then((function(){e._finishedSpans.length>0&&(e._clearTimer(),e._maybeStartTimer())})).catch((function(e){Kn(e)}))}),this._scheduledDelayMillis),this._timer)},e.prototype._clearTimer=function(){void 0!==this._timer&&(clearTimeout(this._timer),this._timer=void 0)},e}(),Yn=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Zn=function(e){function t(t,n){var r=e.call(this,t,n)||this;return r.onInit(n),r}return Yn(t,e),t.prototype.onInit=function(e){var t=this;!0!==(null==e?void 0:e.disableAutoFlushOnDocumentHide)&&"undefined"!=typeof document&&(this._visibilityChangeListener=function(){"hidden"===document.visibilityState&&t.forceFlush()},this._pageHideListener=function(){t.forceFlush()},document.addEventListener("visibilitychange",this._visibilityChangeListener),document.addEventListener("pagehide",this._pageHideListener))},t.prototype.onShutdown=function(){"undefined"!=typeof document&&(this._visibilityChangeListener&&document.removeEventListener("visibilitychange",this._visibilityChangeListener),this._pageHideListener&&document.removeEventListener("pagehide",this._pageHideListener))},t}(Qn),$n="[object Null]",er="[object Undefined]",tr=Function.prototype.toString,nr=tr.call(Object),rr=(Wn=Object.getPrototypeOf,Jn=Object,function(e){return Wn(Jn(e))}),or=Object.prototype,ir=or.hasOwnProperty,ar=Symbol?Symbol.toStringTag:void 0,sr=or.toString;function cr(e){if(!function(e){return null!=e&&"object"==typeof e}(e)||"[object Object]"!==function(e){if(null==e)return void 0===e?er:$n;return ar&&ar in Object(e)?function(e){var t=ir.call(e,ar),n=e[ar],r=!1;try{e[ar]=void 0,r=!0}catch(e){}var o=sr.call(e);r&&(t?e[ar]=n:delete e[ar]);return o}(e):function(e){return sr.call(e)}(e)}(e))return!1;var t=rr(e);if(null===t)return!0;var n=ir.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&tr.call(n)===nr}function ur(e){return fr(e)?e.slice():e}function lr(e,t,n,r){var o;if(void 0===n&&(n=0),!(n>20)){if(n++,_r(e)||_r(t)||hr(t))o=ur(t);else if(fr(e)){if(o=e.slice(),fr(t))for(var i=0,a=t.length;i<a;i++)o.push(ur(t[i]));else if(dr(t))for(i=0,a=(s=Object.keys(t)).length;i<a;i++){o[c=s[i]]=ur(t[c])}}else if(dr(e))if(dr(t)){if(!function(e,t){if(!cr(e)||!cr(t))return!1;return!0}(e,t))return t;o=Object.assign({},e);var s;for(i=0,a=(s=Object.keys(t)).length;i<a;i++){var c,u=t[c=s[i]];if(_r(u))void 0===u?delete o[c]:o[c]=u;else{var l=o[c],p=u;if(pr(e,c,r)||pr(t,c,r))delete o[c];else{if(dr(l)&&dr(p)){var f=r.get(l)||[],h=r.get(p)||[];f.push({obj:e,key:c}),h.push({obj:t,key:c}),r.set(l,f),r.set(p,h)}o[c]=lr(o[c],u,n,r)}}}}else o=t;return o}}function pr(e,t,n){for(var r=n.get(e[t])||[],o=0,i=r.length;o<i;o++){var a=r[o];if(a.key===t&&a.obj===e)return!0}return!1}function fr(e){return Array.isArray(e)}function hr(e){return"function"==typeof e}function dr(e){return!_r(e)&&!fr(e)&&!hr(e)&&"object"==typeof e}function _r(e){return"string"==typeof e||"number"==typeof e||"boolean"==typeof e||void 0===e||e instanceof Date||e instanceof RegExp||null===e}var vr=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},yr=function(){function e(e){var t;void 0===e&&(e={}),this._propagators=null!==(t=e.propagators)&&void 0!==t?t:[],this._fields=Array.from(new Set(this._propagators.map((function(e){return"function"==typeof e.fields?e.fields():[]})).reduce((function(e,t){return e.concat(t)}),[])))}return e.prototype.inject=function(e,t,n){var r,o;try{for(var i=vr(this._propagators),a=i.next();!a.done;a=i.next()){var s=a.value;try{s.inject(e,t,n)}catch(e){an.warn("Failed to inject with "+s.constructor.name+". Err: "+e.message)}}}catch(e){r={error:e}}finally{try{a&&!a.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}},e.prototype.extract=function(e,t,n){return this._propagators.reduce((function(e,r){try{return r.extract(e,t,n)}catch(e){an.warn("Failed to inject with "+r.constructor.name+". Err: "+e.message)}return e}),e)},e.prototype.fields=function(){return this._fields.slice()},e}(),gr=new RegExp("^(?:[a-z][_0-9a-z-*/]{0,255}|[a-z0-9][_0-9a-z-*/]{0,240}@[a-z][_0-9a-z-*/]{0,13})$"),mr=/^[ -~]{0,255}[!-~]$/,Er=/,|=/;var Tr=function(){function e(e){this._internalState=new Map,e&&this._parse(e)}return e.prototype.set=function(e,t){var n=this._clone();return n._internalState.has(e)&&n._internalState.delete(e),n._internalState.set(e,t),n},e.prototype.unset=function(e){var t=this._clone();return t._internalState.delete(e),t},e.prototype.get=function(e){return this._internalState.get(e)},e.prototype.serialize=function(){var e=this;return this._keys().reduce((function(t,n){return t.push(n+"="+e.get(n)),t}),[]).join(",")},e.prototype._parse=function(e){e.length>512||(this._internalState=e.split(",").reverse().reduce((function(e,t){var n=t.trim(),r=n.indexOf("=");if(-1!==r){var o=n.slice(0,r),i=n.slice(r+1,t.length);(function(e){return gr.test(e)})(o)&&function(e){return mr.test(e)&&!Er.test(e)}(i)&&e.set(o,i)}return e}),new Map),this._internalState.size>32&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,32))))},e.prototype._keys=function(){return Array.from(this._internalState.keys()).reverse()},e.prototype._clone=function(){var t=new e;return t._internalState=new Map(this._internalState),t},e}(),Sr="traceparent",br="tracestate",Or=new RegExp("^\\s?((?!ff)[\\da-f]{2})-((?![0]{32})[\\da-f]{32})-((?![0]{16})[\\da-f]{16})-([\\da-f]{2})(-.*)?\\s?$");var Rr=function(){function e(){}return e.prototype.inject=function(e,t,n){var r=rn.getSpanContext(e);if(r&&!Hn(e)&&It(r)){var o="00-"+r.traceId+"-"+r.spanId+"-0"+Number(r.traceFlags||ut.NONE).toString(16);n.set(t,Sr,o),r.traceState&&n.set(t,br,r.traceState.serialize())}},e.prototype.extract=function(e,t,n){var r=n.get(t,Sr);if(!r)return e;var o=Array.isArray(r)?r[0]:r;if("string"!=typeof o)return e;var i=function(e){var t=Or.exec(e);return t?"00"===t[1]&&t[5]?null:{traceId:t[2],spanId:t[3],traceFlags:parseInt(t[4],16)}:null}(o);if(!i)return e;i.isRemote=!0;var a=n.get(t,br);if(a){var s=Array.isArray(a)?a.join(","):a;i.traceState=new Tr("string"==typeof s?s:void 0)}return rn.setSpanContext(e,i)},e.prototype.fields=function(){return[Sr,br]},e}(),wr="baggage",Cr=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a};function Pr(e){var t=e.split(";");if(!(t.length<=0)){var n=t.shift();if(n){var r=n.split("=");if(2===r.length){var o,i=decodeURIComponent(r[0].trim()),a=decodeURIComponent(r[1].trim());return t.length>0&&(o=it(t.join(";"))),{key:i,value:a,metadata:o}}}}}var Ar=function(){function e(){}return e.prototype.inject=function(e,t,n){var r=on.getBaggage(e);if(r&&!Hn(e)){var o=function(e){return e.getAllEntries().map((function(e){var t=Cr(e,2),n=t[0],r=t[1],o=encodeURIComponent(n)+"="+encodeURIComponent(r.value);return void 0!==r.metadata&&(o+=";"+r.metadata.toString()),o}))}(r).filter((function(e){return e.length<=4096})).slice(0,180),i=function(e){return e.reduce((function(e,t){var n=e+(""!==e?",":"")+t;return n.length>8192?e:n}),"")}(o);i.length>0&&n.set(t,wr,i)}},e.prototype.extract=function(e,t,n){var r=n.get(t,wr),o=Array.isArray(r)?r.join(","):r;if(!o)return e;var i={};return 0===o.length?e:(o.split(",").forEach((function(e){var t=Pr(e);if(t){var n={value:t.value};t.metadata&&(n.metadata=t.metadata),i[t.key]=n}})),0===Object.entries(i).length?e:on.setBaggage(e,on.createBaggage(i)))},e.prototype.fields=function(){return[wr]},e}(),Lr=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Mr=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a};function Ir(e){var t,n,r={};if("object"!=typeof e||null==e)return r;try{for(var o=Lr(Object.entries(e)),i=o.next();!i.done;i=o.next()){var a=Mr(i.value,2),s=a[0],c=a[1];Nr(s)?xr(c)?Array.isArray(c)?r[s]=c.slice():r[s]=c:an.warn("Invalid attribute value set for key: "+s):an.warn("Invalid attribute key: "+s)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r}function Nr(e){return"string"==typeof e&&e.length>0}function xr(e){return null==e||(Array.isArray(e)?function(e){var t,n,r;try{for(var o=Lr(e),i=o.next();!i.done;i=o.next()){var a=i.value;if(null!=a){if(!r){if(kr(a)){r=typeof a;continue}return!1}if(typeof a!==r)return!1}}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return!0}(e):kr(e))}function kr(e){switch(typeof e){case"number":case"boolean":case"string":return!0}return!1}var Ur=performance,Dr=Math.pow(10,9);function jr(e){var t=e/1e3,n=Math.trunc(t);return[n,Number((t-n).toFixed(9))*Dr]}function Br(){var e=Ur.timeOrigin;if("number"!=typeof e){var t=Ur;e=t.timing&&t.timing.fetchStart}return e}function Vr(e){if(Fr(e))return e;if("number"==typeof e)return e<Br()?(t=e,n=jr(Br()),r=jr("number"==typeof t?t:Ur.now()),o=n[0]+r[0],(i=n[1]+r[1])>Dr&&(i-=Dr,o+=1),[o,i]):jr(e);if(e instanceof Date)return jr(e.getTime());throw TypeError("Invalid input type");var t,n,r,o,i}function Fr(e){return Array.isArray(e)&&2===e.length&&"number"==typeof e[0]&&"number"==typeof e[1]}var Xr,Gr="exception.type",zr="exception.message",Hr="exception.stacktrace",qr=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Kr=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},Wr=function(){function e(e,t,n,r,o,i,a,s,c){void 0===a&&(a=[]),void 0===c&&(c=Ur),this.attributes={},this.links=[],this.events=[],this.status={code:jt.UNSET},this.endTime=[0,0],this._ended=!1,this._duration=[-1,-1],this._clock=c,this.name=n,this._spanContext=r,this.parentSpanId=i,this.kind=o,this.links=a,this.startTime=Vr(null!=s?s:c.now()),this.resource=e.resource,this.instrumentationLibrary=e.instrumentationLibrary,this._spanLimits=e.getSpanLimits(),this._spanProcessor=e.getActiveSpanProcessor(),this._spanProcessor.onStart(this,t),this._attributeValueLengthLimit=this._spanLimits.attributeValueLengthLimit||0}return e.prototype.spanContext=function(){return this._spanContext},e.prototype.setAttribute=function(e,t){return null==t||this._isSpanEnded()?this:0===e.length?(an.warn("Invalid attribute key: "+e),this):xr(t)?(Object.keys(this.attributes).length>=this._spanLimits.attributeCountLimit&&!Object.prototype.hasOwnProperty.call(this.attributes,e)||(this.attributes[e]=this._truncateToSize(t)),this):(an.warn("Invalid attribute value set for key: "+e),this)},e.prototype.setAttributes=function(e){var t,n;try{for(var r=qr(Object.entries(e)),o=r.next();!o.done;o=r.next()){var i=Kr(o.value,2),a=i[0],s=i[1];this.setAttribute(a,s)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return this},e.prototype.addEvent=function(e,t,n){if(this._isSpanEnded())return this;if(0===this._spanLimits.eventCountLimit)return an.warn("No events allowed."),this;var r;this.events.length>=this._spanLimits.eventCountLimit&&(an.warn("Dropping extra events."),this.events.shift()),(Fr(r=t)||"number"==typeof r||r instanceof Date)&&(void 0===n&&(n=t),t=void 0),void 0===n&&(n=this._clock.now());var o=Ir(t);return this.events.push({name:e,attributes:o,time:Vr(n)}),this},e.prototype.setStatus=function(e){return this._isSpanEnded()||(this.status=e),this},e.prototype.updateName=function(e){return this._isSpanEnded()||(this.name=e),this},e.prototype.end=function(e){this._isSpanEnded()?an.error("You can only call end() on a span once."):(this._ended=!0,this.endTime=Vr(null!=e?e:this._clock.now()),this._duration=function(e,t){var n=t[0]-e[0],r=t[1]-e[1];return r<0&&(n-=1,r+=Dr),[n,r]}(this.startTime,this.endTime),this._duration[0]<0&&(an.warn("Inconsistent start and end time, startTime > endTime. Setting span duration to 0ms.",this.startTime,this.endTime),this.endTime=this.startTime.slice(),this._duration=[0,0]),this._spanProcessor.onEnd(this))},e.prototype.isRecording=function(){return!1===this._ended},e.prototype.recordException=function(e,t){void 0===t&&(t=this._clock.now());var n={};"string"==typeof e?n[zr]=e:e&&(e.code?n[Gr]=e.code.toString():e.name&&(n[Gr]=e.name),e.message&&(n[zr]=e.message),e.stack&&(n[Hr]=e.stack)),n[Gr]||n[zr]?this.addEvent("exception",n,t):an.warn("Failed to record an exception "+e)},Object.defineProperty(e.prototype,"duration",{get:function(){return this._duration},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"ended",{get:function(){return this._ended},enumerable:!1,configurable:!0}),e.prototype._isSpanEnded=function(){return this._ended&&an.warn("Can not execute the operation on ended Span {traceId: "+this._spanContext.traceId+", spanId: "+this._spanContext.spanId+"}"),this._ended},e.prototype._truncateToLimitUtil=function(e,t){return e.length<=t?e:e.substr(0,t)},e.prototype._truncateToSize=function(e){var t=this,n=this._attributeValueLengthLimit;return n<=0?(an.warn("Attribute value limit must be positive, got "+n),e):"string"==typeof e?this._truncateToLimitUtil(e,n):Array.isArray(e)?e.map((function(e){return"string"==typeof e?t._truncateToLimitUtil(e,n):e})):e},e}();!function(e){e[e.NOT_RECORD=0]="NOT_RECORD",e[e.RECORD=1]="RECORD",e[e.RECORD_AND_SAMPLED=2]="RECORD_AND_SAMPLED"}(Xr||(Xr={}));var Jr=function(){function e(){}return e.prototype.shouldSample=function(){return{decision:Xr.NOT_RECORD}},e.prototype.toString=function(){return"AlwaysOffSampler"},e}(),Qr=function(){function e(){}return e.prototype.shouldSample=function(){return{decision:Xr.RECORD_AND_SAMPLED}},e.prototype.toString=function(){return"AlwaysOnSampler"},e}(),Yr=function(){function e(e){var t,n,r,o;this._root=e.root,this._root||(Kn(new Error("ParentBasedSampler must have a root sampler configured")),this._root=new Qr),this._remoteParentSampled=null!==(t=e.remoteParentSampled)&&void 0!==t?t:new Qr,this._remoteParentNotSampled=null!==(n=e.remoteParentNotSampled)&&void 0!==n?n:new Jr,this._localParentSampled=null!==(r=e.localParentSampled)&&void 0!==r?r:new Qr,this._localParentNotSampled=null!==(o=e.localParentNotSampled)&&void 0!==o?o:new Jr}return e.prototype.shouldSample=function(e,t,n,r,o,i){var a=rn.getSpanContext(e);return a&&It(a)?a.isRemote?a.traceFlags&ut.SAMPLED?this._remoteParentSampled.shouldSample(e,t,n,r,o,i):this._remoteParentNotSampled.shouldSample(e,t,n,r,o,i):a.traceFlags&ut.SAMPLED?this._localParentSampled.shouldSample(e,t,n,r,o,i):this._localParentNotSampled.shouldSample(e,t,n,r,o,i):this._root.shouldSample(e,t,n,r,o,i)},e.prototype.toString=function(){return"ParentBased{root="+this._root.toString()+", remoteParentSampled="+this._remoteParentSampled.toString()+", remoteParentNotSampled="+this._remoteParentNotSampled.toString()+", localParentSampled="+this._localParentSampled.toString()+", localParentNotSampled="+this._localParentNotSampled.toString()+"}"},e}(),Zr=function(){function e(e){void 0===e&&(e=0),this._ratio=e,this._ratio=this._normalize(e),this._upperBound=Math.floor(4294967295*this._ratio)}return e.prototype.shouldSample=function(e,t){return{decision:Mt(t)&&this._accumulate(t)<this._upperBound?Xr.RECORD_AND_SAMPLED:Xr.NOT_RECORD}},e.prototype.toString=function(){return"TraceIdRatioBased{"+this._ratio+"}"},e.prototype._normalize=function(e){return"number"!=typeof e||isNaN(e)?0:e>=1?1:e<=0?0:e},e.prototype._accumulate=function(e){for(var t=0,n=0;n<e.length/8;n++){var r=8*n;t=(t^parseInt(e.slice(r,r+8),16))>>>0}return t},e}(),$r=jn(),eo=On.AlwaysOn;function to(){return{sampler:no($r),forceFlushTimeoutMillis:3e4,generalLimits:{attributeValueLengthLimit:jn().OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT,attributeCountLimit:jn().OTEL_ATTRIBUTE_COUNT_LIMIT},spanLimits:{attributeValueLengthLimit:jn().OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT,attributeCountLimit:jn().OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT,linkCountLimit:jn().OTEL_SPAN_LINK_COUNT_LIMIT,eventCountLimit:jn().OTEL_SPAN_EVENT_COUNT_LIMIT}}}function no(e){switch(void 0===e&&(e=jn()),e.OTEL_TRACES_SAMPLER){case On.AlwaysOn:return new Qr;case On.AlwaysOff:return new Jr;case On.ParentBasedAlwaysOn:return new Yr({root:new Qr});case On.ParentBasedAlwaysOff:return new Yr({root:new Jr});case On.TraceIdRatio:return new Zr(ro(e));case On.ParentBasedTraceIdRatio:return new Yr({root:new Zr(ro(e))});default:return an.error('OTEL_TRACES_SAMPLER value "'+e.OTEL_TRACES_SAMPLER+" invalid, defaulting to "+eo+'".'),new Qr}}function ro(e){if(void 0===e.OTEL_TRACES_SAMPLER_ARG||""===e.OTEL_TRACES_SAMPLER_ARG)return an.error("OTEL_TRACES_SAMPLER_ARG is blank, defaulting to 1."),1;var t=Number(e.OTEL_TRACES_SAMPLER_ARG);return isNaN(t)?(an.error("OTEL_TRACES_SAMPLER_ARG="+e.OTEL_TRACES_SAMPLER_ARG+" was given, but it is invalid, defaulting to 1."),1):t<0||t>1?(an.error("OTEL_TRACES_SAMPLER_ARG="+e.OTEL_TRACES_SAMPLER_ARG+" was given, but it is out of range ([0..1]), defaulting to 1."),1):t}function oo(e){var t,n,r,o,i,a,s,c,u,l,p,f,h=Object.assign({},e.spanLimits),d="undefined"!=typeof process?Dn("MISSING_ENV_VAR"):Dn(wn);return h.attributeCountLimit=null!==(a=null!==(i=null!==(o=null!==(n=null===(t=e.spanLimits)||void 0===t?void 0:t.attributeCountLimit)&&void 0!==n?n:null===(r=e.generalLimits)||void 0===r?void 0:r.attributeCountLimit)&&void 0!==o?o:d.OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT)&&void 0!==i?i:d.OTEL_ATTRIBUTE_COUNT_LIMIT)&&void 0!==a?a:128,h.attributeValueLengthLimit=null!==(f=null!==(p=null!==(l=null!==(c=null===(s=e.spanLimits)||void 0===s?void 0:s.attributeValueLengthLimit)&&void 0!==c?c:null===(u=e.generalLimits)||void 0===u?void 0:u.attributeValueLengthLimit)&&void 0!==l?l:d.OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT)&&void 0!==p?p:d.OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT)&&void 0!==f?f:Mn,Object.assign({},e,{spanLimits:h})}var io=function(){this.generateTraceId=so(16),this.generateSpanId=so(8)},ao=Array(32);function so(e){return function(){for(var t=0;t<2*e;t++)ao[t]=Math.floor(16*Math.random())+48,ao[t]>=58&&(ao[t]+=39);return String.fromCharCode.apply(null,ao.slice(0,2*e))}}var co,uo=function(){function e(e,t,n){this._tracerProvider=n;var r,o,i,a,s=(r=t,o={sampler:no()},i=to(),(a=Object.assign({},i,o,r)).generalLimits=Object.assign({},i.generalLimits,r.generalLimits||{}),a.spanLimits=Object.assign({},i.spanLimits,r.spanLimits||{}),a);this._sampler=s.sampler,this._generalLimits=s.generalLimits,this._spanLimits=s.spanLimits,this._idGenerator=t.idGenerator||new io,this.resource=n.resource,this.instrumentationLibrary=e}return e.prototype.startSpan=function(e,t,n){var r,o;void 0===t&&(t={}),void 0===n&&(n=nn.active()),t.root&&(n=rn.deleteSpan(n));var i=rn.getSpan(n);if(Hn(n))return an.debug("Instrumentation suppressed, returning Noop Span"),rn.wrapSpanContext(Et);var a,s,c,u=null==i?void 0:i.spanContext(),l=this._idGenerator.generateSpanId();u&&rn.isSpanContextValid(u)?(a=u.traceId,s=u.traceState,c=u.spanId):a=this._idGenerator.generateTraceId();var p=null!==(r=t.kind)&&void 0!==r?r:Dt.INTERNAL,f=(null!==(o=t.links)&&void 0!==o?o:[]).map((function(e){return{context:e.context,attributes:Ir(e.attributes)}})),h=Ir(t.attributes),d=this._sampler.shouldSample(n,a,e,p,h,f),_={traceId:a,spanId:l,traceFlags:d.decision===Ut.RECORD_AND_SAMPLED?ut.SAMPLED:ut.NONE,traceState:s};if(d.decision===Ut.NOT_RECORD)return an.debug("Recording is off, propagating context in a non-recording span"),rn.wrapSpanContext(_);var v=new Wr(this,n,e,_,p,c,f,t.startTime),y=Ir(Object.assign(h,d.attributes));return v.setAttributes(y),v},e.prototype.startActiveSpan=function(e,t,n,r){var o,i,a;if(!(arguments.length<2)){2===arguments.length?a=t:3===arguments.length?(o=t,a=n):(o=t,i=n,a=r);var s=null!=i?i:nn.active(),c=this.startSpan(e,o,s),u=rn.setSpan(s,c);return nn.with(u,a,void 0,c)}},e.prototype.getGeneralLimits=function(){return this._generalLimits},e.prototype.getSpanLimits=function(){return this._spanLimits},e.prototype.getActiveSpanProcessor=function(){return this._tracerProvider.getActiveSpanProcessor()},e}(),lo=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},po=function(){function e(e){this._spanProcessors=e}return e.prototype.forceFlush=function(){var e,t,n=[];try{for(var r=lo(this._spanProcessors),o=r.next();!o.done;o=r.next()){var i=o.value;n.push(i.forceFlush())}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return new Promise((function(e){Promise.all(n).then((function(){e()})).catch((function(t){Kn(t||new Error("MultiSpanProcessor: forceFlush failed")),e()}))}))},e.prototype.onStart=function(e,t){var n,r;try{for(var o=lo(this._spanProcessors),i=o.next();!i.done;i=o.next()){i.value.onStart(e,t)}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}},e.prototype.onEnd=function(e){var t,n;try{for(var r=lo(this._spanProcessors),o=r.next();!o.done;o=r.next()){o.value.onEnd(e)}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}},e.prototype.shutdown=function(){var e,t,n=[];try{for(var r=lo(this._spanProcessors),o=r.next();!o.done;o=r.next()){var i=o.value;n.push(i.shutdown())}}catch(t){e={error:t}}finally{try{o&&!o.done&&(t=r.return)&&t.call(r)}finally{if(e)throw e.error}}return new Promise((function(e,t){Promise.all(n).then((function(){e()}),t)}))},e}(),fo=function(){function e(){}return e.prototype.onStart=function(e,t){},e.prototype.onEnd=function(e){},e.prototype.shutdown=function(){return Promise.resolve()},e.prototype.forceFlush=function(){return Promise.resolve()},e}();!function(e){e[e.resolved=0]="resolved",e[e.timeout=1]="timeout",e[e.error=2]="error",e[e.unresolved=3]="unresolved"}(co||(co={}));var ho=function(){function e(e){var t;void 0===e&&(e={}),this._registeredSpanProcessors=[],this._tracers=new Map;var n=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];for(var n=e.shift(),r=new WeakMap;e.length>0;)n=lr(n,e.shift(),0,r);return n}({},to(),oo(e));this.resource=null!==(t=n.resource)&&void 0!==t?t:Rn.empty(),this.resource=Rn.default().merge(this.resource),this._config=Object.assign({},n,{resource:this.resource});var r=this._buildExporterFromEnv();if(void 0!==r){var o=new Zn(r);this.activeSpanProcessor=o}else this.activeSpanProcessor=new fo}return e.prototype.getTracer=function(e,t,n){var r=e+"@"+(t||"")+":"+((null==n?void 0:n.schemaUrl)||"");return this._tracers.has(r)||this._tracers.set(r,new uo({name:e,version:t,schemaUrl:null==n?void 0:n.schemaUrl},this._config,this)),this._tracers.get(r)},e.prototype.addSpanProcessor=function(e){0===this._registeredSpanProcessors.length&&this.activeSpanProcessor.shutdown().catch((function(e){return an.error("Error while trying to shutdown current span processor",e)})),this._registeredSpanProcessors.push(e),this.activeSpanProcessor=new po(this._registeredSpanProcessors)},e.prototype.getActiveSpanProcessor=function(){return this.activeSpanProcessor},e.prototype.register=function(e){void 0===e&&(e={}),rn.setGlobalTracerProvider(this),void 0===e.propagator&&(e.propagator=this._buildPropagatorFromEnv()),e.contextManager&&nn.setGlobalContextManager(e.contextManager),e.propagator&&on.setGlobalPropagator(e.propagator)},e.prototype.forceFlush=function(){var e=this._config.forceFlushTimeoutMillis,t=this._registeredSpanProcessors.map((function(t){return new Promise((function(n){var r,o=setTimeout((function(){n(new Error("Span processor did not completed within timeout period of "+e+" ms")),r=co.timeout}),e);t.forceFlush().then((function(){clearTimeout(o),r!==co.timeout&&(r=co.resolved,n(r))})).catch((function(e){clearTimeout(o),r=co.error,n(e)}))}))}));return new Promise((function(e,n){Promise.all(t).then((function(t){var r=t.filter((function(e){return e!==co.resolved}));r.length>0?n(r):e()})).catch((function(e){return n([e])}))}))},e.prototype.shutdown=function(){return this.activeSpanProcessor.shutdown()},e.prototype._getPropagator=function(e){var t;return null===(t=this.constructor._registeredPropagators.get(e))||void 0===t?void 0:t()},e.prototype._getSpanExporter=function(e){var t;return null===(t=this.constructor._registeredExporters.get(e))||void 0===t?void 0:t()},e.prototype._buildPropagatorFromEnv=function(){var e=this,t=Array.from(new Set(jn().OTEL_PROPAGATORS)),n=t.map((function(t){var n=e._getPropagator(t);return n||an.warn('Propagator "'+t+'" requested through environment variable is unavailable.'),n})).reduce((function(e,t){return t&&e.push(t),e}),[]);return 0===n.length?void 0:1===t.length?n[0]:new yr({propagators:n})},e.prototype._buildExporterFromEnv=function(){var e=jn().OTEL_TRACES_EXPORTER;if("none"!==e){var t=this._getSpanExporter(e);return t||an.error('Exporter "'+e+'" requested through environment variable is unavailable.'),t}},e._registeredPropagators=new Map([["tracecontext",function(){return new Rr}],["baggage",function(){return new Ar}]]),e._registeredExporters=new Map,e}(),_o=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},vo=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},yo=function(){function e(){this._enabled=!1,this._currentContext=pt}return e.prototype._bindFunction=function(e,t){void 0===e&&(e=pt);var n=this,r=function(){for(var r=this,o=[],i=0;i<arguments.length;i++)o[i]=arguments[i];return n.with(e,(function(){return t.apply(r,o)}))};return Object.defineProperty(r,"length",{enumerable:!1,configurable:!0,writable:!1,value:t.length}),r},e.prototype.active=function(){return this._currentContext},e.prototype.bind=function(e,t){return void 0===e&&(e=this.active()),"function"==typeof t?this._bindFunction(e,t):t},e.prototype.disable=function(){return this._currentContext=pt,this._enabled=!1,this},e.prototype.enable=function(){return this._enabled||(this._enabled=!0,this._currentContext=pt),this},e.prototype.with=function(e,t,n){for(var r=[],o=3;o<arguments.length;o++)r[o-3]=arguments[o];var i=this._currentContext;this._currentContext=e||pt;try{return t.call.apply(t,vo([n],_o(r),!1))}finally{this._currentContext=i}},e}(),go=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),mo=function(e){function t(t){void 0===t&&(t={});var n=e.call(this,t)||this;if(t.contextManager)throw"contextManager should be defined in register method not in constructor";if(t.propagator)throw"propagator should be defined in register method not in constructor";return n}return go(t,e),t.prototype.register=function(t){void 0===t&&(t={}),void 0===t.contextManager&&(t.contextManager=new yo),t.contextManager&&t.contextManager.enable(),e.prototype.register.call(this,t)},t}(ho),Eo=ct("OpenTelemetry SDK Context Key SUPPRESS_TRACING");function To(e){return!0===e.getValue(Eo)}var So=",",bo="baggage",Oo=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a};function Ro(e){var t=e.split(";");if(!(t.length<=0)){var n=t.shift();if(n){var r=n.split("=");if(2===r.length){var o,i=decodeURIComponent(r[0].trim()),a=decodeURIComponent(r[1].trim());return t.length>0&&(o=it(t.join(";"))),{key:i,value:a,metadata:o}}}}}(function(){function e(){}e.prototype.inject=function(e,t,n){var r=on.getBaggage(e);if(r&&!To(e)){var o=function(e){return e.getAllEntries().map((function(e){var t=Oo(e,2),n=t[0],r=t[1],o=encodeURIComponent(n)+"="+encodeURIComponent(r.value);return void 0!==r.metadata&&(o+=";"+r.metadata.toString()),o}))}(r).filter((function(e){return e.length<=4096})).slice(0,180),i=function(e){return e.reduce((function(e,t){var n=""+e+(""!==e?So:"")+t;return n.length>8192?e:n}),"")}(o);i.length>0&&n.set(t,bo,i)}},e.prototype.extract=function(e,t,n){var r=n.get(t,bo),o=Array.isArray(r)?r.join(So):r;if(!o)return e;var i={};return 0===o.length?e:(o.split(So).forEach((function(e){var t=Ro(e);if(t){var n={value:t.value};t.metadata&&(n.metadata=t.metadata),i[t.key]=n}})),0===Object.entries(i).length?e:on.setBaggage(e,on.createBaggage(i)))},e.prototype.fields=function(){return[bo]}})(),function(){function e(e,t){this._monotonicClock=t,this._epochMillis=e.now(),this._performanceMillis=t.now()}e.prototype.now=function(){var e=this._monotonicClock.now()-this._performanceMillis;return this._epochMillis+e}}();var wo,Co=function(e){an.error(function(e){return"string"==typeof e?e:JSON.stringify(function(e){for(var t={},n=e;null!==n;)Object.getOwnPropertyNames(n).forEach((function(e){if(!t[e]){var r=n[e];r&&(t[e]=String(r))}})),n=Object.getPrototypeOf(n);return t}(e))}(e))};!function(e){e.AlwaysOff="always_off",e.AlwaysOn="always_on",e.ParentBasedAlwaysOff="parentbased_always_off",e.ParentBasedAlwaysOn="parentbased_always_on",e.ParentBasedTraceIdRatio="parentbased_traceidratio",e.TraceIdRatio="traceidratio"}(wo||(wo={}));var Po="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof e.g?e.g:{},Ao=["OTEL_BSP_EXPORT_TIMEOUT","OTEL_BSP_MAX_EXPORT_BATCH_SIZE","OTEL_BSP_MAX_QUEUE_SIZE","OTEL_BSP_SCHEDULE_DELAY","OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_EVENT_COUNT_LIMIT","OTEL_SPAN_LINK_COUNT_LIMIT","OTEL_EXPORTER_OTLP_TIMEOUT","OTEL_EXPORTER_OTLP_TRACES_TIMEOUT","OTEL_EXPORTER_OTLP_METRICS_TIMEOUT","OTEL_EXPORTER_JAEGER_AGENT_PORT"];function Lo(e){return Ao.indexOf(e)>-1}var Mo=["OTEL_NO_PATCH_MODULES","OTEL_PROPAGATORS"];function Io(e){return Mo.indexOf(e)>-1}var No=1/0,xo={CONTAINER_NAME:"",ECS_CONTAINER_METADATA_URI_V4:"",ECS_CONTAINER_METADATA_URI:"",HOSTNAME:"",KUBERNETES_SERVICE_HOST:"",NAMESPACE:"",OTEL_BSP_EXPORT_TIMEOUT:3e4,OTEL_BSP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BSP_MAX_QUEUE_SIZE:2048,OTEL_BSP_SCHEDULE_DELAY:5e3,OTEL_EXPORTER_JAEGER_AGENT_HOST:"",OTEL_EXPORTER_JAEGER_AGENT_PORT:6832,OTEL_EXPORTER_JAEGER_ENDPOINT:"",OTEL_EXPORTER_JAEGER_PASSWORD:"",OTEL_EXPORTER_JAEGER_USER:"",OTEL_EXPORTER_OTLP_ENDPOINT:"",OTEL_EXPORTER_OTLP_TRACES_ENDPOINT:"",OTEL_EXPORTER_OTLP_METRICS_ENDPOINT:"",OTEL_EXPORTER_OTLP_HEADERS:"",OTEL_EXPORTER_OTLP_TRACES_HEADERS:"",OTEL_EXPORTER_OTLP_METRICS_HEADERS:"",OTEL_EXPORTER_OTLP_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_TRACES_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_METRICS_TIMEOUT:1e4,OTEL_EXPORTER_ZIPKIN_ENDPOINT:"http://localhost:9411/api/v2/spans",OTEL_LOG_LEVEL:Ye.INFO,OTEL_NO_PATCH_MODULES:[],OTEL_PROPAGATORS:["tracecontext","baggage"],OTEL_RESOURCE_ATTRIBUTES:"",OTEL_SERVICE_NAME:"",OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT:No,OTEL_ATTRIBUTE_COUNT_LIMIT:128,OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT:No,OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT:128,OTEL_SPAN_EVENT_COUNT_LIMIT:128,OTEL_SPAN_LINK_COUNT_LIMIT:128,OTEL_TRACES_EXPORTER:"none",OTEL_TRACES_SAMPLER:wo.ParentBasedAlwaysOn,OTEL_TRACES_SAMPLER_ARG:"",OTEL_EXPORTER_OTLP_INSECURE:"",OTEL_EXPORTER_OTLP_TRACES_INSECURE:"",OTEL_EXPORTER_OTLP_METRICS_INSECURE:"",OTEL_EXPORTER_OTLP_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_COMPRESSION:"",OTEL_EXPORTER_OTLP_TRACES_COMPRESSION:"",OTEL_EXPORTER_OTLP_METRICS_COMPRESSION:"",OTEL_EXPORTER_OTLP_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_CERTIFICATE:""};function ko(e,t,n,r,o){if(void 0===r&&(r=-1/0),void 0===o&&(o=1/0),void 0!==n[e]){var i=Number(n[e]);isNaN(i)||(t[e]=i<r?r:i>o?o:i)}}function Uo(e,t,n,r){void 0===r&&(r=",");var o=n[e];"string"==typeof o&&(t[e]=o.split(r).map((function(e){return e.trim()})))}var Do={ALL:Ye.ALL,VERBOSE:Ye.VERBOSE,DEBUG:Ye.DEBUG,INFO:Ye.INFO,WARN:Ye.WARN,ERROR:Ye.ERROR,NONE:Ye.NONE};function jo(e,t,n){var r=n[e];if("string"==typeof r){var o=Do[r.toUpperCase()];null!=o&&(t[e]=o)}}function Bo(e){var t={};for(var n in xo){var r=n;if("OTEL_LOG_LEVEL"===r)jo(r,t,e);else if(Lo(r))ko(r,t,e);else if(Io(r))Uo(r,t,e);else{var o=e[r];null!=o&&(t[r]=String(o))}}return t}function Vo(){var e=Bo(Po);return Object.assign({},xo,e)}Array(32);performance;var Fo,Xo,Go="process.runtime.name",zo="telemetry.sdk.language",Ho="telemetry.sdk.version";(Fo={})["telemetry.sdk.name"]="opentelemetry",Fo[Go]="browser",Fo[zo]="webjs",Fo[Ho]="1.7.0",Math.pow(10,9);!function(e){e[e.SUCCESS=0]="SUCCESS",e[e.FAILED=1]="FAILED"}(Xo||(Xo={}));var qo=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Ko=(function(){function e(e){var t;void 0===e&&(e={}),this._propagators=null!==(t=e.propagators)&&void 0!==t?t:[],this._fields=Array.from(new Set(this._propagators.map((function(e){return"function"==typeof e.fields?e.fields():[]})).reduce((function(e,t){return e.concat(t)}),[])))}e.prototype.inject=function(e,t,n){var r,o;try{for(var i=qo(this._propagators),a=i.next();!a.done;a=i.next()){var s=a.value;try{s.inject(e,t,n)}catch(e){an.warn("Failed to inject with "+s.constructor.name+". Err: "+e.message)}}}catch(e){r={error:e}}finally{try{a&&!a.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}},e.prototype.extract=function(e,t,n){return this._propagators.reduce((function(e,r){try{return r.extract(e,t,n)}catch(e){an.warn("Failed to inject with "+r.constructor.name+". Err: "+e.message)}return e}),e)},e.prototype.fields=function(){return this._fields.slice()}}(),new RegExp("^(?:[a-z][_0-9a-z-*/]{0,255}|[a-z0-9][_0-9a-z-*/]{0,240}@[a-z][_0-9a-z-*/]{0,13})$")),Wo=/^[ -~]{0,255}[!-~]$/,Jo=/,|=/;var Qo=function(){function e(e){this._internalState=new Map,e&&this._parse(e)}return e.prototype.set=function(e,t){var n=this._clone();return n._internalState.has(e)&&n._internalState.delete(e),n._internalState.set(e,t),n},e.prototype.unset=function(e){var t=this._clone();return t._internalState.delete(e),t},e.prototype.get=function(e){return this._internalState.get(e)},e.prototype.serialize=function(){var e=this;return this._keys().reduce((function(t,n){return t.push(n+"="+e.get(n)),t}),[]).join(",")},e.prototype._parse=function(e){e.length>512||(this._internalState=e.split(",").reverse().reduce((function(e,t){var n=t.trim(),r=n.indexOf("=");if(-1!==r){var o=n.slice(0,r),i=n.slice(r+1,t.length);(function(e){return Ko.test(e)})(o)&&function(e){return Wo.test(e)&&!Jo.test(e)}(i)&&e.set(o,i)}return e}),new Map),this._internalState.size>32&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,32))))},e.prototype._keys=function(){return Array.from(this._internalState.keys()).reverse()},e.prototype._clone=function(){var t=new e;return t._internalState=new Map(this._internalState),t},e}(),Yo="traceparent",Zo="tracestate",$o=new RegExp("^\\s?((?!ff)[\\da-f]{2})-((?![0]{32})[\\da-f]{32})-((?![0]{16})[\\da-f]{16})-([\\da-f]{2})(-.*)?\\s?$");var ei;(function(){function e(){}e.prototype.inject=function(e,t,n){var r=rn.getSpanContext(e);if(r&&!To(e)&&It(r)){var o="00-"+r.traceId+"-"+r.spanId+"-0"+Number(r.traceFlags||ut.NONE).toString(16);n.set(t,Yo,o),r.traceState&&n.set(t,Zo,r.traceState.serialize())}},e.prototype.extract=function(e,t,n){var r=n.get(t,Yo);if(!r)return e;var o=Array.isArray(r)?r[0]:r;if("string"!=typeof o)return e;var i=function(e){var t=$o.exec(e);return t?"00"===t[1]&&t[5]?null:{traceId:t[2],spanId:t[3],traceFlags:parseInt(t[4],16)}:null}(o);if(!i)return e;i.isRemote=!0;var a=n.get(t,Zo);if(a){var s=Array.isArray(a)?a.join(","):a;i.traceState=new Qo("string"==typeof s?s:void 0)}return rn.setSpanContext(e,i)},e.prototype.fields=function(){return[Yo,Zo]}})(),ct("OpenTelemetry SDK Context Key RPC_METADATA");!function(e){e.HTTP="http"}(ei||(ei={}));var ti=function(){function e(){}return e.prototype.shouldSample=function(){return{decision:Ut.NOT_RECORD}},e.prototype.toString=function(){return"AlwaysOffSampler"},e}(),ni=function(){function e(){}return e.prototype.shouldSample=function(){return{decision:Ut.RECORD_AND_SAMPLED}},e.prototype.toString=function(){return"AlwaysOnSampler"},e}(),ri=(function(){function e(e){var t,n,r,o;this._root=e.root,this._root||(!function(e){try{Co(e)}catch(e){}}(new Error("ParentBasedSampler must have a root sampler configured")),this._root=new ni),this._remoteParentSampled=null!==(t=e.remoteParentSampled)&&void 0!==t?t:new ni,this._remoteParentNotSampled=null!==(n=e.remoteParentNotSampled)&&void 0!==n?n:new ti,this._localParentSampled=null!==(r=e.localParentSampled)&&void 0!==r?r:new ni,this._localParentNotSampled=null!==(o=e.localParentNotSampled)&&void 0!==o?o:new ti}e.prototype.shouldSample=function(e,t,n,r,o,i){var a=rn.getSpanContext(e);return a&&It(a)?a.isRemote?a.traceFlags&ut.SAMPLED?this._remoteParentSampled.shouldSample(e,t,n,r,o,i):this._remoteParentNotSampled.shouldSample(e,t,n,r,o,i):a.traceFlags&ut.SAMPLED?this._localParentSampled.shouldSample(e,t,n,r,o,i):this._localParentNotSampled.shouldSample(e,t,n,r,o,i):this._root.shouldSample(e,t,n,r,o,i)},e.prototype.toString=function(){return"ParentBased{root="+this._root.toString()+", remoteParentSampled="+this._remoteParentSampled.toString()+", remoteParentNotSampled="+this._remoteParentNotSampled.toString()+", localParentSampled="+this._localParentSampled.toString()+", localParentNotSampled="+this._localParentNotSampled.toString()+"}"}}(),function(){function e(e){void 0===e&&(e=0),this._ratio=e,this._ratio=this._normalize(e),this._upperBound=Math.floor(4294967295*this._ratio)}e.prototype.shouldSample=function(e,t){return{decision:Mt(t)&&this._accumulate(t)<this._upperBound?Ut.RECORD_AND_SAMPLED:Ut.NOT_RECORD}},e.prototype.toString=function(){return"TraceIdRatioBased{"+this._ratio+"}"},e.prototype._normalize=function(e){return"number"!=typeof e||isNaN(e)?0:e>=1?1:e<=0?0:e},e.prototype._accumulate=function(e){for(var t=0,n=0;n<e.length/8;n++){var r=8*n;t=(t^parseInt(e.slice(r,r+8),16))>>>0}return t}}(),Function.prototype.toString),oi=(ri.call(Object),function(e,t){}(Object.getPrototypeOf,Object),Object.prototype);oi.hasOwnProperty,Symbol&&Symbol.toStringTag,oi.toString;var ii=function(){function e(){var e=this;this._promise=new Promise((function(t,n){e._resolve=t,e._reject=n}))}return Object.defineProperty(e.prototype,"promise",{get:function(){return this._promise},enumerable:!1,configurable:!0}),e.prototype.resolve=function(e){this._resolve(e)},e.prototype.reject=function(e){this._reject(e)},e}(),ai=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},si=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},ci=(function(){function e(e,t){this._callback=e,this._that=t,this._isCalled=!1,this._deferred=new ii}Object.defineProperty(e.prototype,"isCalled",{get:function(){return this._isCalled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"promise",{get:function(){return this._deferred.promise},enumerable:!1,configurable:!0}),e.prototype.call=function(){for(var e,t=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];if(!this._isCalled){this._isCalled=!0;try{Promise.resolve((e=this._callback).call.apply(e,si([this._that],ai(n),!1))).then((function(e){return t._deferred.resolve(e)}),(function(e){return t._deferred.reject(e)}))}catch(e){this._deferred.reject(e)}}return this._deferred.promise}}(),ct("OpenTelemetry SDK Context Key SUPPRESS_TRACING"));function ui(e){return!0===e.getValue(ci)}var li=",",pi="baggage",fi=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a};function hi(e){var t=e.split(";");if(!(t.length<=0)){var n=t.shift();if(n){var r=n.split("=");if(2===r.length){var o,i=decodeURIComponent(r[0].trim()),a=decodeURIComponent(r[1].trim());return t.length>0&&(o=it(t.join(";"))),{key:i,value:a,metadata:o}}}}}(function(){function e(){}e.prototype.inject=function(e,t,n){var r=on.getBaggage(e);if(r&&!ui(e)){var o=function(e){return e.getAllEntries().map((function(e){var t=fi(e,2),n=t[0],r=t[1],o=encodeURIComponent(n)+"="+encodeURIComponent(r.value);return void 0!==r.metadata&&(o+=";"+r.metadata.toString()),o}))}(r).filter((function(e){return e.length<=4096})).slice(0,180),i=function(e){return e.reduce((function(e,t){var n=""+e+(""!==e?li:"")+t;return n.length>8192?e:n}),"")}(o);i.length>0&&n.set(t,pi,i)}},e.prototype.extract=function(e,t,n){var r=n.get(t,pi),o=Array.isArray(r)?r.join(li):r;if(!o)return e;var i={};return 0===o.length?e:(o.split(li).forEach((function(e){var t=hi(e);if(t){var n={value:t.value};t.metadata&&(n.metadata=t.metadata),i[t.key]=n}})),0===Object.entries(i).length?e:on.setBaggage(e,on.createBaggage(i)))},e.prototype.fields=function(){return[pi]}})(),function(){function e(e,t){this._monotonicClock=t,this._epochMillis=e.now(),this._performanceMillis=t.now()}e.prototype.now=function(){var e=this._monotonicClock.now()-this._performanceMillis;return this._epochMillis+e}}();var di,_i=function(e){an.error(function(e){return"string"==typeof e?e:JSON.stringify(function(e){for(var t={},n=e;null!==n;)Object.getOwnPropertyNames(n).forEach((function(e){if(!t[e]){var r=n[e];r&&(t[e]=String(r))}})),n=Object.getPrototypeOf(n);return t}(e))}(e))};!function(e){e.AlwaysOff="always_off",e.AlwaysOn="always_on",e.ParentBasedAlwaysOff="parentbased_always_off",e.ParentBasedAlwaysOn="parentbased_always_on",e.ParentBasedTraceIdRatio="parentbased_traceidratio",e.TraceIdRatio="traceidratio"}(di||(di={}));var vi="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof e.g?e.g:{},yi=["OTEL_BSP_EXPORT_TIMEOUT","OTEL_BSP_MAX_EXPORT_BATCH_SIZE","OTEL_BSP_MAX_QUEUE_SIZE","OTEL_BSP_SCHEDULE_DELAY","OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_EVENT_COUNT_LIMIT","OTEL_SPAN_LINK_COUNT_LIMIT","OTEL_EXPORTER_OTLP_TIMEOUT","OTEL_EXPORTER_OTLP_TRACES_TIMEOUT","OTEL_EXPORTER_OTLP_METRICS_TIMEOUT","OTEL_EXPORTER_JAEGER_AGENT_PORT"];function gi(e){return yi.indexOf(e)>-1}var mi=["OTEL_NO_PATCH_MODULES","OTEL_PROPAGATORS"];function Ei(e){return mi.indexOf(e)>-1}var Ti=1/0,Si={CONTAINER_NAME:"",ECS_CONTAINER_METADATA_URI_V4:"",ECS_CONTAINER_METADATA_URI:"",HOSTNAME:"",KUBERNETES_SERVICE_HOST:"",NAMESPACE:"",OTEL_BSP_EXPORT_TIMEOUT:3e4,OTEL_BSP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BSP_MAX_QUEUE_SIZE:2048,OTEL_BSP_SCHEDULE_DELAY:5e3,OTEL_EXPORTER_JAEGER_AGENT_HOST:"",OTEL_EXPORTER_JAEGER_AGENT_PORT:6832,OTEL_EXPORTER_JAEGER_ENDPOINT:"",OTEL_EXPORTER_JAEGER_PASSWORD:"",OTEL_EXPORTER_JAEGER_USER:"",OTEL_EXPORTER_OTLP_ENDPOINT:"",OTEL_EXPORTER_OTLP_TRACES_ENDPOINT:"",OTEL_EXPORTER_OTLP_METRICS_ENDPOINT:"",OTEL_EXPORTER_OTLP_HEADERS:"",OTEL_EXPORTER_OTLP_TRACES_HEADERS:"",OTEL_EXPORTER_OTLP_METRICS_HEADERS:"",OTEL_EXPORTER_OTLP_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_TRACES_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_METRICS_TIMEOUT:1e4,OTEL_EXPORTER_ZIPKIN_ENDPOINT:"http://localhost:9411/api/v2/spans",OTEL_LOG_LEVEL:Ye.INFO,OTEL_NO_PATCH_MODULES:[],OTEL_PROPAGATORS:["tracecontext","baggage"],OTEL_RESOURCE_ATTRIBUTES:"",OTEL_SERVICE_NAME:"",OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT:Ti,OTEL_ATTRIBUTE_COUNT_LIMIT:128,OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT:Ti,OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT:128,OTEL_SPAN_EVENT_COUNT_LIMIT:128,OTEL_SPAN_LINK_COUNT_LIMIT:128,OTEL_TRACES_EXPORTER:"none",OTEL_TRACES_SAMPLER:di.ParentBasedAlwaysOn,OTEL_TRACES_SAMPLER_ARG:"",OTEL_EXPORTER_OTLP_INSECURE:"",OTEL_EXPORTER_OTLP_TRACES_INSECURE:"",OTEL_EXPORTER_OTLP_METRICS_INSECURE:"",OTEL_EXPORTER_OTLP_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_COMPRESSION:"",OTEL_EXPORTER_OTLP_TRACES_COMPRESSION:"",OTEL_EXPORTER_OTLP_METRICS_COMPRESSION:"",OTEL_EXPORTER_OTLP_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_CERTIFICATE:""};function bi(e,t,n,r,o){if(void 0===r&&(r=-1/0),void 0===o&&(o=1/0),void 0!==n[e]){var i=Number(n[e]);isNaN(i)||(t[e]=i<r?r:i>o?o:i)}}function Oi(e,t,n,r){void 0===r&&(r=",");var o=n[e];"string"==typeof o&&(t[e]=o.split(r).map((function(e){return e.trim()})))}var Ri={ALL:Ye.ALL,VERBOSE:Ye.VERBOSE,DEBUG:Ye.DEBUG,INFO:Ye.INFO,WARN:Ye.WARN,ERROR:Ye.ERROR,NONE:Ye.NONE};function wi(e,t,n){var r=n[e];if("string"==typeof r){var o=Ri[r.toUpperCase()];null!=o&&(t[e]=o)}}function Ci(e){var t={};for(var n in Si){var r=n;if("OTEL_LOG_LEVEL"===r)wi(r,t,e);else if(gi(r))bi(r,t,e);else if(Ei(r))Oi(r,t,e);else{var o=e[r];null!=o&&(t[r]=String(o))}}return t}function Pi(){var e=Ci(vi);return Object.assign({},Si,e)}Array(32);performance;var Ai,Li,Mi="process.runtime.name",Ii="telemetry.sdk.language",Ni="telemetry.sdk.version";(Ai={})["telemetry.sdk.name"]="opentelemetry",Ai[Mi]="browser",Ai[Ii]="webjs",Ai[Ni]="1.7.0",Math.pow(10,9);!function(e){e[e.SUCCESS=0]="SUCCESS",e[e.FAILED=1]="FAILED"}(Li||(Li={}));var xi=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},ki=(function(){function e(e){var t;void 0===e&&(e={}),this._propagators=null!==(t=e.propagators)&&void 0!==t?t:[],this._fields=Array.from(new Set(this._propagators.map((function(e){return"function"==typeof e.fields?e.fields():[]})).reduce((function(e,t){return e.concat(t)}),[])))}e.prototype.inject=function(e,t,n){var r,o;try{for(var i=xi(this._propagators),a=i.next();!a.done;a=i.next()){var s=a.value;try{s.inject(e,t,n)}catch(e){an.warn("Failed to inject with "+s.constructor.name+". Err: "+e.message)}}}catch(e){r={error:e}}finally{try{a&&!a.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}},e.prototype.extract=function(e,t,n){return this._propagators.reduce((function(e,r){try{return r.extract(e,t,n)}catch(e){an.warn("Failed to inject with "+r.constructor.name+". Err: "+e.message)}return e}),e)},e.prototype.fields=function(){return this._fields.slice()}}(),new RegExp("^(?:[a-z][_0-9a-z-*/]{0,255}|[a-z0-9][_0-9a-z-*/]{0,240}@[a-z][_0-9a-z-*/]{0,13})$")),Ui=/^[ -~]{0,255}[!-~]$/,Di=/,|=/;var ji=function(){function e(e){this._internalState=new Map,e&&this._parse(e)}return e.prototype.set=function(e,t){var n=this._clone();return n._internalState.has(e)&&n._internalState.delete(e),n._internalState.set(e,t),n},e.prototype.unset=function(e){var t=this._clone();return t._internalState.delete(e),t},e.prototype.get=function(e){return this._internalState.get(e)},e.prototype.serialize=function(){var e=this;return this._keys().reduce((function(t,n){return t.push(n+"="+e.get(n)),t}),[]).join(",")},e.prototype._parse=function(e){e.length>512||(this._internalState=e.split(",").reverse().reduce((function(e,t){var n=t.trim(),r=n.indexOf("=");if(-1!==r){var o=n.slice(0,r),i=n.slice(r+1,t.length);(function(e){return ki.test(e)})(o)&&function(e){return Ui.test(e)&&!Di.test(e)}(i)&&e.set(o,i)}return e}),new Map),this._internalState.size>32&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,32))))},e.prototype._keys=function(){return Array.from(this._internalState.keys()).reverse()},e.prototype._clone=function(){var t=new e;return t._internalState=new Map(this._internalState),t},e}(),Bi="traceparent",Vi="tracestate",Fi=new RegExp("^\\s?((?!ff)[\\da-f]{2})-((?![0]{32})[\\da-f]{32})-((?![0]{16})[\\da-f]{16})-([\\da-f]{2})(-.*)?\\s?$");var Xi;(function(){function e(){}e.prototype.inject=function(e,t,n){var r=rn.getSpanContext(e);if(r&&!ui(e)&&It(r)){var o="00-"+r.traceId+"-"+r.spanId+"-0"+Number(r.traceFlags||ut.NONE).toString(16);n.set(t,Bi,o),r.traceState&&n.set(t,Vi,r.traceState.serialize())}},e.prototype.extract=function(e,t,n){var r=n.get(t,Bi);if(!r)return e;var o=Array.isArray(r)?r[0]:r;if("string"!=typeof o)return e;var i=function(e){var t=Fi.exec(e);return t?"00"===t[1]&&t[5]?null:{traceId:t[2],spanId:t[3],traceFlags:parseInt(t[4],16)}:null}(o);if(!i)return e;i.isRemote=!0;var a=n.get(t,Vi);if(a){var s=Array.isArray(a)?a.join(","):a;i.traceState=new ji("string"==typeof s?s:void 0)}return rn.setSpanContext(e,i)},e.prototype.fields=function(){return[Bi,Vi]}})(),ct("OpenTelemetry SDK Context Key RPC_METADATA");!function(e){e.HTTP="http"}(Xi||(Xi={}));var Gi=function(){function e(){}return e.prototype.shouldSample=function(){return{decision:Ut.NOT_RECORD}},e.prototype.toString=function(){return"AlwaysOffSampler"},e}(),zi=function(){function e(){}return e.prototype.shouldSample=function(){return{decision:Ut.RECORD_AND_SAMPLED}},e.prototype.toString=function(){return"AlwaysOnSampler"},e}(),Hi=(function(){function e(e){var t,n,r,o;this._root=e.root,this._root||(!function(e){try{_i(e)}catch(e){}}(new Error("ParentBasedSampler must have a root sampler configured")),this._root=new zi),this._remoteParentSampled=null!==(t=e.remoteParentSampled)&&void 0!==t?t:new zi,this._remoteParentNotSampled=null!==(n=e.remoteParentNotSampled)&&void 0!==n?n:new Gi,this._localParentSampled=null!==(r=e.localParentSampled)&&void 0!==r?r:new zi,this._localParentNotSampled=null!==(o=e.localParentNotSampled)&&void 0!==o?o:new Gi}e.prototype.shouldSample=function(e,t,n,r,o,i){var a=rn.getSpanContext(e);return a&&It(a)?a.isRemote?a.traceFlags&ut.SAMPLED?this._remoteParentSampled.shouldSample(e,t,n,r,o,i):this._remoteParentNotSampled.shouldSample(e,t,n,r,o,i):a.traceFlags&ut.SAMPLED?this._localParentSampled.shouldSample(e,t,n,r,o,i):this._localParentNotSampled.shouldSample(e,t,n,r,o,i):this._root.shouldSample(e,t,n,r,o,i)},e.prototype.toString=function(){return"ParentBased{root="+this._root.toString()+", remoteParentSampled="+this._remoteParentSampled.toString()+", remoteParentNotSampled="+this._remoteParentNotSampled.toString()+", localParentSampled="+this._localParentSampled.toString()+", localParentNotSampled="+this._localParentNotSampled.toString()+"}"}}(),function(){function e(e){void 0===e&&(e=0),this._ratio=e,this._ratio=this._normalize(e),this._upperBound=Math.floor(4294967295*this._ratio)}e.prototype.shouldSample=function(e,t){return{decision:Mt(t)&&this._accumulate(t)<this._upperBound?Ut.RECORD_AND_SAMPLED:Ut.NOT_RECORD}},e.prototype.toString=function(){return"TraceIdRatioBased{"+this._ratio+"}"},e.prototype._normalize=function(e){return"number"!=typeof e||isNaN(e)?0:e>=1?1:e<=0?0:e},e.prototype._accumulate=function(e){for(var t=0,n=0;n<e.length/8;n++){var r=8*n;t=(t^parseInt(e.slice(r,r+8),16))>>>0}return t}}(),Function.prototype.toString),qi=(Hi.call(Object),function(e,t){}(Object.getPrototypeOf,Object),Object.prototype);qi.hasOwnProperty,Symbol&&Symbol.toStringTag,qi.toString;var Ki=function(){function e(){var e=this;this._promise=new Promise((function(t,n){e._resolve=t,e._reject=n}))}return Object.defineProperty(e.prototype,"promise",{get:function(){return this._promise},enumerable:!1,configurable:!0}),e.prototype.resolve=function(e){this._resolve(e)},e.prototype.reject=function(e){this._reject(e)},e}(),Wi=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},Ji=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},Qi=function(){function e(e,t){this._callback=e,this._that=t,this._isCalled=!1,this._deferred=new Ki}return Object.defineProperty(e.prototype,"isCalled",{get:function(){return this._isCalled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"promise",{get:function(){return this._deferred.promise},enumerable:!1,configurable:!0}),e.prototype.call=function(){for(var e,t=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];if(!this._isCalled){this._isCalled=!0;try{Promise.resolve((e=this._callback).call.apply(e,Ji([this._that],Wi(n),!1))).then((function(e){return t._deferred.resolve(e)}),(function(e){return t._deferred.reject(e)}))}catch(e){this._deferred.reject(e)}}return this._deferred.promise},e}(),Yi=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},Zi=1e4;function $i(e){return"number"==typeof e?e<=0?ea(e,1e4):e:function(){var e,t=Number(null!==(e=Pi().OTEL_EXPORTER_OTLP_TRACES_TIMEOUT)&&void 0!==e?e:Pi().OTEL_EXPORTER_OTLP_TIMEOUT);return t<=0?ea(t,Zi):t}()}function ea(e,t){return an.warn("Timeout must be greater than 0",e),t}var ta=function(){function e(e){void 0===e&&(e={}),this._sendingPromises=[],this.url=this.getDefaultUrl(e),"string"==typeof e.hostname&&(this.hostname=e.hostname),this.shutdown=this.shutdown.bind(this),this._shutdownOnce=new Qi(this._shutdown,this),this._concurrencyLimit="number"==typeof e.concurrencyLimit?e.concurrencyLimit:1/0,this.timeoutMillis=$i(e.timeoutMillis),this.onInit(e)}return e.prototype.export=function(e,t){this._shutdownOnce.isCalled?t({code:Li.FAILED,error:new Error("Exporter has been shutdown")}):this._sendingPromises.length>=this._concurrencyLimit?t({code:Li.FAILED,error:new Error("Concurrent export limit reached")}):this._export(e).then((function(){t({code:Li.SUCCESS})})).catch((function(e){t({code:Li.FAILED,error:e})}))},e.prototype._export=function(e){var t=this;return new Promise((function(n,r){try{an.debug("items to be sent",e),t.send(e,n,r)}catch(e){r(e)}}))},e.prototype.shutdown=function(){return this._shutdownOnce.call()},e.prototype._shutdown=function(){return an.debug("shutdown started"),this.onShutdown(),Promise.all(this._sendingPromises).then((function(){}))},e}(),na=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ra=function(e){function t(t,n,r){var o=e.call(this,t)||this;return o.name="OTLPExporterError",o.data=r,o.code=n,o}return na(t,e),t}(Error),oa=function(){return oa=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},oa.apply(this,arguments)},ia=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a};var aa,sa=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ca=function(e){function t(t){void 0===t&&(t={});var n,r=e.call(this,t)||this;return r._useXHR=!1,r._useXHR=!!t.headers||"function"!=typeof navigator.sendBeacon,r._useXHR?r._headers=Object.assign({},function(e){void 0===e&&(e={});var t={};return Object.entries(e).forEach((function(e){var n=Yi(e,2),r=n[0],o=n[1];void 0!==o?t[r]=String(o):an.warn('Header "'+r+'" has wrong value and will be ignored')})),t}(t.headers),"string"!=typeof(n=Pi().OTEL_EXPORTER_OTLP_HEADERS)||0===n.length?{}:n.split(li).map((function(e){return hi(e)})).filter((function(e){return void 0!==e&&e.value.length>0})).reduce((function(e,t){return e[t.key]=t.value,e}),{})):r._headers={},r}return sa(t,e),t.prototype.onInit=function(){window.addEventListener("unload",this.shutdown)},t.prototype.onShutdown=function(){window.removeEventListener("unload",this.shutdown)},t.prototype.send=function(e,t,n){var r=this;if(this._shutdownOnce.isCalled)an.debug("Shutdown already started. Cannot send objects");else{var o=this.convert(e),i=JSON.stringify(o),a=new Promise((function(e,t){r._useXHR?function(e,t,n,r,o,i){var a,s=setTimeout((function(){a=!0,c.abort()}),r),c=new XMLHttpRequest;c.open("POST",t),Object.entries(oa(oa({},{Accept:"application/json","Content-Type":"application/json"}),n)).forEach((function(e){var t=ia(e,2),n=t[0],r=t[1];c.setRequestHeader(n,r)})),c.send(e),c.onreadystatechange=function(){if(c.readyState===XMLHttpRequest.DONE)if(c.status>=200&&c.status<=299)clearTimeout(s),an.debug("xhr success",e),o();else if(a){var t=new ra("Request Timeout",c.status);i(t)}else t=new ra("Failed to export with XHR (status: "+c.status+")",c.status),clearTimeout(s),i(t)}}(i,r.url,r._headers,r.timeoutMillis,e,t):function(e,t,n,r,o){navigator.sendBeacon(t,new Blob([e],n))?(an.debug("sendBeacon - can send",e),r()):o(new ra("sendBeacon - cannot send "+e))}(i,r.url,{type:"application/json"},e,t)})).then(t,n);this._sendingPromises.push(a);var s=function(){var e=r._sendingPromises.indexOf(a);r._sendingPromises.splice(e,1)};a.then(s,s)}},t}(ta);!function(e){e[e.SPAN_KIND_UNSPECIFIED=0]="SPAN_KIND_UNSPECIFIED",e[e.SPAN_KIND_INTERNAL=1]="SPAN_KIND_INTERNAL",e[e.SPAN_KIND_SERVER=2]="SPAN_KIND_SERVER",e[e.SPAN_KIND_CLIENT=3]="SPAN_KIND_CLIENT",e[e.SPAN_KIND_PRODUCER=4]="SPAN_KIND_PRODUCER",e[e.SPAN_KIND_CONSUMER=5]="SPAN_KIND_CONSUMER"}(aa||(aa={}));var ua=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a};function la(e){return Object.keys(e).map((function(t){return pa(t,e[t])}))}function pa(e,t){return{key:e,value:fa(t)}}function fa(e){var t=typeof e;return"string"===t?{stringValue:e}:"number"===t?Number.isInteger(e)?{intValue:e}:{doubleValue:e}:"boolean"===t?{boolValue:e}:e instanceof Uint8Array?{bytesValue:e}:Array.isArray(e)?{arrayValue:{values:e.map(fa)}}:"object"===t&&null!=e?{kvlistValue:{values:Object.entries(e).map((function(e){var t=ua(e,2);return pa(t[0],t[1])}))}}:{}}var ha=ct("OpenTelemetry SDK Context Key SUPPRESS_TRACING");function da(e){return!0===e.getValue(ha)}var _a="baggage",va=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a};function ya(e){var t=e.split(";");if(!(t.length<=0)){var n=t.shift();if(n){var r=n.split("=");if(2===r.length){var o,i=decodeURIComponent(r[0].trim()),a=decodeURIComponent(r[1].trim());return t.length>0&&(o=it(t.join(";"))),{key:i,value:a,metadata:o}}}}}(function(){function e(){}e.prototype.inject=function(e,t,n){var r=on.getBaggage(e);if(r&&!da(e)){var o=function(e){return e.getAllEntries().map((function(e){var t=va(e,2),n=t[0],r=t[1],o=encodeURIComponent(n)+"="+encodeURIComponent(r.value);return void 0!==r.metadata&&(o+=";"+r.metadata.toString()),o}))}(r).filter((function(e){return e.length<=4096})).slice(0,180),i=function(e){return e.reduce((function(e,t){var n=e+(""!==e?",":"")+t;return n.length>8192?e:n}),"")}(o);i.length>0&&n.set(t,_a,i)}},e.prototype.extract=function(e,t,n){var r=n.get(t,_a),o=Array.isArray(r)?r.join(","):r;if(!o)return e;var i={};return 0===o.length?e:(o.split(",").forEach((function(e){var t=ya(e);if(t){var n={value:t.value};t.metadata&&(n.metadata=t.metadata),i[t.key]=n}})),0===Object.entries(i).length?e:on.setBaggage(e,on.createBaggage(i)))},e.prototype.fields=function(){return[_a]}})(),function(){function e(e,t){this._monotonicClock=t,this._epochMillis=e.now(),this._performanceMillis=t.now()}e.prototype.now=function(){var e=this._monotonicClock.now()-this._performanceMillis;return this._epochMillis+e}}();var ga,ma=function(e){an.error(function(e){return"string"==typeof e?e:JSON.stringify(function(e){for(var t={},n=e;null!==n;)Object.getOwnPropertyNames(n).forEach((function(e){if(!t[e]){var r=n[e];r&&(t[e]=String(r))}})),n=Object.getPrototypeOf(n);return t}(e))}(e))};!function(e){e.AlwaysOff="always_off",e.AlwaysOn="always_on",e.ParentBasedAlwaysOff="parentbased_always_off",e.ParentBasedAlwaysOn="parentbased_always_on",e.ParentBasedTraceIdRatio="parentbased_traceidratio",e.TraceIdRatio="traceidratio"}(ga||(ga={}));"object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof e.g&&e.g;var Ea=1/0;Ye.INFO,ga.ParentBasedAlwaysOn;Ye.ALL,Ye.VERBOSE,Ye.DEBUG,Ye.INFO,Ye.WARN,Ye.ERROR,Ye.NONE;function Ta(e){for(var t=e.length,n="",r=0;r<t;r+=2){var o=e.substring(r,r+2),i=parseInt(o,16);n+=String.fromCharCode(i)}return btoa(n)}Array(32);performance;var Sa,ba,Oa="process.runtime.name",Ra="telemetry.sdk.language",wa="telemetry.sdk.version",Ca=((Sa={})["telemetry.sdk.name"]="opentelemetry",Sa[Oa]="browser",Sa[Ra]="webjs",Sa[wa]="1.7.0",Math.pow(10,9));function Pa(e){return e[0]*Ca+e[1]}!function(e){e[e.SUCCESS=0]="SUCCESS",e[e.FAILED=1]="FAILED"}(ba||(ba={}));var Aa=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},La=(function(){function e(e){var t;void 0===e&&(e={}),this._propagators=null!==(t=e.propagators)&&void 0!==t?t:[],this._fields=Array.from(new Set(this._propagators.map((function(e){return"function"==typeof e.fields?e.fields():[]})).reduce((function(e,t){return e.concat(t)}),[])))}e.prototype.inject=function(e,t,n){var r,o;try{for(var i=Aa(this._propagators),a=i.next();!a.done;a=i.next()){var s=a.value;try{s.inject(e,t,n)}catch(e){an.warn("Failed to inject with "+s.constructor.name+". Err: "+e.message)}}}catch(e){r={error:e}}finally{try{a&&!a.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}},e.prototype.extract=function(e,t,n){return this._propagators.reduce((function(e,r){try{return r.extract(e,t,n)}catch(e){an.warn("Failed to inject with "+r.constructor.name+". Err: "+e.message)}return e}),e)},e.prototype.fields=function(){return this._fields.slice()}}(),new RegExp("^(?:[a-z][_0-9a-z-*/]{0,255}|[a-z0-9][_0-9a-z-*/]{0,240}@[a-z][_0-9a-z-*/]{0,13})$")),Ma=/^[ -~]{0,255}[!-~]$/,Ia=/,|=/;var Na=function(){function e(e){this._internalState=new Map,e&&this._parse(e)}return e.prototype.set=function(e,t){var n=this._clone();return n._internalState.has(e)&&n._internalState.delete(e),n._internalState.set(e,t),n},e.prototype.unset=function(e){var t=this._clone();return t._internalState.delete(e),t},e.prototype.get=function(e){return this._internalState.get(e)},e.prototype.serialize=function(){var e=this;return this._keys().reduce((function(t,n){return t.push(n+"="+e.get(n)),t}),[]).join(",")},e.prototype._parse=function(e){e.length>512||(this._internalState=e.split(",").reverse().reduce((function(e,t){var n=t.trim(),r=n.indexOf("=");if(-1!==r){var o=n.slice(0,r),i=n.slice(r+1,t.length);(function(e){return La.test(e)})(o)&&function(e){return Ma.test(e)&&!Ia.test(e)}(i)&&e.set(o,i)}return e}),new Map),this._internalState.size>32&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,32))))},e.prototype._keys=function(){return Array.from(this._internalState.keys()).reverse()},e.prototype._clone=function(){var t=new e;return t._internalState=new Map(this._internalState),t},e}(),xa="traceparent",ka="tracestate",Ua=new RegExp("^\\s?((?!ff)[\\da-f]{2})-((?![0]{32})[\\da-f]{32})-((?![0]{16})[\\da-f]{16})-([\\da-f]{2})(-.*)?\\s?$");var Da;(function(){function e(){}e.prototype.inject=function(e,t,n){var r=rn.getSpanContext(e);if(r&&!da(e)&&It(r)){var o="00-"+r.traceId+"-"+r.spanId+"-0"+Number(r.traceFlags||ut.NONE).toString(16);n.set(t,xa,o),r.traceState&&n.set(t,ka,r.traceState.serialize())}},e.prototype.extract=function(e,t,n){var r=n.get(t,xa);if(!r)return e;var o=Array.isArray(r)?r[0]:r;if("string"!=typeof o)return e;var i=function(e){var t=Ua.exec(e);return t?"00"===t[1]&&t[5]?null:{traceId:t[2],spanId:t[3],traceFlags:parseInt(t[4],16)}:null}(o);if(!i)return e;i.isRemote=!0;var a=n.get(t,ka);if(a){var s=Array.isArray(a)?a.join(","):a;i.traceState=new Na("string"==typeof s?s:void 0)}return rn.setSpanContext(e,i)},e.prototype.fields=function(){return[xa,ka]}})(),ct("OpenTelemetry SDK Context Key RPC_METADATA");!function(e){e.HTTP="http"}(Da||(Da={}));var ja=function(){function e(){}return e.prototype.shouldSample=function(){return{decision:Ut.NOT_RECORD}},e.prototype.toString=function(){return"AlwaysOffSampler"},e}(),Ba=function(){function e(){}return e.prototype.shouldSample=function(){return{decision:Ut.RECORD_AND_SAMPLED}},e.prototype.toString=function(){return"AlwaysOnSampler"},e}(),Va=(function(){function e(e){var t,n,r,o;this._root=e.root,this._root||(!function(e){try{ma(e)}catch(e){}}(new Error("ParentBasedSampler must have a root sampler configured")),this._root=new Ba),this._remoteParentSampled=null!==(t=e.remoteParentSampled)&&void 0!==t?t:new Ba,this._remoteParentNotSampled=null!==(n=e.remoteParentNotSampled)&&void 0!==n?n:new ja,this._localParentSampled=null!==(r=e.localParentSampled)&&void 0!==r?r:new Ba,this._localParentNotSampled=null!==(o=e.localParentNotSampled)&&void 0!==o?o:new ja}e.prototype.shouldSample=function(e,t,n,r,o,i){var a=rn.getSpanContext(e);return a&&It(a)?a.isRemote?a.traceFlags&ut.SAMPLED?this._remoteParentSampled.shouldSample(e,t,n,r,o,i):this._remoteParentNotSampled.shouldSample(e,t,n,r,o,i):a.traceFlags&ut.SAMPLED?this._localParentSampled.shouldSample(e,t,n,r,o,i):this._localParentNotSampled.shouldSample(e,t,n,r,o,i):this._root.shouldSample(e,t,n,r,o,i)},e.prototype.toString=function(){return"ParentBased{root="+this._root.toString()+", remoteParentSampled="+this._remoteParentSampled.toString()+", remoteParentNotSampled="+this._remoteParentNotSampled.toString()+", localParentSampled="+this._localParentSampled.toString()+", localParentNotSampled="+this._localParentNotSampled.toString()+"}"}}(),function(){function e(e){void 0===e&&(e=0),this._ratio=e,this._ratio=this._normalize(e),this._upperBound=Math.floor(4294967295*this._ratio)}e.prototype.shouldSample=function(e,t){return{decision:Mt(t)&&this._accumulate(t)<this._upperBound?Ut.RECORD_AND_SAMPLED:Ut.NOT_RECORD}},e.prototype.toString=function(){return"TraceIdRatioBased{"+this._ratio+"}"},e.prototype._normalize=function(e){return"number"!=typeof e||isNaN(e)?0:e>=1?1:e<=0?0:e},e.prototype._accumulate=function(e){for(var t=0,n=0;n<e.length/8;n++){var r=8*n;t=(t^parseInt(e.slice(r,r+8),16))>>>0}return t}}(),Function.prototype.toString),Fa=(Va.call(Object),function(e,t){}(Object.getPrototypeOf,Object),Object.prototype);Fa.hasOwnProperty,Symbol&&Symbol.toStringTag,Fa.toString;var Xa=function(){function e(){var e=this;this._promise=new Promise((function(t,n){e._resolve=t,e._reject=n}))}return Object.defineProperty(e.prototype,"promise",{get:function(){return this._promise},enumerable:!1,configurable:!0}),e.prototype.resolve=function(e){this._resolve(e)},e.prototype.reject=function(e){this._reject(e)},e}(),Ga=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},za=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))};!function(){function e(e,t){this._callback=e,this._that=t,this._isCalled=!1,this._deferred=new Xa}Object.defineProperty(e.prototype,"isCalled",{get:function(){return this._isCalled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"promise",{get:function(){return this._deferred.promise},enumerable:!1,configurable:!0}),e.prototype.call=function(){for(var e,t=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];if(!this._isCalled){this._isCalled=!0;try{Promise.resolve((e=this._callback).call.apply(e,za([this._that],Ga(n),!1))).then((function(e){return t._deferred.resolve(e)}),(function(e){return t._deferred.reject(e)}))}catch(e){this._deferred.reject(e)}}return this._deferred.promise}}();function Ha(e,t){var n=e.spanContext(),r=e.status,o=t?e.parentSpanId:null!=e.parentSpanId?Ta(e.parentSpanId):void 0;return{traceId:t?n.traceId:Ta(n.traceId),spanId:t?n.spanId:Ta(n.spanId),parentSpanId:o,name:e.name,kind:null==e.kind?0:e.kind+1,startTimeUnixNano:Pa(e.startTime),endTimeUnixNano:Pa(e.endTime),attributes:la(e.attributes),droppedAttributesCount:0,events:e.events.map(qa),droppedEventsCount:0,status:{code:r.code,message:r.message},links:e.links.map((function(e){return function(e,t){return{attributes:e.attributes?la(e.attributes):[],spanId:t?e.context.spanId:Ta(e.context.spanId),traceId:t?e.context.traceId:Ta(e.context.traceId),droppedAttributesCount:0}}(e,t)})),droppedLinksCount:0}}function qa(e){return{attributes:e.attributes?la(e.attributes):[],name:e.name,timeUnixNano:Pa(e.time),droppedAttributesCount:0}}var Ka=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Wa=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a};function Ja(e,t){for(var n=function(e){var t,n,r=new Map;try{for(var o=Ka(e),i=o.next();!i.done;i=o.next()){var a=i.value,s=r.get(a.resource);s||(s=new Map,r.set(a.resource,s));var c=a.instrumentationLibrary.name+"@"+(a.instrumentationLibrary.version||"")+":"+(a.instrumentationLibrary.schemaUrl||""),u=s.get(c);u||(u=[],s.set(c,u)),u.push(a)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r}(e),r=[],o=n.entries(),i=o.next();!i.done;){for(var a=Wa(i.value,2),s=a[0],c=[],u=a[1].values(),l=u.next();!l.done;){var p=l.value;if(p.length>0){var f=p[0].instrumentationLibrary,h=f.name,d=f.version,_=f.schemaUrl,v=p.map((function(e){return Ha(e,t)}));c.push({scope:{name:h,version:d},spans:v,schemaUrl:_})}l=u.next()}var y={resource:{attributes:la(s.attributes),droppedAttributesCount:0},scopeSpans:c,schemaUrl:void 0};r.push(y),i=o.next()}return r}var Qa,Ya=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Za=function(){function e(){}return e.prototype.createHistogram=function(e,t){return us},e.prototype.createCounter=function(e,t){return cs},e.prototype.createUpDownCounter=function(e,t){return ls},e.prototype.createObservableGauge=function(e,t){return fs},e.prototype.createObservableCounter=function(e,t){return ps},e.prototype.createObservableUpDownCounter=function(e,t){return hs},e.prototype.addBatchObservableCallback=function(e,t){},e.prototype.removeBatchObservableCallback=function(e){},e}(),$a=function(){},es=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ya(t,e),t.prototype.add=function(e,t){},t}($a),ts=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ya(t,e),t.prototype.add=function(e,t){},t}($a),ns=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ya(t,e),t.prototype.record=function(e,t){},t}($a),rs=function(){function e(){}return e.prototype.addCallback=function(e){},e.prototype.removeCallback=function(e){},e}(),os=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ya(t,e),t}(rs),is=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ya(t,e),t}(rs),as=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Ya(t,e),t}(rs),ss=new Za,cs=new es,us=new ns,ls=new ts,ps=new os,fs=new is,hs=new as;!function(e){e[e.INT=0]="INT",e[e.DOUBLE=1]="DOUBLE"}(Qa||(Qa={}));var ds=new(function(){function e(){}return e.prototype.getMeter=function(e,t,n){return ss},e}()),_s="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof e.g?e.g:{},vs=Symbol.for("io.opentelemetry.js.api.metrics"),ys=_s;var gs,ms,Es=function(){function e(){}return e.getInstance=function(){return this._instance||(this._instance=new e),this._instance},e.prototype.setGlobalMeterProvider=function(e){return ys[vs]?this.getMeterProvider():(ys[vs]=(t=4,n=e,r=ds,function(e){return e===t?n:r}),e);var t,n,r},e.prototype.getMeterProvider=function(){var e,t;return null!==(t=null===(e=ys[vs])||void 0===e?void 0:e.call(ys,4))&&void 0!==t?t:ds},e.prototype.getMeter=function(e,t,n){return this.getMeterProvider().getMeter(e,t,n)},e.prototype.disable=function(){delete ys[vs]},e}();Es.getInstance();!function(e){e[e.DELTA=0]="DELTA",e[e.CUMULATIVE=1]="CUMULATIVE"}(gs||(gs={})),function(e){e[e.HISTOGRAM=0]="HISTOGRAM",e[e.EXPONENTIAL_HISTOGRAM=1]="EXPONENTIAL_HISTOGRAM",e[e.GAUGE=2]="GAUGE",e[e.SUM=3]="SUM"}(ms||(ms={}));var Ts=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ss=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},bs=function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Os=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},Rs=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},ws=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")};function Cs(e){return null!=e}function Ps(e){var t=Object.keys(e);return 0===t.length?"":(t=t.sort(),JSON.stringify(t.map((function(t){return[t,e[t]]}))))}var As,Ls=function(e){function t(n){var r=e.call(this,n)||this;return Object.setPrototypeOf(r,t.prototype),r}return Ts(t,e),t}(Error);function Ms(e,t){var n,r=new Promise((function(e,r){n=setTimeout((function(){r(new Ls("Operation timed out."))}),t)}));return Promise.race([e,r]).then((function(e){return clearTimeout(n),e}),(function(e){throw clearTimeout(n),e}))}function Is(e){return Ss(this,void 0,void 0,(function(){var t=this;return bs(this,(function(n){return[2,Promise.all(e.map((function(e){return Ss(t,void 0,void 0,(function(){return bs(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,e];case 1:return[2,{status:"fulfilled",value:t.sent()}];case 2:return[2,{status:"rejected",reason:t.sent()}];case 3:return[2]}}))}))})))]}))}))}function Ns(e){return"rejected"===e.status}function xs(e,t){var n=[];return e.forEach((function(e){n.push.apply(n,Rs([],Os(t(e)),!1))})),n}!function(e){e[e.DROP=0]="DROP",e[e.SUM=1]="SUM",e[e.LAST_VALUE=2]="LAST_VALUE",e[e.HISTOGRAM=3]="HISTOGRAM"}(As||(As={}));var ks,Us=function(){function e(){this.kind=As.DROP}return e.prototype.createAccumulation=function(){},e.prototype.merge=function(e,t){},e.prototype.diff=function(e,t){},e.prototype.toMetricData=function(e,t,n,r){},e}();function Ds(e,t,n){var r,o,i;return{name:e,type:t,description:null!==(r=null==n?void 0:n.description)&&void 0!==r?r:"",unit:null!==(o=null==n?void 0:n.unit)&&void 0!==o?o:"",valueType:null!==(i=null==n?void 0:n.valueType)&&void 0!==i?i:Qa.DOUBLE}}!function(e){e.COUNTER="COUNTER",e.HISTOGRAM="HISTOGRAM",e.UP_DOWN_COUNTER="UP_DOWN_COUNTER",e.OBSERVABLE_COUNTER="OBSERVABLE_COUNTER",e.OBSERVABLE_GAUGE="OBSERVABLE_GAUGE",e.OBSERVABLE_UP_DOWN_COUNTER="OBSERVABLE_UP_DOWN_COUNTER"}(ks||(ks={}));var js=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a};var Bs=function(){function e(e,t,n,r){var o,i;void 0===n&&(n=!0),void 0===r&&((i=(o=t).map((function(){return 0}))).push(0),r={buckets:{boundaries:o,counts:i},sum:0,count:0,hasMinMax:!1,min:1/0,max:-1/0}),this.startTime=e,this._boundaries=t,this._recordMinMax=n,this._current=r}return e.prototype.record=function(e){this._current.count+=1,this._current.sum+=e,this._recordMinMax&&(this._current.min=Math.min(e,this._current.min),this._current.max=Math.max(e,this._current.max),this._current.hasMinMax=!0);for(var t=0;t<this._boundaries.length;t++)if(e<this._boundaries[t])return void(this._current.buckets.counts[t]+=1);this._current.buckets.counts[this._boundaries.length]+=1},e.prototype.setStartTime=function(e){this.startTime=e},e.prototype.toPointValue=function(){return this._current},e}(),Vs=function(){function e(e,t){this._boundaries=e,this._recordMinMax=t,this.kind=As.HISTOGRAM}return e.prototype.createAccumulation=function(e){return new Bs(e,this._boundaries,this._recordMinMax)},e.prototype.merge=function(e,t){for(var n=e.toPointValue(),r=t.toPointValue(),o=n.buckets.counts,i=r.buckets.counts,a=new Array(o.length),s=0;s<o.length;s++)a[s]=o[s]+i[s];var c=1/0,u=-1/0;return this._recordMinMax&&(n.hasMinMax&&r.hasMinMax?(c=Math.min(n.min,r.min),u=Math.max(n.max,r.max)):n.hasMinMax?(c=n.min,u=n.max):r.hasMinMax&&(c=r.min,u=r.max)),new Bs(e.startTime,n.buckets.boundaries,this._recordMinMax,{buckets:{boundaries:n.buckets.boundaries,counts:a},count:n.count+r.count,sum:n.sum+r.sum,hasMinMax:this._recordMinMax&&(n.hasMinMax||r.hasMinMax),min:c,max:u})},e.prototype.diff=function(e,t){for(var n=e.toPointValue(),r=t.toPointValue(),o=n.buckets.counts,i=r.buckets.counts,a=new Array(o.length),s=0;s<o.length;s++)a[s]=i[s]-o[s];return new Bs(t.startTime,n.buckets.boundaries,this._recordMinMax,{buckets:{boundaries:n.buckets.boundaries,counts:a},count:r.count-n.count,sum:r.sum-n.sum,hasMinMax:!1,min:1/0,max:-1/0})},e.prototype.toMetricData=function(e,t,n,r){return{descriptor:e,aggregationTemporality:t,dataPointType:ms.HISTOGRAM,dataPoints:n.map((function(t){var n=js(t,2),o=n[0],i=n[1],a=i.toPointValue(),s=e.type===ks.UP_DOWN_COUNTER||e.type===ks.OBSERVABLE_GAUGE||e.type===ks.OBSERVABLE_UP_DOWN_COUNTER;return{attributes:o,startTime:i.startTime,endTime:r,value:{min:a.hasMinMax?a.min:void 0,max:a.hasMinMax?a.max:void 0,sum:s?void 0:a.sum,buckets:a.buckets,count:a.count}}}))}},e}(),Fs=ct("OpenTelemetry SDK Context Key SUPPRESS_TRACING");function Xs(e){return!0===e.getValue(Fs)}var Gs="baggage",zs=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a};function Hs(e){var t=e.split(";");if(!(t.length<=0)){var n=t.shift();if(n){var r=n.split("=");if(2===r.length){var o,i=decodeURIComponent(r[0].trim()),a=decodeURIComponent(r[1].trim());return t.length>0&&(o=it(t.join(";"))),{key:i,value:a,metadata:o}}}}}(function(){function e(){}e.prototype.inject=function(e,t,n){var r=on.getBaggage(e);if(r&&!Xs(e)){var o=function(e){return e.getAllEntries().map((function(e){var t=zs(e,2),n=t[0],r=t[1],o=encodeURIComponent(n)+"="+encodeURIComponent(r.value);return void 0!==r.metadata&&(o+=";"+r.metadata.toString()),o}))}(r).filter((function(e){return e.length<=4096})).slice(0,180),i=function(e){return e.reduce((function(e,t){var n=e+(""!==e?",":"")+t;return n.length>8192?e:n}),"")}(o);i.length>0&&n.set(t,Gs,i)}},e.prototype.extract=function(e,t,n){var r=n.get(t,Gs),o=Array.isArray(r)?r.join(","):r;if(!o)return e;var i={};return 0===o.length?e:(o.split(",").forEach((function(e){var t=Hs(e);if(t){var n={value:t.value};t.metadata&&(n.metadata=t.metadata),i[t.key]=n}})),0===Object.entries(i).length?e:on.setBaggage(e,on.createBaggage(i)))},e.prototype.fields=function(){return[Gs]}})(),function(){function e(e,t){this._monotonicClock=t,this._epochMillis=e.now(),this._performanceMillis=t.now()}e.prototype.now=function(){var e=this._monotonicClock.now()-this._performanceMillis;return this._epochMillis+e}}();var qs,Ks=function(e){an.error(function(e){return"string"==typeof e?e:JSON.stringify(function(e){for(var t={},n=e;null!==n;)Object.getOwnPropertyNames(n).forEach((function(e){if(!t[e]){var r=n[e];r&&(t[e]=String(r))}})),n=Object.getPrototypeOf(n);return t}(e))}(e))};function Ws(e){try{Ks(e)}catch(e){}}!function(e){e.AlwaysOff="always_off",e.AlwaysOn="always_on",e.ParentBasedAlwaysOff="parentbased_always_off",e.ParentBasedAlwaysOn="parentbased_always_on",e.ParentBasedTraceIdRatio="parentbased_traceidratio",e.TraceIdRatio="traceidratio"}(qs||(qs={}));var Js="object"==typeof globalThis?globalThis:"object"==typeof self?self:"object"==typeof window?window:"object"==typeof e.g?e.g:{},Qs=["OTEL_BSP_EXPORT_TIMEOUT","OTEL_BSP_MAX_EXPORT_BATCH_SIZE","OTEL_BSP_MAX_QUEUE_SIZE","OTEL_BSP_SCHEDULE_DELAY","OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT","OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT","OTEL_SPAN_EVENT_COUNT_LIMIT","OTEL_SPAN_LINK_COUNT_LIMIT","OTEL_EXPORTER_OTLP_TIMEOUT","OTEL_EXPORTER_OTLP_TRACES_TIMEOUT","OTEL_EXPORTER_OTLP_METRICS_TIMEOUT","OTEL_EXPORTER_JAEGER_AGENT_PORT"];function Ys(e){return Qs.indexOf(e)>-1}var Zs=["OTEL_NO_PATCH_MODULES","OTEL_PROPAGATORS"];function $s(e){return Zs.indexOf(e)>-1}var ec=1/0,tc={CONTAINER_NAME:"",ECS_CONTAINER_METADATA_URI_V4:"",ECS_CONTAINER_METADATA_URI:"",HOSTNAME:"",KUBERNETES_SERVICE_HOST:"",NAMESPACE:"",OTEL_BSP_EXPORT_TIMEOUT:3e4,OTEL_BSP_MAX_EXPORT_BATCH_SIZE:512,OTEL_BSP_MAX_QUEUE_SIZE:2048,OTEL_BSP_SCHEDULE_DELAY:5e3,OTEL_EXPORTER_JAEGER_AGENT_HOST:"",OTEL_EXPORTER_JAEGER_AGENT_PORT:6832,OTEL_EXPORTER_JAEGER_ENDPOINT:"",OTEL_EXPORTER_JAEGER_PASSWORD:"",OTEL_EXPORTER_JAEGER_USER:"",OTEL_EXPORTER_OTLP_ENDPOINT:"",OTEL_EXPORTER_OTLP_TRACES_ENDPOINT:"",OTEL_EXPORTER_OTLP_METRICS_ENDPOINT:"",OTEL_EXPORTER_OTLP_HEADERS:"",OTEL_EXPORTER_OTLP_TRACES_HEADERS:"",OTEL_EXPORTER_OTLP_METRICS_HEADERS:"",OTEL_EXPORTER_OTLP_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_TRACES_TIMEOUT:1e4,OTEL_EXPORTER_OTLP_METRICS_TIMEOUT:1e4,OTEL_EXPORTER_ZIPKIN_ENDPOINT:"http://localhost:9411/api/v2/spans",OTEL_LOG_LEVEL:Ye.INFO,OTEL_NO_PATCH_MODULES:[],OTEL_PROPAGATORS:["tracecontext","baggage"],OTEL_RESOURCE_ATTRIBUTES:"",OTEL_SERVICE_NAME:"",OTEL_ATTRIBUTE_VALUE_LENGTH_LIMIT:ec,OTEL_ATTRIBUTE_COUNT_LIMIT:128,OTEL_SPAN_ATTRIBUTE_VALUE_LENGTH_LIMIT:ec,OTEL_SPAN_ATTRIBUTE_COUNT_LIMIT:128,OTEL_SPAN_EVENT_COUNT_LIMIT:128,OTEL_SPAN_LINK_COUNT_LIMIT:128,OTEL_TRACES_EXPORTER:"none",OTEL_TRACES_SAMPLER:qs.ParentBasedAlwaysOn,OTEL_TRACES_SAMPLER_ARG:"",OTEL_EXPORTER_OTLP_INSECURE:"",OTEL_EXPORTER_OTLP_TRACES_INSECURE:"",OTEL_EXPORTER_OTLP_METRICS_INSECURE:"",OTEL_EXPORTER_OTLP_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CERTIFICATE:"",OTEL_EXPORTER_OTLP_COMPRESSION:"",OTEL_EXPORTER_OTLP_TRACES_COMPRESSION:"",OTEL_EXPORTER_OTLP_METRICS_COMPRESSION:"",OTEL_EXPORTER_OTLP_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_KEY:"",OTEL_EXPORTER_OTLP_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_TRACES_CLIENT_CERTIFICATE:"",OTEL_EXPORTER_OTLP_METRICS_CLIENT_CERTIFICATE:""};function nc(e,t,n,r,o){if(void 0===r&&(r=-1/0),void 0===o&&(o=1/0),void 0!==n[e]){var i=Number(n[e]);isNaN(i)||(t[e]=i<r?r:i>o?o:i)}}function rc(e,t,n,r){void 0===r&&(r=",");var o=n[e];"string"==typeof o&&(t[e]=o.split(r).map((function(e){return e.trim()})))}var oc={ALL:Ye.ALL,VERBOSE:Ye.VERBOSE,DEBUG:Ye.DEBUG,INFO:Ye.INFO,WARN:Ye.WARN,ERROR:Ye.ERROR,NONE:Ye.NONE};function ic(e,t,n){var r=n[e];if("string"==typeof r){var o=oc[r.toUpperCase()];null!=o&&(t[e]=o)}}function ac(e){var t={};for(var n in tc){var r=n;if("OTEL_LOG_LEVEL"===r)ic(r,t,e);else if(Ys(r))nc(r,t,e);else if($s(r))rc(r,t,e);else{var o=e[r];null!=o&&(t[r]=String(o))}}return t}Array(32);var sc,cc=performance,uc="process.pid",lc="process.executable.name",pc="process.executable.path",fc="process.command",hc="process.command_line",dc="process.runtime.name",_c="process.runtime.version",vc="process.runtime.description",yc="service.name",gc="telemetry.sdk.name",mc="telemetry.sdk.language",Ec="telemetry.sdk.version",Tc=((sc={})[gc]="opentelemetry",sc[dc]="browser",sc[mc]="webjs",sc[Ec]="1.7.0",sc);var Sc,bc=Math.pow(10,9);function Oc(e){var t=e/1e3,n=Math.trunc(t);return[n,Number((t-n).toFixed(9))*bc]}function Rc(){var e=cc.timeOrigin;if("number"!=typeof e){var t=cc;e=t.timing&&t.timing.fetchStart}return e}function wc(e){var t=Oc(Rc()),n=Oc("number"==typeof e?e:cc.now()),r=t[0]+n[0],o=t[1]+n[1];return o>bc&&(o-=bc,r+=1),[r,o]}function Cc(e){return Math.round(1e6*e[0]+e[1]/1e3)}!function(e){e[e.SUCCESS=0]="SUCCESS",e[e.FAILED=1]="FAILED"}(Sc||(Sc={}));var Pc=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Ac=(function(){function e(e){var t;void 0===e&&(e={}),this._propagators=null!==(t=e.propagators)&&void 0!==t?t:[],this._fields=Array.from(new Set(this._propagators.map((function(e){return"function"==typeof e.fields?e.fields():[]})).reduce((function(e,t){return e.concat(t)}),[])))}e.prototype.inject=function(e,t,n){var r,o;try{for(var i=Pc(this._propagators),a=i.next();!a.done;a=i.next()){var s=a.value;try{s.inject(e,t,n)}catch(e){an.warn("Failed to inject with "+s.constructor.name+". Err: "+e.message)}}}catch(e){r={error:e}}finally{try{a&&!a.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}},e.prototype.extract=function(e,t,n){return this._propagators.reduce((function(e,r){try{return r.extract(e,t,n)}catch(e){an.warn("Failed to inject with "+r.constructor.name+". Err: "+e.message)}return e}),e)},e.prototype.fields=function(){return this._fields.slice()}}(),new RegExp("^(?:[a-z][_0-9a-z-*/]{0,255}|[a-z0-9][_0-9a-z-*/]{0,240}@[a-z][_0-9a-z-*/]{0,13})$")),Lc=/^[ -~]{0,255}[!-~]$/,Mc=/,|=/;var Ic=function(){function e(e){this._internalState=new Map,e&&this._parse(e)}return e.prototype.set=function(e,t){var n=this._clone();return n._internalState.has(e)&&n._internalState.delete(e),n._internalState.set(e,t),n},e.prototype.unset=function(e){var t=this._clone();return t._internalState.delete(e),t},e.prototype.get=function(e){return this._internalState.get(e)},e.prototype.serialize=function(){var e=this;return this._keys().reduce((function(t,n){return t.push(n+"="+e.get(n)),t}),[]).join(",")},e.prototype._parse=function(e){e.length>512||(this._internalState=e.split(",").reverse().reduce((function(e,t){var n=t.trim(),r=n.indexOf("=");if(-1!==r){var o=n.slice(0,r),i=n.slice(r+1,t.length);(function(e){return Ac.test(e)})(o)&&function(e){return Lc.test(e)&&!Mc.test(e)}(i)&&e.set(o,i)}return e}),new Map),this._internalState.size>32&&(this._internalState=new Map(Array.from(this._internalState.entries()).reverse().slice(0,32))))},e.prototype._keys=function(){return Array.from(this._internalState.keys()).reverse()},e.prototype._clone=function(){var t=new e;return t._internalState=new Map(this._internalState),t},e}(),Nc="traceparent",xc="tracestate",kc=new RegExp("^\\s?((?!ff)[\\da-f]{2})-((?![0]{32})[\\da-f]{32})-((?![0]{16})[\\da-f]{16})-([\\da-f]{2})(-.*)?\\s?$");var Uc;(function(){function e(){}e.prototype.inject=function(e,t,n){var r=rn.getSpanContext(e);if(r&&!Xs(e)&&It(r)){var o="00-"+r.traceId+"-"+r.spanId+"-0"+Number(r.traceFlags||ut.NONE).toString(16);n.set(t,Nc,o),r.traceState&&n.set(t,xc,r.traceState.serialize())}},e.prototype.extract=function(e,t,n){var r=n.get(t,Nc);if(!r)return e;var o=Array.isArray(r)?r[0]:r;if("string"!=typeof o)return e;var i=function(e){var t=kc.exec(e);return t?"00"===t[1]&&t[5]?null:{traceId:t[2],spanId:t[3],traceFlags:parseInt(t[4],16)}:null}(o);if(!i)return e;i.isRemote=!0;var a=n.get(t,xc);if(a){var s=Array.isArray(a)?a.join(","):a;i.traceState=new Ic("string"==typeof s?s:void 0)}return rn.setSpanContext(e,i)},e.prototype.fields=function(){return[Nc,xc]}})(),ct("OpenTelemetry SDK Context Key RPC_METADATA");!function(e){e.HTTP="http"}(Uc||(Uc={}));var Dc=function(){function e(){}return e.prototype.shouldSample=function(){return{decision:Ut.NOT_RECORD}},e.prototype.toString=function(){return"AlwaysOffSampler"},e}(),jc=function(){function e(){}return e.prototype.shouldSample=function(){return{decision:Ut.RECORD_AND_SAMPLED}},e.prototype.toString=function(){return"AlwaysOnSampler"},e}(),Bc=(function(){function e(e){var t,n,r,o;this._root=e.root,this._root||(Ws(new Error("ParentBasedSampler must have a root sampler configured")),this._root=new jc),this._remoteParentSampled=null!==(t=e.remoteParentSampled)&&void 0!==t?t:new jc,this._remoteParentNotSampled=null!==(n=e.remoteParentNotSampled)&&void 0!==n?n:new Dc,this._localParentSampled=null!==(r=e.localParentSampled)&&void 0!==r?r:new jc,this._localParentNotSampled=null!==(o=e.localParentNotSampled)&&void 0!==o?o:new Dc}e.prototype.shouldSample=function(e,t,n,r,o,i){var a=rn.getSpanContext(e);return a&&It(a)?a.isRemote?a.traceFlags&ut.SAMPLED?this._remoteParentSampled.shouldSample(e,t,n,r,o,i):this._remoteParentNotSampled.shouldSample(e,t,n,r,o,i):a.traceFlags&ut.SAMPLED?this._localParentSampled.shouldSample(e,t,n,r,o,i):this._localParentNotSampled.shouldSample(e,t,n,r,o,i):this._root.shouldSample(e,t,n,r,o,i)},e.prototype.toString=function(){return"ParentBased{root="+this._root.toString()+", remoteParentSampled="+this._remoteParentSampled.toString()+", remoteParentNotSampled="+this._remoteParentNotSampled.toString()+", localParentSampled="+this._localParentSampled.toString()+", localParentNotSampled="+this._localParentNotSampled.toString()+"}"}}(),function(){function e(e){void 0===e&&(e=0),this._ratio=e,this._ratio=this._normalize(e),this._upperBound=Math.floor(4294967295*this._ratio)}e.prototype.shouldSample=function(e,t){return{decision:Mt(t)&&this._accumulate(t)<this._upperBound?Ut.RECORD_AND_SAMPLED:Ut.NOT_RECORD}},e.prototype.toString=function(){return"TraceIdRatioBased{"+this._ratio+"}"},e.prototype._normalize=function(e){return"number"!=typeof e||isNaN(e)?0:e>=1?1:e<=0?0:e},e.prototype._accumulate=function(e){for(var t=0,n=0;n<e.length/8;n++){var r=8*n;t=(t^parseInt(e.slice(r,r+8),16))>>>0}return t}}(),Function.prototype.toString),Vc=(Bc.call(Object),function(e,t){}(Object.getPrototypeOf,Object),Object.prototype);Vc.hasOwnProperty,Symbol&&Symbol.toStringTag,Vc.toString;var Fc=function(){function e(){var e=this;this._promise=new Promise((function(t,n){e._resolve=t,e._reject=n}))}return Object.defineProperty(e.prototype,"promise",{get:function(){return this._promise},enumerable:!1,configurable:!0}),e.prototype.resolve=function(e){this._resolve(e)},e.prototype.reject=function(e){this._reject(e)},e}(),Xc=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},Gc=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},zc=(function(){function e(e,t){this._callback=e,this._that=t,this._isCalled=!1,this._deferred=new Fc}Object.defineProperty(e.prototype,"isCalled",{get:function(){return this._isCalled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"promise",{get:function(){return this._deferred.promise},enumerable:!1,configurable:!0}),e.prototype.call=function(){for(var e,t=this,n=[],r=0;r<arguments.length;r++)n[r]=arguments[r];if(!this._isCalled){this._isCalled=!0;try{Promise.resolve((e=this._callback).call.apply(e,Gc([this._that],Xc(n),!1))).then((function(e){return t._deferred.resolve(e)}),(function(e){return t._deferred.reject(e)}))}catch(e){this._deferred.reject(e)}}return this._deferred.promise}}(),function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a}),Hc=function(){function e(e,t,n){void 0===t&&(t=0),void 0===n&&(n=[0,0]),this.startTime=e,this._current=t,this.sampleTime=n}return e.prototype.record=function(e){this._current=e,this.sampleTime=wc()},e.prototype.setStartTime=function(e){this.startTime=e},e.prototype.toPointValue=function(){return this._current},e}(),qc=function(){function e(){this.kind=As.LAST_VALUE}return e.prototype.createAccumulation=function(e){return new Hc(e)},e.prototype.merge=function(e,t){var n=Cc(t.sampleTime)>=Cc(e.sampleTime)?t:e;return new Hc(e.startTime,n.toPointValue(),n.sampleTime)},e.prototype.diff=function(e,t){var n=Cc(t.sampleTime)>=Cc(e.sampleTime)?t:e;return new Hc(t.startTime,n.toPointValue(),n.sampleTime)},e.prototype.toMetricData=function(e,t,n,r){return{descriptor:e,aggregationTemporality:t,dataPointType:ms.GAUGE,dataPoints:n.map((function(e){var t=zc(e,2),n=t[0],o=t[1];return{attributes:n,startTime:o.startTime,endTime:r,value:o.toPointValue()}}))}},e}(),Kc=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},Wc=function(){function e(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=!1),this.startTime=e,this.monotonic=t,this._current=n,this.reset=r}return e.prototype.record=function(e){this.monotonic&&e<0||(this._current+=e)},e.prototype.setStartTime=function(e){this.startTime=e},e.prototype.toPointValue=function(){return this._current},e}(),Jc=function(){function e(e){this.monotonic=e,this.kind=As.SUM}return e.prototype.createAccumulation=function(e){return new Wc(e,this.monotonic)},e.prototype.merge=function(e,t){var n=e.toPointValue(),r=t.toPointValue();return t.reset?new Wc(t.startTime,this.monotonic,r,t.reset):new Wc(e.startTime,this.monotonic,n+r)},e.prototype.diff=function(e,t){var n=e.toPointValue(),r=t.toPointValue();return this.monotonic&&n>r?new Wc(t.startTime,this.monotonic,r,!0):new Wc(t.startTime,this.monotonic,r-n)},e.prototype.toMetricData=function(e,t,n,r){return{descriptor:e,aggregationTemporality:t,dataPointType:ms.SUM,dataPoints:n.map((function(e){var t=Kc(e,2),n=t[0],o=t[1];return{attributes:n,startTime:o.startTime,endTime:r,value:o.toPointValue()}})),isMonotonic:this.monotonic}},e}(),Qc=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Yc=function(){function e(){}return e.Drop=function(){return ru},e.Sum=function(){return ou},e.LastValue=function(){return iu},e.Histogram=function(){return au},e.Default=function(){return su},e}(),Zc=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Qc(t,e),t.prototype.createAggregator=function(e){return t.DEFAULT_INSTANCE},t.DEFAULT_INSTANCE=new Us,t}(Yc),$c=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Qc(t,e),t.prototype.createAggregator=function(e){switch(e.type){case ks.COUNTER:case ks.OBSERVABLE_COUNTER:case ks.HISTOGRAM:return t.MONOTONIC_INSTANCE;default:return t.NON_MONOTONIC_INSTANCE}},t.MONOTONIC_INSTANCE=new Jc(!0),t.NON_MONOTONIC_INSTANCE=new Jc(!1),t}(Yc),eu=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Qc(t,e),t.prototype.createAggregator=function(e){return t.DEFAULT_INSTANCE},t.DEFAULT_INSTANCE=new qc,t}(Yc),tu=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Qc(t,e),t.prototype.createAggregator=function(e){return t.DEFAULT_INSTANCE},t.DEFAULT_INSTANCE=new Vs([0,5,10,25,50,75,100,250,500,1e3],!0),t}(Yc),nu=(function(e){function t(t,n){void 0===n&&(n=!0);var r=e.call(this)||this;if(r._recordMinMax=n,void 0===t||0===t.length)throw new Error("HistogramAggregator should be created with boundaries.");var o=(t=(t=t.concat()).sort((function(e,t){return e-t}))).lastIndexOf(-1/0),i=t.indexOf(1/0);return-1===i&&(i=void 0),r._boundaries=t.slice(o+1,i),r}Qc(t,e),t.prototype.createAggregator=function(e){return new Vs(this._boundaries,this._recordMinMax)}}(Yc),function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Qc(t,e),t.prototype._resolve=function(e){switch(e.type){case ks.COUNTER:case ks.UP_DOWN_COUNTER:case ks.OBSERVABLE_COUNTER:case ks.OBSERVABLE_UP_DOWN_COUNTER:return ou;case ks.OBSERVABLE_GAUGE:return iu;case ks.HISTOGRAM:return au}return an.warn("Unable to recognize instrument type: "+e.type),ru},t.prototype.createAggregator=function(e){return this._resolve(e).createAggregator(e)},t}(Yc)),ru=new Zc,ou=new $c,iu=new eu,au=new tu,su=new nu,cu=function(e){return Yc.Default()},uu=function(e){return gs.CUMULATIVE},lu=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},pu=function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},fu=function(){function e(e){var t,n;this._shutdown=!1,this._aggregationSelector=null!==(t=null==e?void 0:e.aggregationSelector)&&void 0!==t?t:cu,this._aggregationTemporalitySelector=null!==(n=null==e?void 0:e.aggregationTemporalitySelector)&&void 0!==n?n:uu}return e.prototype.setMetricProducer=function(e){if(this._metricProducer)throw new Error("MetricReader can not be bound to a MeterProvider again.");this._metricProducer=e,this.onInitialized()},e.prototype.selectAggregation=function(e){return this._aggregationSelector(e)},e.prototype.selectAggregationTemporality=function(e){return this._aggregationTemporalitySelector(e)},e.prototype.onInitialized=function(){},e.prototype.collect=function(e){return lu(this,void 0,void 0,(function(){return pu(this,(function(t){if(void 0===this._metricProducer)throw new Error("MetricReader is not bound to a MetricProducer");if(this._shutdown)throw new Error("MetricReader is shutdown");return[2,this._metricProducer.collect({timeoutMillis:null==e?void 0:e.timeoutMillis})]}))}))},e.prototype.shutdown=function(e){return lu(this,void 0,void 0,(function(){return pu(this,(function(t){switch(t.label){case 0:return this._shutdown?(an.error("Cannot call shutdown twice."),[2]):null!=(null==e?void 0:e.timeoutMillis)?[3,2]:[4,this.onShutdown()];case 1:return t.sent(),[3,4];case 2:return[4,Ms(this.onShutdown(),e.timeoutMillis)];case 3:t.sent(),t.label=4;case 4:return this._shutdown=!0,[2]}}))}))},e.prototype.forceFlush=function(e){return lu(this,void 0,void 0,(function(){return pu(this,(function(t){switch(t.label){case 0:return this._shutdown?(an.warn("Cannot forceFlush on already shutdown MetricReader."),[2]):null!=(null==e?void 0:e.timeoutMillis)?[3,2]:[4,this.onForceFlush()];case 1:case 3:return t.sent(),[2];case 2:return[4,Ms(this.onForceFlush(),e.timeoutMillis)]}}))}))},e}(),hu=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),du=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},_u=function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},vu=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},yu=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},gu=(function(e){function t(t){var n,r,o,i,a=e.call(this,{aggregationSelector:null===(n=t.exporter.selectAggregation)||void 0===n?void 0:n.bind(t.exporter),aggregationTemporalitySelector:null===(r=t.exporter.selectAggregationTemporality)||void 0===r?void 0:r.bind(t.exporter)})||this;if(void 0!==t.exportIntervalMillis&&t.exportIntervalMillis<=0)throw Error("exportIntervalMillis must be greater than 0");if(void 0!==t.exportTimeoutMillis&&t.exportTimeoutMillis<=0)throw Error("exportTimeoutMillis must be greater than 0");if(void 0!==t.exportTimeoutMillis&&void 0!==t.exportIntervalMillis&&t.exportIntervalMillis<t.exportTimeoutMillis)throw Error("exportIntervalMillis must be greater than or equal to exportTimeoutMillis");return a._exportInterval=null!==(o=t.exportIntervalMillis)&&void 0!==o?o:6e4,a._exportTimeout=null!==(i=t.exportTimeoutMillis)&&void 0!==i?i:3e4,a._exporter=t.exporter,a}hu(t,e),t.prototype._runOnce=function(){return du(this,void 0,void 0,(function(){var e,t,n,r,o=this;return _u(this,(function(i){switch(i.label){case 0:return[4,this.collect({})];case 1:return e=i.sent(),t=e.resourceMetrics,(n=e.errors).length>0&&(r=an).error.apply(r,yu(["PeriodicExportingMetricReader: metrics collection errors"],vu(n),!1)),[2,new Promise((function(e,n){o._exporter.export(t,(function(t){var r;t.code!==Sc.SUCCESS?n(null!==(r=t.error)&&void 0!==r?r:new Error("PeriodicExportingMetricReader: metrics export failed (error "+t.error+")")):e()}))}))]}}))}))},t.prototype.onInitialized=function(){var e=this;this._interval=setInterval((function(){return du(e,void 0,void 0,(function(){var e;return _u(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,Ms(this._runOnce(),this._exportTimeout)];case 1:return t.sent(),[3,3];case 2:return(e=t.sent())instanceof Ls?(an.error("Export took longer than %s milliseconds and timed out.",this._exportTimeout),[2]):(Ws(e),[3,3]);case 3:return[2]}}))}))}),this._exportInterval),this._interval},t.prototype.onForceFlush=function(){return du(this,void 0,void 0,(function(){return _u(this,(function(e){switch(e.label){case 0:return[4,this._exporter.forceFlush()];case 1:return e.sent(),[2]}}))}))},t.prototype.onShutdown=function(){return du(this,void 0,void 0,(function(){return _u(this,(function(e){switch(e.label){case 0:return this._interval&&clearInterval(this._interval),[4,this._exporter.shutdown()];case 1:return e.sent(),[2]}}))}))}}(fu),function(){function e(e){this._shutdown=!1,this._metrics=[],this._aggregationTemporality=e}e.prototype.export=function(e,t){this._shutdown?setTimeout((function(){return t({code:Sc.FAILED})}),0):(this._metrics.push(e),setTimeout((function(){return t({code:Sc.SUCCESS})}),0))},e.prototype.getMetrics=function(){return this._metrics},e.prototype.forceFlush=function(){return Promise.resolve()},e.prototype.reset=function(){this._metrics=[]},e.prototype.selectAggregationTemporality=function(e){return this._aggregationTemporality},e.prototype.shutdown=function(){return this._shutdown=!0,Promise.resolve()}}(),function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")});!function(){function e(){this._shutdown=!1}e.prototype.export=function(t,n){if(!this._shutdown)return e._sendMetrics(t,n);setImmediate(n,{code:Sc.FAILED})},e.prototype.forceFlush=function(){return Promise.resolve()},e.prototype.selectAggregationTemporality=function(e){return gs.CUMULATIVE},e.prototype.shutdown=function(){return this._shutdown=!0,Promise.resolve()},e._sendMetrics=function(e,t){var n,r,o,i;try{for(var a=gu(e.scopeMetrics),s=a.next();!s.done;s=a.next()){var c=s.value;try{for(var u=(o=void 0,gu(c.metrics)),l=u.next();!l.done;l=u.next()){var p=l.value;console.dir({descriptor:p.descriptor,dataPointType:p.dataPointType,dataPoints:p.dataPoints})}}catch(e){o={error:e}}finally{try{l&&!l.done&&(i=u.return)&&i.call(u)}finally{if(o)throw o.error}}}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}t({code:Sc.SUCCESS})}}();var mu=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},Eu=function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Tu=(new(function(){function e(){}return e.prototype.detect=function(){return mu(this,void 0,void 0,(function(){return Eu(this,(function(e){return[2,new Tu({})]}))}))},e}()),function(){function e(e){this.attributes=e}return e.empty=function(){return e.EMPTY},e.default=function(){var t;return new e(((t={})[yc]="unknown_service",t[mc]=Tc[mc],t[gc]=Tc[gc],t[Ec]=Tc[Ec],t))},e.prototype.merge=function(t){return t&&Object.keys(t.attributes).length?new e(Object.assign({},this.attributes,t.attributes)):this},e.EMPTY=new e({}),e}()),Su=function(){return Su=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Su.apply(this,arguments)},bu=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},Ou=function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Ru=function(){function e(){}return e.prototype.detect=function(e){return bu(this,void 0,void 0,(function(){var t,n;return Ou(this,(function(r){return"undefined"!=typeof navigator?((n={})[dc]="browser",n[vc]="Web Browser",n[_c]=navigator.userAgent,t=n,[2,this._getResourceAttributes(t,e)]):[2,Tu.empty()]}))}))},e.prototype._getResourceAttributes=function(e,t){return""===e[_c]?(an.debug("BrowserDetector failed: Unable to find required browser resources. "),Tu.empty()):new Tu(Su({},e))},e}(),wu=(new Ru,function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))}),Cu=function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Pu=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Au=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},Lu=function(){function e(){this._MAX_LENGTH=255,this._COMMA_SEPARATOR=",",this._LABEL_KEY_VALUE_SPLITTER="=",this._ERROR_MESSAGE_INVALID_CHARS="should be a ASCII string with a length greater than 0 and not exceed "+this._MAX_LENGTH+" characters.",this._ERROR_MESSAGE_INVALID_VALUE="should be a ASCII string with a length not exceed "+this._MAX_LENGTH+" characters."}return e.prototype.detect=function(e){return wu(this,void 0,void 0,(function(){var e,t,n,r,o;return Cu(this,(function(i){var a;if(e={},a=ac(Js),t=Object.assign({},tc,a),n=t.OTEL_RESOURCE_ATTRIBUTES,r=t.OTEL_SERVICE_NAME,n)try{o=this._parseResourceAttributes(n),Object.assign(e,o)}catch(e){an.debug("EnvDetector failed: "+e.message)}return r&&(e[yc]=r),[2,new Tu(e)]}))}))},e.prototype._parseResourceAttributes=function(e){var t,n;if(!e)return{};var r={},o=e.split(this._COMMA_SEPARATOR,-1);try{for(var i=Pu(o),a=i.next();!a.done;a=i.next()){var s=a.value.split(this._LABEL_KEY_VALUE_SPLITTER,-1);if(2===s.length){var c=Au(s,2),u=c[0],l=c[1];if(u=u.trim(),l=l.trim().split('^"|"$').join(""),!this._isValidAndNotEmpty(u))throw new Error("Attribute key "+this._ERROR_MESSAGE_INVALID_CHARS);if(!this._isValid(l))throw new Error("Attribute value "+this._ERROR_MESSAGE_INVALID_VALUE);r[u]=l}}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}return r},e.prototype._isValid=function(e){return e.length<=this._MAX_LENGTH&&this._isPrintableString(e)},e.prototype._isPrintableString=function(e){for(var t=0;t<e.length;t++){var n=e.charAt(t);if(n<=" "||n>="~")return!1}return!0},e.prototype._isValidAndNotEmpty=function(e){return e.length>0&&this._isValid(e)},e}(),Mu=(new Lu,function(){return Mu=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},Mu.apply(this,arguments)}),Iu=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},Nu=function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},xu=function(){function e(){}return e.prototype.detect=function(e){return Iu(this,void 0,void 0,(function(){var t,n;return Nu(this,(function(r){return"object"!=typeof process?[2,Tu.empty()]:((n={})[uc]=process.pid,n[lc]=process.title||"",n[fc]=process.argv[1]||"",n[hc]=process.argv.join(" ")||"",n[_c]=process.versions.node,n[dc]="nodejs",n[vc]="Node.js",t=n,[2,this._getResourceAttributes(t,e)])}))}))},e.prototype._getResourceAttributes=function(e,t){return""===e[lc]||""===e[pc]||""===e[fc]||""===e[hc]||""===e[_c]?(an.debug("ProcessDetector failed: Unable to find required process resources. "),Tu.empty()):new Tu(Mu({},e))},e}(),ku=(new xu,function(){function e(){this._registeredViews=[]}return e.prototype.addView=function(e){this._registeredViews.push(e)},e.prototype.findViews=function(e,t){var n=this;return this._registeredViews.filter((function(r){return n._matchInstrument(r.instrumentSelector,e)&&n._matchMeter(r.meterSelector,t)}))},e.prototype._matchInstrument=function(e,t){return(void 0===e.getType()||t.type===e.getType())&&e.getNameFilter().match(t.name)},e.prototype._matchMeter=function(e,t){return e.getNameFilter().match(t.name)&&(void 0===t.version||e.getVersionFilter().match(t.version))&&(void 0===t.schemaUrl||e.getSchemaUrlFilter().match(t.schemaUrl))},e}()),Uu=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Du=function(){function e(e,t){this._writableMetricStorage=e,this._descriptor=t}return e.prototype._record=function(e,t,n){void 0===t&&(t={}),void 0===n&&(n=nn.active()),this._descriptor.valueType!==Qa.INT||Number.isInteger(e)||(an.warn("INT value type cannot accept a floating-point value for "+this._descriptor.name+", ignoring the fractional digits."),e=Math.trunc(e)),this._writableMetricStorage.record(e,t,n,wc())},e}(),ju=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Uu(t,e),t.prototype.add=function(e,t,n){this._record(e,t,n)},t}(Du),Bu=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Uu(t,e),t.prototype.add=function(e,t,n){e<0?an.warn("negative value provided to counter "+this._descriptor.name+": "+e):this._record(e,t,n)},t}(Du),Vu=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Uu(t,e),t.prototype.record=function(e,t,n){e<0?an.warn("negative value provided to histogram "+this._descriptor.name+": "+e):this._record(e,t,n)},t}(Du),Fu=function(){function e(e,t,n){this._observableRegistry=n,this._descriptor=e,this._metricStorages=t}return e.prototype.addCallback=function(e){this._observableRegistry.addCallback(e,this)},e.prototype.removeCallback=function(e){this._observableRegistry.removeCallback(e,this)},e}(),Xu=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Uu(t,e),t}(Fu),Gu=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Uu(t,e),t}(Fu),zu=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return Uu(t,e),t}(Fu);function Hu(e){return e instanceof Fu}var qu=function(){function e(e){this._meterSharedState=e}return e.prototype.createHistogram=function(e,t){var n=Ds(e,ks.HISTOGRAM,t),r=this._meterSharedState.registerMetricStorage(n);return new Vu(r,n)},e.prototype.createCounter=function(e,t){var n=Ds(e,ks.COUNTER,t),r=this._meterSharedState.registerMetricStorage(n);return new Bu(r,n)},e.prototype.createUpDownCounter=function(e,t){var n=Ds(e,ks.UP_DOWN_COUNTER,t),r=this._meterSharedState.registerMetricStorage(n);return new ju(r,n)},e.prototype.createObservableGauge=function(e,t){var n=Ds(e,ks.OBSERVABLE_GAUGE,t),r=this._meterSharedState.registerAsyncMetricStorage(n);return new Gu(n,r,this._meterSharedState.observableRegistry)},e.prototype.createObservableCounter=function(e,t){var n=Ds(e,ks.OBSERVABLE_COUNTER,t),r=this._meterSharedState.registerAsyncMetricStorage(n);return new Xu(n,r,this._meterSharedState.observableRegistry)},e.prototype.createObservableUpDownCounter=function(e,t){var n=Ds(e,ks.OBSERVABLE_UP_DOWN_COUNTER,t),r=this._meterSharedState.registerAsyncMetricStorage(n);return new zu(n,r,this._meterSharedState.observableRegistry)},e.prototype.addBatchObservableCallback=function(e,t){this._meterSharedState.observableRegistry.addBatchCallback(e,t)},e.prototype.removeBatchObservableCallback=function(e,t){this._meterSharedState.observableRegistry.removeBatchCallback(e,t)},e}(),Ku=function(){function e(e){this._instrumentDescriptor=e}return e.prototype.getInstrumentDescriptor=function(){return this._instrumentDescriptor},e.prototype.updateDescription=function(e){this._instrumentDescriptor=Ds(this._instrumentDescriptor.name,this._instrumentDescriptor.type,{description:e,valueType:this._instrumentDescriptor.valueType,unit:this._instrumentDescriptor.unit})},e}(),Wu=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Ju=function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Qu=function(){function e(e){this._hash=e,this._valueMap=new Map,this._keyMap=new Map}return e.prototype.get=function(e,t){return null!=t||(t=this._hash(e)),this._valueMap.get(t)},e.prototype.getOrDefault=function(e,t){var n=this._hash(e);if(this._valueMap.has(n))return this._valueMap.get(n);var r=t();return this._keyMap.has(n)||this._keyMap.set(n,e),this._valueMap.set(n,r),r},e.prototype.set=function(e,t,n){null!=n||(n=this._hash(e)),this._keyMap.has(n)||this._keyMap.set(n,e),this._valueMap.set(n,t)},e.prototype.has=function(e,t){return null!=t||(t=this._hash(e)),this._valueMap.has(t)},e.prototype.keys=function(){var e,t;return Ju(this,(function(n){switch(n.label){case 0:e=this._keyMap.entries(),t=e.next(),n.label=1;case 1:return!0===t.done?[3,3]:[4,[t.value[1],t.value[0]]];case 2:return n.sent(),t=e.next(),[3,1];case 3:return[2]}}))},e.prototype.entries=function(){var e,t;return Ju(this,(function(n){switch(n.label){case 0:e=this._valueMap.entries(),t=e.next(),n.label=1;case 1:return!0===t.done?[3,3]:[4,[this._keyMap.get(t.value[0]),t.value[1],t.value[0]]];case 2:return n.sent(),t=e.next(),[3,1];case 3:return[2]}}))},Object.defineProperty(e.prototype,"size",{get:function(){return this._valueMap.size},enumerable:!1,configurable:!0}),e}(),Yu=function(e){function t(){return e.call(this,Ps)||this}return Wu(t,e),t}(Qu),Zu=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},$u=function(){function e(e){this._aggregator=e,this._activeCollectionStorage=new Yu,this._cumulativeMemoStorage=new Yu}return e.prototype.record=function(e,t,n,r){var o=this,i=this._activeCollectionStorage.getOrDefault(t,(function(){return o._aggregator.createAccumulation(r)}));null==i||i.record(e)},e.prototype.batchCumulate=function(e,t){var n=this;Array.from(e.entries()).forEach((function(e){var r=Zu(e,3),o=r[0],i=r[1],a=r[2],s=n._aggregator.createAccumulation(t);null==s||s.record(i);var c=s;if(n._cumulativeMemoStorage.has(o,a)){var u=n._cumulativeMemoStorage.get(o,a);c=n._aggregator.diff(u,s)}n._cumulativeMemoStorage.set(o,s,a),n._activeCollectionStorage.set(o,c,a)}))},e.prototype.collect=function(){var e=this._activeCollectionStorage;return this._activeCollectionStorage=new Yu,e},e}(),el=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},tl=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},nl=function(){function e(e){this._aggregator=e,this._unreportedAccumulations=new Map,this._reportHistory=new Map}return e.prototype.buildMetrics=function(t,n,r,o,i){this._stashAccumulations(n,o);var a,s,c=this._getMergedUnreportedAccumulations(t),u=c;if(this._reportHistory.has(t)){var l=this._reportHistory.get(t),p=l.collectionTime;u=(a=l.aggregationTemporality)===gs.CUMULATIVE?e.merge(l.accumulations,c,this._aggregator):e.calibrateStartTime(l.accumulations,c,p)}else a=t.selectAggregationTemporality(r.type);return this._reportHistory.set(t,{accumulations:u,collectionTime:i,aggregationTemporality:a}),this._aggregator.toMetricData(r,a,(s=u,Array.from(s.entries())),i)},e.prototype._stashAccumulations=function(e,t){var n=this;e.forEach((function(e){var r=n._unreportedAccumulations.get(e);void 0===r&&(r=[],n._unreportedAccumulations.set(e,r)),r.push(t)}))},e.prototype._getMergedUnreportedAccumulations=function(t){var n,r,o=new Yu,i=this._unreportedAccumulations.get(t);if(this._unreportedAccumulations.set(t,[]),void 0===i)return o;try{for(var a=el(i),s=a.next();!s.done;s=a.next()){var c=s.value;o=e.merge(o,c,this._aggregator)}}catch(e){n={error:e}}finally{try{s&&!s.done&&(r=a.return)&&r.call(a)}finally{if(n)throw n.error}}return o},e.merge=function(e,t,n){for(var r=e,o=t.entries(),i=o.next();!0!==i.done;){var a=tl(i.value,3),s=a[0],c=a[1],u=a[2];if(e.has(s,u)){var l=e.get(s,u),p=n.merge(l,c);r.set(s,p,u)}else r.set(s,c,u);i=o.next()}return r},e.calibrateStartTime=function(e,t,n){var r,o;try{for(var i=el(e.keys()),a=i.next();!a.done;a=i.next()){var s=tl(a.value,2),c=s[0],u=s[1],l=t.get(c,u);null==l||l.setStartTime(n)}}catch(e){r={error:e}}finally{try{a&&!a.done&&(o=i.return)&&o.call(i)}finally{if(r)throw r.error}}return t},e}();var rl=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ol=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},il=function(e){function t(t,n,r){var o=e.call(this,t)||this;return o._attributesProcessor=r,o._deltaMetricStorage=new $u(n),o._temporalMetricStorage=new nl(n),o}return rl(t,e),t.prototype.record=function(e,t){var n=this,r=new Yu;Array.from(e.entries()).forEach((function(e){var t=ol(e,2),o=t[0],i=t[1];r.set(n._attributesProcessor.process(o),i)})),this._deltaMetricStorage.batchCumulate(r,t)},t.prototype.collect=function(e,t,n){var r=this._deltaMetricStorage.collect();return this._temporalMetricStorage.buildMetrics(e,t,this._instrumentDescriptor,r,n)},t}(Ku);function al(e,t){var n="";return e.unit!==t.unit&&(n+="\t- Unit '"+e.unit+"' does not match '"+t.unit+"'\n"),e.type!==t.type&&(n+="\t- Type '"+e.type+"' does not match '"+t.type+"'\n"),e.valueType!==t.valueType&&(n+="\t- Value Type '"+e.valueType+"' does not match '"+t.valueType+"'\n"),e.description!==t.description&&(n+="\t- Description '"+e.description+"' does not match '"+t.description+"'\n"),n}function sl(e,t){return e.valueType!==t.valueType?function(e,t){return"\t- use valueType '"+e.valueType+"' on instrument creation or use an instrument name other than '"+t.name+"'"}(e,t):e.unit!==t.unit?function(e,t){return"\t- use unit '"+e.unit+"' on instrument creation or use an instrument name other than '"+t.name+"'"}(e,t):e.type!==t.type?function(e,t){var n={name:t.name,type:t.type},r=JSON.stringify(n);return"\t- create a new view with a name other than '"+e.name+"' and InstrumentSelector '"+r+"'"}(e,t):e.description!==t.description?function(e,t){var n={name:t.name,type:t.type},r=JSON.stringify(n);return"\t- create a new view with a name other than '"+e.name+"' and InstrumentSelector '"+r+"'\n    \t- OR - create a new view with the name "+e.name+" and description '"+e.description+"' and InstrumentSelector "+r+"\n    \t- OR - create a new view with the name "+t.name+" and description '"+e.description+"' and InstrumentSelector "+r}(e,t):""}var cl=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},ul=function(){function e(){this._sharedRegistry=new Map,this._perCollectorRegistry=new Map}return e.create=function(){return new e},e.prototype.getStorages=function(e){var t,n,r,o,i=[];try{for(var a=cl(this._sharedRegistry.values()),s=a.next();!s.done;s=a.next()){var c=s.value;i=i.concat(c)}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}var u=this._perCollectorRegistry.get(e);if(null!=u)try{for(var l=cl(u.values()),p=l.next();!p.done;p=l.next()){c=p.value;i=i.concat(c)}}catch(e){r={error:e}}finally{try{p&&!p.done&&(o=l.return)&&o.call(l)}finally{if(r)throw r.error}}return i},e.prototype.register=function(e){this._registerStorage(e,this._sharedRegistry)},e.prototype.registerForCollector=function(e,t){var n=this._perCollectorRegistry.get(e);null==n&&(n=new Map,this._perCollectorRegistry.set(e,n)),this._registerStorage(t,n)},e.prototype.findOrUpdateCompatibleStorage=function(e){var t=this._sharedRegistry.get(e.name);return void 0===t?null:this._findOrUpdateCompatibleStorage(e,t)},e.prototype.findOrUpdateCompatibleCollectorStorage=function(e,t){if(void 0===this._perCollectorRegistry.get(e))return null;var n=this._sharedRegistry.get(t.name);return void 0===n?null:this._findOrUpdateCompatibleStorage(t,n)},e.prototype._registerStorage=function(e,t){var n=e.getInstrumentDescriptor(),r=t.get(n.name);void 0!==r?r.push(e):t.set(n.name,[e])},e.prototype._findOrUpdateCompatibleStorage=function(e,t){var n,r,o,i,a=null;try{for(var s=cl(t),c=s.next();!c.done;c=s.next()){var u=c.value,l=u.getInstrumentDescriptor();i=e,(o=l).name===i.name&&o.unit===i.unit&&o.type===i.type&&o.valueType===i.valueType?(l.description!==e.description&&(e.description.length>l.description.length&&u.updateDescription(e.description),an.warn("A view or instrument with the name ",e.name," has already been registered, but has a different description and is incompatible with another registered view.\n","Details:\n",al(l,e),"The longer description will be used.\nTo resolve the conflict:",sl(l,e))),a=u):an.warn("A view or instrument with the name ",e.name," has already been registered and is incompatible with another registered view.\n","Details:\n",al(l,e),"To resolve the conflict:\n",sl(l,e))}}catch(e){n={error:e}}finally{try{c&&!c.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return a},e}(),ll=function(){function e(e){this._backingStorages=e}return e.prototype.record=function(e,t,n,r){this._backingStorages.forEach((function(o){o.record(e,t,n,r)}))},e}(),pl=function(){function e(e){this._descriptor=e,this._buffer=new Yu}return e.prototype.observe=function(e,t){void 0===t&&(t={}),this._descriptor.valueType!==Qa.INT||Number.isInteger(e)||(an.warn("INT value type cannot accept a floating-point value for "+this._descriptor.name+", ignoring the fractional digits."),e=Math.trunc(e)),this._buffer.set(t,e)},e}(),fl=function(){function e(){this._buffer=new Map}return e.prototype.observe=function(e,t,n){if(void 0===n&&(n={}),Hu(e)){var r=this._buffer.get(e);null==r&&(r=new Yu,this._buffer.set(e,r)),e._descriptor.valueType!==Qa.INT||Number.isInteger(t)||(an.warn("INT value type cannot accept a floating-point value for "+e._descriptor.name+", ignoring the fractional digits."),t=Math.trunc(t)),r.set(n,t)}},e}(),hl=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},dl=function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},_l=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},vl=function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},yl=function(){function e(){this._callbacks=[],this._batchCallbacks=[]}return e.prototype.addCallback=function(e,t){this._findCallback(e,t)>=0||this._callbacks.push({callback:e,instrument:t})},e.prototype.removeCallback=function(e,t){var n=this._findCallback(e,t);n<0||this._callbacks.splice(n,1)},e.prototype.addBatchCallback=function(e,t){var n=new Set(t.filter(Hu));0!==n.size?this._findBatchCallback(e,n)>=0||this._batchCallbacks.push({callback:e,instruments:n}):an.error("BatchObservableCallback is not associated with valid instruments",t)},e.prototype.removeBatchCallback=function(e,t){var n=new Set(t.filter(Hu)),r=this._findBatchCallback(e,n);r<0||this._batchCallbacks.splice(r,1)},e.prototype.observe=function(e,t){return hl(this,void 0,void 0,(function(){var n,r,o;return dl(this,(function(i){switch(i.label){case 0:return n=this._observeCallbacks(e,t),r=this._observeBatchCallbacks(e,t),[4,Is(vl(vl([],_l(n),!1),_l(r),!1))];case 1:return o=i.sent(),[2,o.filter(Ns).map((function(e){return e.reason}))]}}))}))},e.prototype._observeCallbacks=function(e,t){var n=this;return this._callbacks.map((function(r){var o=r.callback,i=r.instrument;return hl(n,void 0,void 0,(function(){var n,r;return dl(this,(function(a){switch(a.label){case 0:return n=new pl(i._descriptor),r=Promise.resolve(o(n)),null!=t&&(r=Ms(r,t)),[4,r];case 1:return a.sent(),i._metricStorages.forEach((function(t){t.record(n._buffer,e)})),[2]}}))}))}))},e.prototype._observeBatchCallbacks=function(e,t){var n=this;return this._batchCallbacks.map((function(r){var o=r.callback,i=r.instruments;return hl(n,void 0,void 0,(function(){var n,r;return dl(this,(function(a){switch(a.label){case 0:return n=new fl,r=Promise.resolve(o(n)),null!=t&&(r=Ms(r,t)),[4,r];case 1:return a.sent(),i.forEach((function(t){var r=n._buffer.get(t);null!=r&&t._metricStorages.forEach((function(t){t.record(r,e)}))})),[2]}}))}))}))},e.prototype._findCallback=function(e,t){return this._callbacks.findIndex((function(n){return n.callback===e&&n.instrument===t}))},e.prototype._findBatchCallback=function(e,t){return this._batchCallbacks.findIndex((function(n){return n.callback===e&&function(e,t){var n,r;if(e.size!==t.size)return!1;try{for(var o=ws(e),i=o.next();!i.done;i=o.next()){var a=i.value;if(!t.has(a))return!1}}catch(e){n={error:e}}finally{try{i&&!i.done&&(r=o.return)&&r.call(o)}finally{if(n)throw n.error}}return!0}(n.instruments,t)}))},e}(),gl=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),ml=function(e){function t(t,n,r){var o=e.call(this,t)||this;return o._attributesProcessor=r,o._deltaMetricStorage=new $u(n),o._temporalMetricStorage=new nl(n),o}return gl(t,e),t.prototype.record=function(e,t,n,r){t=this._attributesProcessor.process(t,n),this._deltaMetricStorage.record(e,t,n,r)},t.prototype.collect=function(e,t,n){var r=this._deltaMetricStorage.collect();return this._temporalMetricStorage.buildMetrics(e,t,this._instrumentDescriptor,r,n)},t}(Ku),El=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Tl=function(){function e(){}return e.Noop=function(){return bl},e}(),Sl=function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return El(t,e),t.prototype.process=function(e,t){return e},t}(Tl),bl=(function(e){function t(t){var n=e.call(this)||this;return n._allowedAttributeNames=t,n}El(t,e),t.prototype.process=function(e,t){var n=this,r={};return Object.keys(e).filter((function(e){return n._allowedAttributeNames.includes(e)})).forEach((function(t){return r[t]=e[t]})),r}}(Tl),new Sl),Ol=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},Rl=function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},wl=function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},Cl=function(){function e(e,t){this._meterProviderSharedState=e,this._instrumentationScope=t,this.metricStorageRegistry=new ul,this.observableRegistry=new yl,this.meter=new qu(this)}return e.prototype.registerMetricStorage=function(e){var t=this._registerMetricStorage(e,ml);return 1===t.length?t[0]:new ll(t)},e.prototype.registerAsyncMetricStorage=function(e){return this._registerMetricStorage(e,il)},e.prototype.collect=function(e,t,n){return Ol(this,void 0,void 0,(function(){var r,o,i=this;return Rl(this,(function(a){switch(a.label){case 0:return[4,this.observableRegistry.observe(t,null==n?void 0:n.timeoutMillis)];case 1:return r=a.sent(),o=Array.from(this.metricStorageRegistry.getStorages(e)).map((function(n){return n.collect(e,i._meterProviderSharedState.metricCollectors,t)})).filter(Cs),[2,{scopeMetrics:{scope:this._instrumentationScope,metrics:o.filter(Cs)},errors:r}]}}))}))},e.prototype._registerMetricStorage=function(e,t){var n=this,r=this._meterProviderSharedState.viewRegistry.findViews(e,this._instrumentationScope).map((function(r){var o=function(e,t){var n,r;return{name:null!==(n=e.name)&&void 0!==n?n:t.name,description:null!==(r=e.description)&&void 0!==r?r:t.description,type:t.type,unit:t.unit,valueType:t.valueType}}(r,e),i=n.metricStorageRegistry.findOrUpdateCompatibleStorage(o);if(null!=i)return i;var a=r.aggregation.createAggregator(o),s=new t(o,a,r.attributesProcessor);return n.metricStorageRegistry.register(s),s}));if(0===r.length){var o=this._meterProviderSharedState.selectAggregations(e.type).map((function(r){var o=wl(r,2),i=o[0],a=o[1],s=n.metricStorageRegistry.findOrUpdateCompatibleCollectorStorage(i,e);if(null!=s)return s;var c=a.createAggregator(e),u=new t(e,c,Tl.Noop());return n.metricStorageRegistry.registerForCollector(i,u),u}));r=r.concat(o)}return r},e}(),Pl=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Al=function(){function e(e){this.resource=e,this.viewRegistry=new ku,this.metricCollectors=[],this.meterSharedStates=new Map}return e.prototype.getMeterSharedState=function(e){var t=function(e){var t,n;return e.name+":"+(null!==(t=e.version)&&void 0!==t?t:"")+":"+(null!==(n=e.schemaUrl)&&void 0!==n?n:"")}(e),n=this.meterSharedStates.get(t);return null==n&&(n=new Cl(this,e),this.meterSharedStates.set(t,n)),n},e.prototype.selectAggregations=function(e){var t,n,r=[];try{for(var o=Pl(this.metricCollectors),i=o.next();!i.done;i=o.next()){var a=i.value;r.push([a,a.selectAggregation(e)])}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return r},e}(),Ll=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},Ml=function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},Il=function(){function e(e,t){this._sharedState=e,this._metricReader=t}return e.prototype.collect=function(e){return Ll(this,void 0,void 0,(function(){var t,n,r,o=this;return Ml(this,(function(i){switch(i.label){case 0:return t=wc(),n=Array.from(this._sharedState.meterSharedStates.values()).map((function(n){return n.collect(o,t,e)})),[4,Promise.all(n)];case 1:return r=i.sent(),[2,{resourceMetrics:{resource:this._sharedState.resource,scopeMetrics:r.map((function(e){return e.scopeMetrics}))},errors:xs(r,(function(e){return e.errors}))}]}}))}))},e.prototype.forceFlush=function(e){return Ll(this,void 0,void 0,(function(){return Ml(this,(function(t){switch(t.label){case 0:return[4,this._metricReader.forceFlush(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.shutdown=function(e){return Ll(this,void 0,void 0,(function(){return Ml(this,(function(t){switch(t.label){case 0:return[4,this._metricReader.shutdown(e)];case 1:return t.sent(),[2]}}))}))},e.prototype.selectAggregationTemporality=function(e){return this._metricReader.selectAggregationTemporality(e)},e.prototype.selectAggregation=function(e){return this._metricReader.selectAggregation(e)},e}(),Nl=function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{c(r.next(e))}catch(e){i(e)}}function s(e){try{c(r.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}c((r=r.apply(e,t||[])).next())}))},xl=function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}},kl=function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},Ul=(function(){function e(e){var t,n,r;if(this._shutdown=!1,this._sharedState=new Al(null!==(r=null==e?void 0:e.resource)&&void 0!==r?r:Tu.empty()),null!=(null==e?void 0:e.views)&&e.views.length>0)try{for(var o=kl(e.views),i=o.next();!i.done;i=o.next()){var a=i.value;this._sharedState.viewRegistry.addView(a)}}catch(e){t={error:e}}finally{try{i&&!i.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}}e.prototype.getMeter=function(e,t,n){return void 0===t&&(t=""),void 0===n&&(n={}),this._shutdown?(an.warn("A shutdown MeterProvider cannot provide a Meter"),ss):this._sharedState.getMeterSharedState({name:e,version:t,schemaUrl:n.schemaUrl}).meter},e.prototype.addMetricReader=function(e){var t=new Il(this._sharedState,e);e.setMetricProducer(t),this._sharedState.metricCollectors.push(t)},e.prototype.shutdown=function(e){return Nl(this,void 0,void 0,(function(){return xl(this,(function(t){switch(t.label){case 0:return this._shutdown?(an.warn("shutdown may only be called once per MeterProvider"),[2]):(this._shutdown=!0,[4,Promise.all(this._sharedState.metricCollectors.map((function(t){return t.shutdown(e)})))]);case 1:return t.sent(),[2]}}))}))},e.prototype.forceFlush=function(e){return Nl(this,void 0,void 0,(function(){return xl(this,(function(t){switch(t.label){case 0:return this._shutdown?(an.warn("invalid attempt to force flush after MeterProvider shutdown"),[2]):[4,Promise.all(this._sharedState.metricCollectors.map((function(t){return t.forceFlush(e)})))];case 1:return t.sent(),[2]}}))}))}}(),/[\^$\\.+?()[\]{}|]/g),Dl=function(){function e(t){"*"===t?(this._matchAll=!0,this._regexp=/.*/):(this._matchAll=!1,this._regexp=new RegExp(e.escapePattern(t)))}return e.prototype.match=function(e){return!!this._matchAll||this._regexp.test(e)},e.escapePattern=function(e){return"^"+e.replace(Ul,"\\$&").replace("*",".*")+"$"},e.hasWildcard=function(e){return e.includes("*")},e}(),jl=function(){function e(e){this._matchAll=void 0===e,this._pattern=e}return e.prototype.match=function(e){return!!this._matchAll||e===this._pattern},e}();(function(){function e(e){var t;this._nameFilter=new Dl(null!==(t=null==e?void 0:e.name)&&void 0!==t?t:"*"),this._type=null==e?void 0:e.type}e.prototype.getType=function(){return this._type},e.prototype.getNameFilter=function(){return this._nameFilter}})(),function(){function e(e){this._nameFilter=new jl(null==e?void 0:e.name),this._versionFilter=new jl(null==e?void 0:e.version),this._schemaUrlFilter=new jl(null==e?void 0:e.schemaUrl)}e.prototype.getNameFilter=function(){return this._nameFilter},e.prototype.getVersionFilter=function(){return this._versionFilter},e.prototype.getSchemaUrlFilter=function(){return this._schemaUrlFilter}}();var Bl,Vl,Fl=function(){var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};return function(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}}(),Xl="v1/traces",Gl=function(e){function t(t){void 0===t&&(t={});var n,r=e.call(this,t)||this;return r._headers=Object.assign(r._headers,"string"!=typeof(n=Vo().OTEL_EXPORTER_OTLP_TRACES_HEADERS)||0===n.length?{}:n.split(So).map((function(e){return Ro(e)})).filter((function(e){return void 0!==e&&e.value.length>0})).reduce((function(e,t){return e[t.key]=t.value,e}),{})),r}return Fl(t,e),t.prototype.convert=function(e){return function(e,t){return{resourceSpans:Ja(e,t)}}(e,!0)},t.prototype.getDefaultUrl=function(e){return"string"==typeof e.url?e.url:Vo().OTEL_EXPORTER_OTLP_TRACES_ENDPOINT.length>0?(t=Vo().OTEL_EXPORTER_OTLP_TRACES_ENDPOINT,n=Xl,t.includes(n)||t.endsWith("/")||(t+="/"),t):Vo().OTEL_EXPORTER_OTLP_ENDPOINT.length>0?function(e,t){return e.endsWith("/")||(e+="/"),e+t}(Vo().OTEL_EXPORTER_OTLP_ENDPOINT,Xl):"http://localhost:4318/v1/traces";var t,n},t}(ca),zl="http://localhost:4318/v1/traces",Hl={init:function(e){var t;Vl||(e.url=e.url||zl,e.webSDKVersion=e.webSDKVersion||"unknown",(Bl=new mo({resource:new Rn((t={},t[gn]="smwebsdk",t[mn]=e.webSDKVersion,t))})).addSpanProcessor(new Zn(new Gl({url:e.url,headers:{Authorization:"Bearer "+e.jwt}}))),Bl.register(),Vl=Bl.getTracer("smwebsdk"))},isInitialized:function(){return!!Vl},getTracer:function(){return Vl},defaultUrl:zl};Object.freeze(Hl);var ql="undefined"!=typeof process?"15.7.0":"unknown";function Kl(e,t,n){return void 0===t&&(t={}),M(this,void 0,void 0,(function(){var r,o,i,a,s,c;return I(this,(function(u){switch(u.label){case 0:r=[],o=t.maxRetries||50,i=t.delayMs||200,s=0,u.label=1;case 1:if(!(s<o))return[3,8];u.label=2;case 2:return u.trys.push([2,4,,6]),[4,e()];case 3:return a=u.sent(),n.connectionResult={message:"success",value:a,retries:r},[3,6];case 4:if(c=u.sent(),r.push(c),n.connectionResult={message:"failed",retries:r},c instanceof Error&&"noSessionToResume"===c.name&&Jl(),!(c instanceof Error)||"noScene"!==c.name)throw c;if(r.length===o)throw console.warn("Retry gave up after ".concat(o," retries:\n").concat(r.map((function(e){return e instanceof Error?e.message:e.toString()})).join("\n"))),c;return[4,(l=i,new Promise((function(e){return setTimeout((function(){return e()}),l)})))];case 5:return u.sent(),[3,7];case 6:return[3,8];case 7:return s++,[3,1];case 8:return[2,a]}var l}))}))}function Wl(){return{server:sessionStorage.getItem("sm-server"),resumeSessionId:sessionStorage.getItem("sm-session-id"),savedApiKey:sessionStorage.getItem("sm-api-key")}}function Jl(){sessionStorage.removeItem("sm-server"),sessionStorage.removeItem("sm-session-id"),sessionStorage.removeItem("sm-api-key")}var Ql,Yl=function(){function e(e,t,n,r,o,i,a){void 0===t&&(t=!1),void 0===n&&(n=z.MicrophoneAndCamera),void 0===r&&(r=z.Microphone);var s=this;if(this._onConversationResultEvents={},this._onSpeechMarkerEvents={},this._session=void 0,this._isWebSocketOnly=!1,this._transactionId=0,this._pendingResponses={},this._microphoneUnmuteTimer=void 0,this._echoCancellationEnabled=!0,this._serverControlledCameras=!1,this._stopSpeakingWhenNotVisible=!0,this._loggingConfig={session:{},contentAwareness:{}},this._logger=new B,this._tracerOptions={disableTracing:!1,parentCtx:pt,url:Hl.defaultUrl},this._sessionResumeEnabled=!1,this._isResumedSession=!1,this._sendMetadata={pageUrl:!1},this._onMicrophoneActive=new C,this._onCameraActive=new C,this.currentPersonaId=1,this.version={webSdk:ql,platformSdk:"unknown"},this.iosVisibilityChange=function(){var e="visible"===document.visibilityState;setTimeout((function(){s._session&&s._session.sendRtcEvent("ui",{visible:e})}),500)},this.stopSpeakingWhenNotVisible=function(){"visible"!==document.visibilityState&&s.sendRequest("stopSpeaking",{personaId:s.currentPersonaId})},this.stopSpeakingWhenUnloaded=function(){s.sendRequest("stopSpeaking",{personaId:s.currentPersonaId})},this.isSceneOptions(e)){var c=e;this._videoElement=c.videoElement,this._apiKey=c.apiKey,this._audioOnly=c.audioOnly||t,!1===c.stopSpeakingWhenNotVisible&&(this._stopSpeakingWhenNotVisible=!1),this._requestedUserMedia=sn(c.requestedMediaDevices,n),this._requiredUserMedia=sn(c.requiredMediaDevices,r),this.contentAwarenessDebounceTime=c.contentAwarenessDebounceTime,this._loggingConfig=L(L({},this._loggingConfig),c.loggingConfig||{}),c.sendMetadata&&(this._sendMetadata=c.sendMetadata),c.tracerOptions&&(this._tracerOptions=c.tracerOptions)}else this._videoElement=e,this._audioOnly=t,this._requestedUserMedia=n,this._requiredUserMedia=r,this.contentAwarenessDebounceTime=o,this._loggingConfig=L(L({},this._loggingConfig),i),a&&(this._tracerOptions=a);this._logger=new B(this._loggingConfig.session.minLogLevel,this._loggingConfig.session.enabled),this._onStateEvent=new C,this._onStateEvent.addListener((function(e,t){s._onState&&s._onState(e,t)})),this._onRecognizeResultsEvent=new C,this._onRecognizeResultsEvent.addListener((function(e,t,n,r){s._onRecognizeResults&&s._onRecognizeResults(e,t,n,r)})),this._onDisconnectedEvent=new C,this._onDisconnectedEvent.addListener((function(e,t,n){Jl(),s.cleanupEventListeners(),s._onDisconnected&&s._onDisconnected(e,t,n)})),this._onUserTextEvent=new C,this._onUserTextEvent.addListener((function(e,t){s._onUserText&&s._onUserText(e,t)})),this._onDemoModeEvent=new C,this._underRuntimeHost=Boolean(window.SmIsUnderRuntimeHost);var u=new Uint32Array(3);window.crypto.getRandomValues(u),this._sceneId=u.toString().replace(/,/g,"-"),this.conversation=new hn,this.connectionState=new vn,this._metadataSender=new dn(this),this._logger.log("debug","websdk version:",this.version.webSdk)}return e.prototype.isSceneOptions=function(e){var t=!!e,n=!!(null==e?void 0:e.tagName);return t&&!n},e.prototype.connectionValid=function(){return!!this._underRuntimeHost||!(!this._session||!this._session.serverConnection)},e.prototype.isConnected=function(){return!!(this.connectionValid()&&this._session&&this._session.serverConnection&&this._session.serverConnection.readyState===this._session.serverConnection.OPEN)},e.prototype.keepAlive=function(){this._session&&null!==this._session.peerConnection&&this._session.sendRtcEvent("keepAlive",{})},e.prototype.disconnect=function(){var e,t;Jl(),this.cleanupEventListeners(),this.connectionState.reset(),this.conversation.reset(),null===(e=this.contentAwareness)||void 0===e||e.disconnect(),this._metadataSender.disconnect(),null===(t=this._session)||void 0===t||t.close(!0),this._session=void 0},e.prototype.connect=function(e,t,n,r){var o,i,a;return M(this,void 0,void 0,(function(){var s,c,u,l,p,f,h,d,_,v,y,g=this;return I(this,(function(m){switch(m.label){case 0:return s=Date.now(),c=this.connectArgsToConfig(e,t,n,r),l=function(e){null==u||u.addEvent(e.name)},this.connectionState.onConnectionStateUpdated.addListener(l),this._underRuntimeHost?(this._session=new G(this._videoElement,this._logger),[3,8]):[3,1];case 1:if(p=c.tokenServerUri||c.tokenServerAccessToken,this._apiKey&&p&&this._logger.log("warn","You are trying to connect via an API key and a token server. Please use one or the other"),!this._apiKey||p)return[3,6];m.label=2;case 2:return m.trys.push([2,5,,6]),[4,this.fetchAuthConfig(this._apiKey)];case 3:return[4,m.sent().json()];case 4:return f=m.sent(),h=Wl().server,c.tokenServerUri=f.url,c.tokenServerAccessToken=f.jwt,h&&(c.tokenServerUri=cn(f.url)+"server/"+h),[3,6];case 5:throw(d=m.sent())instanceof Error&&"Broken API key"===d.message?this._logger.log("error","Broken API key. Please check your key or re copy the key from DDNA Studio."):this._logger.log("error","Invalid API key: Please check your key configuration in DDNA Studio. For more information click here https://soulmachines-support.atlassian.net/wiki/spaces/SSAS/pages/1320058919/Connecting+Using+API+Keys#Troubleshooting"),V("Invalid API key","serverConnectionFailed");case 6:if(!c.tokenServerUri||!c.tokenServerAccessToken)throw V("Please authenticate via an API key or with a serverUri and accessToken","serverConnectionFailed");return[4,this.initializeTracer(c.tokenServerUri,c.tokenServerAccessToken)];case 7:_=m.sent(),v=_.initTracerStartTime,y=_.initTracerEndTime,u=null===(a=null===(i=null===(o=Hl.getTracer())||void 0===o?void 0:o.startSpan("createSessionAndConnect"))||void 0===i?void 0:i.setAttribute("sm.websdk.connection.pretraceinitduration.milliseconds",v-s))||void 0===a?void 0:a.setAttribute("sm.websdk.connection.traceinitduration.milliseconds",y-v),this._isWebSocketOnly?this._session=new Z(c.tokenServerUri,c.tokenServerAccessToken,this._logger):this._session=new Y(this._videoElement,c.tokenServerUri,c.userText,c.tokenServerAccessToken,this._audioOnly,this._requestedUserMedia,this._requiredUserMedia,this._echoCancellationEnabled,this._logger,this.connectionState),m.label=8;case 8:if(!this._session)throw V("Failed to create session","unknown");return this._session.onConnected=this.sessionConnected.bind(this),this._session.onMessage=this.onMessage.bind(this),this._session.onClose=this.sessionClosed.bind(this),this._session.onUserText=this.rtcUserText.bind(this),"microphoneActiveCallbacks"in this._session&&(this._session.microphoneActiveCallbacks=this._onMicrophoneActive),"cameraActiveCallbacks"in this._session&&(this._session.cameraActiveCallbacks=this._onCameraActive),this._session.features.isIos&&document.addEventListener("visibilitychange",this.iosVisibilityChange),[4,Kl((function(){return M(g,void 0,void 0,(function(){return I(this,(function(e){switch(e.label){case 0:return[4,this._session.connect()];case 1:return[2,e.sent()]}}))}))}),c.retryOptions,this).finally((function(){g.connectionState.onConnectionStateUpdated.removeListener(l),null==u||u.end()}))];case 9:return[2,m.sent()]}}))}))},e.prototype.initializeTracer=function(e,t){return M(this,void 0,Promise,(function(){var n,r,o;return I(this,(function(i){switch(i.label){case 0:if(n=Date.now(),this._tracerOptions.disableTracing||Hl.isInitialized())return[3,4];i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.initTelemetryToken({tokenServerUri:e,authToken:t})];case 2:return i.sent(),[3,4];case 3:return r=i.sent(),o="Could not initialize tracer telemetry token: ",r instanceof ReferenceError&&"fetch is not defined"===r.message?this._logger.log("debug",o+r.name+": "+r.message):r instanceof Error?this._logger.log("warn",o+r.name+": "+r.message):this._logger.log("warn",o+"unknown error type"),[3,4];case 4:return[2,{initTracerStartTime:n,initTracerEndTime:Date.now()}]}}))}))},e.prototype.initTelemetryToken=function(e){var t=e.tokenServerUri,n=e.authToken;return M(this,void 0,Promise,(function(){var e,r,o,i;return I(this,(function(a){switch(a.label){case 0:return"api/telemetry/jwt",e="api/telemetry/v1/traces",(r=cn(t.replace(/^wss:\/\//,"https://")))?[4,fetch(r+"api/telemetry/jwt",{headers:{Authorization:"Bearer "+n}})]:(this._logger.log("debug","Could not initialize tracer telemetry token: invalid token server URI"),[2]);case 1:return(o=a.sent())?o.ok?[4,o.json()]:(this._logger.log("warn","Failed to fetch otel token: "+o.status+": "+o.statusText),[2]):(this._logger.log("warn","Failed to receive response from otel token endpoint"),[2]);case 2:if(!(i=a.sent()).success)return this._logger.log("warn","Failed: otel response not successful"),[2];try{Hl.init({jwt:i.telemetryJwt,url:r+e,webSDKVersion:this.version.webSdk}),this._logger.log("log","Telemetry initialized")}catch(e){e instanceof Error?this._logger.log("warn","Failed to initialize tracer: "+e.message):this._logger.log("warn","Failed to initialize tracer: unknown error")}return[2]}}))}))},e.prototype.onMessage=function(e){if("scene"!==e.category);else{var t=e;this.onSceneMessage(t)}},e.prototype.sendOnewaySceneRequest=function(e,t){if(this._session){var n={name:e,body:t,category:W.Scene,kind:J.Request};this._session.sendMessage(n)}},e.prototype.sendRequest=function(e,t){var n=this;return void 0===t&&(t={}),new Promise((function(r,o){if(n._session){var i=n._sceneId+"_"+ ++n._transactionId,a={transaction:i,name:e,body:t,category:W.Scene,kind:J.Request},s={resolve:r,reject:o};n._pendingResponses[i]=s,n._session&&n._session.sendMessage(a)}else o(V("No session available","noSession"))}))},e.prototype.onSceneMessage=function(e){var t,n,r,o=e.name,i=e.body,a=e.kind,s=e.status,c=e.transaction;if(i&&"state"===o){var u=i;this._onStateEvent.call(this,u),(null===(t=u.scene)||void 0===t?void 0:t.featureFlags)&&this.enableFlaggedFeatures(u.scene.featureFlags),(null===(n=u.scene)||void 0===n?void 0:n.sdkVersion)&&(this.version.platformSdk=null===(r=u.scene)||void 0===r?void 0:r.sdkVersion,this._logger.log("debug","platformSdk version:",this.version.platformSdk)),this.conversation.processStateMessage(u),this.controlMicrophoneMute(i)}else if(i&&"recognizeResults"===o){var l=i,p=l.status,f=l.errorMessage,h=l.results;this.conversation.processRecognizeResultsMessage(i),this._onRecognizeResultsEvent.call(this,p,f,h)}else if(i&&"conversationResult"===o){if(this.conversation.onConversationResult(i),_=i.personaId){var d=new P(this,_);this._onConversationResultEvents[_].call(d,i),this.currentPersonaId=_}}else if(i&&"speechMarker"===o){var _;if(this.conversation.onSpeechMarker(i),_=i.personaId){d=new P(this,_);this._onSpeechMarkerEvents[_].call(d,i),this.currentPersonaId=_}}else i&&"demoMode"===o&&this._onDemoModeEvent.call(this,i);a===J.Response&&c&&this.processResponse(i,o,s,c)},e.prototype.processResponse=function(e,t,n,r){var o=this._pendingResponses[r];if(o){if(0===n)o.resolve(e);else{var i=new K;i.requestName=t,i.status=n,i.responseBody=e,o.reject(i)}delete this._pendingResponses[r]}},e.prototype.controlMicrophoneMute=function(e){var t=this;if(e.persona&&this._session&&-1!==this._session.microphoneMuteDelay)for(var n in e.persona){var r=e.persona[n];r.speechState&&(r.speechState===Q.Speaking?(this._session.microphoneMuted||(this._logger.log("warn","Persona is speaking - mute microphone"),this._session.microphoneMuted=!0),this._microphoneUnmuteTimer&&(clearTimeout(this._microphoneUnmuteTimer),this._microphoneUnmuteTimer=void 0)):this._session.microphoneMuted&&!this._microphoneUnmuteTimer&&(this._microphoneUnmuteTimer=setTimeout((function(){t._session&&t._microphoneUnmuteTimer&&(t._logger.log("warn","Persona is no longer speaking - unmute microphone"),t._session.microphoneMuted=!1,t._microphoneUnmuteTimer=void 0)}),this._session.microphoneMuteDelay)))}},e.prototype.close=function(){this._session&&this._session.close(!0)},e.prototype.sessionConnected=function(e,t,n,r){this.contentAwareness=new Ve(this,this.contentAwarenessDebounceTime,new B(this._loggingConfig.contentAwareness.minLogLevel,this._loggingConfig.contentAwareness.enabled)),this._stopSpeakingWhenNotVisible&&document.addEventListener("visibilitychange",this.stopSpeakingWhenNotVisible),window.addEventListener("beforeunload",this.stopSpeakingWhenUnloaded),this._sendMetadata.pageUrl&&this._metadataSender.observeUrlChanges(),this._isResumedSession=t,e&&(this._sessionResumeEnabled=!0,function(e,t,n){sessionStorage.setItem("sm-server",e),sessionStorage.setItem("sm-session-id",t),sessionStorage.setItem("sm-api-key",n)}(n,r,this._apiKey||"")),t&&this._sendMetadata.pageUrl&&this._metadataSender.send()},e.prototype.cleanupEventListeners=function(){var e;(null===(e=this._session)||void 0===e?void 0:e.features.isIos)&&document.removeEventListener("visibilitychange",this.iosVisibilityChange),this._stopSpeakingWhenNotVisible&&document.removeEventListener("visibilitychange",this.stopSpeakingWhenNotVisible),window.removeEventListener("beforeunload",this.stopSpeakingWhenUnloaded)},e.prototype.sessionClosed=function(e){Jl(),this.cleanupEventListeners(),this._session&&(this.connectionState.reset(),this.conversation.reset(),this._onDisconnectedEvent.call(this,this._session.sessionId,e))},e.prototype.rtcUserText=function(e){this._onUserTextEvent.call(this,e)},e.prototype.enableFlaggedFeatures=function(e){this._serverControlledCameras=e.includes(X.UI_SDK_CAMERA_CONTROL)},e.prototype.sendContent=function(){var e;this.contentAwareness||console.warn("ContentAwareness is not enabled for this project"),null===(e=this.contentAwareness)||void 0===e||e.measure()},e.prototype.sendVideoBounds=function(e,t){this._session&&this._session.sendVideoBounds(e,t)},e.prototype.configure=function(e){return this.sendRequest("configure",e)},e.prototype.sendUserText=function(e){this._session&&this._session.sendUserText(e)},e.prototype.startRecognize=function(e){var t={};return void 0!==e&&(t.audioSource=e),this.sendRequest("startRecognize",t)},e.prototype.stopRecognize=function(){return this.sendRequest("stopRecognize")},e.prototype.isMicrophoneConnected=function(){return!!this._session&&this._session.isMicrophoneConnected},e.prototype.isCameraConnected=function(){return!!this._session&&this._session.isCameraConnected},e.prototype.session=function(){return this._session},e.prototype.hasContentAwareness=function(){return!!this.contentAwareness},e.prototype.hasServerControlledCameras=function(){return this._serverControlledCameras},e.prototype.supportsSessionPersistence=function(){return this._sessionResumeEnabled},e.prototype.isResumedSession=function(){return this._isResumedSession},Object.defineProperty(e.prototype,"onConversationResultEvents",{get:function(){return this._onConversationResultEvents},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onSpeechMarkerEvents",{get:function(){return this._onSpeechMarkerEvents},enumerable:!1,configurable:!0}),e.prototype.getState=function(){return M(this,void 0,Promise,(function(){return I(this,(function(e){return[2,this.sendRequest("getState")]}))}))},Object.defineProperty(e.prototype,"onStateEvent",{get:function(){return this._onStateEvent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onState",{set:function(e){this._onState=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onDisconnectedEvent",{get:function(){return this._onDisconnectedEvent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onDisconnected",{set:function(e){this._onDisconnected=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onRecognizeResultsEvent",{get:function(){return this._onRecognizeResultsEvent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onRecognizeResults",{set:function(e){this._onRecognizeResults=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onUserTextEvent",{get:function(){return this._onUserTextEvent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onUserText",{set:function(e){this._onUserText=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"echoCancellationEnabled",{get:function(){return this._echoCancellationEnabled},set:function(e){this._echoCancellationEnabled=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onDemoModeEvent",{get:function(){return this._onDemoModeEvent},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"videoElement",{get:function(){return this._videoElement},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewerOffsetX",{get:function(){return this._session?this._session.offsetX:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"viewerOffsetY",{get:function(){return this._session?this._session.offsetY:0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isWebSocketOnly",{get:function(){return this._isWebSocketOnly},set:function(e){this._isWebSocketOnly=e},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"onMicrophoneActive",{get:function(){return this._onMicrophoneActive},enumerable:!1,configurable:!0}),e.prototype.isMicrophoneActive=function(){var e;return Boolean(null===(e=this._session)||void 0===e?void 0:e.isMicrophoneActive())},Object.defineProperty(e.prototype,"onCameraActive",{get:function(){return this._onCameraActive},enumerable:!1,configurable:!0}),e.prototype.isCameraActive=function(){var e;return Boolean(null===(e=this._session)||void 0===e?void 0:e.isCameraActive())},e.prototype.setMediaDeviceActive=function(e){var t;return M(this,void 0,Promise,(function(){return I(this,(function(n){switch(n.label){case 0:return this.isConnected()?[4,null===(t=this._session)||void 0===t?void 0:t.setMediaDeviceActive({microphone:e.microphone,camera:e.camera})]:[3,2];case 1:return n.sent(),[3,3];case 2:throw V("Connection has not been established","noConnection");case 3:return[2]}}))}))},e.prototype.startVideo=function(e){return M(this,void 0,Promise,(function(){var t;return I(this,(function(n){switch(n.label){case 0:if(!(t=e||this._videoElement))throw V("Cannot find HTMLVideoElement","noVideoElement");return[4,this.playVideo(t)];case 1:return n.sent()?[2,{video:!0,audio:!0}]:(t.muted=!0,[4,this.playVideo(t)]);case 2:if(n.sent())return[2,{video:!0,audio:!1}];throw V("Cannot start media playback","userInteractionRequired")}}))}))},e.prototype.playVideo=function(e){return M(this,void 0,Promise,(function(){return I(this,(function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,e.play()];case 1:return t.sent(),[2,!0];case 2:return t.sent(),[2,!1];case 3:return[2]}}))}))},e.prototype.fetchAuthConfig=function(e){var t;try{t=JSON.parse(atob(e)).authServer}catch(e){throw V("Broken API key","Failed to decode api key")}var n=Wl(),r=n.server,o=n.resumeSessionId,i=n.savedApiKey;return r&&o&&i===e&&(t=t+"?sessionId="+o),fetch(t,{headers:{key:e}})},e.prototype.connectArgsToConfig=function(e,t,n,r){var o,i;return"string"==typeof e?{tokenServerUri:e,tokenServerAccessToken:n,userText:t,retryOptions:r}:{tokenServerUri:(null===(o=null==e?void 0:e.tokenServer)||void 0===o?void 0:o.uri)||"",tokenServerAccessToken:null===(i=null==e?void 0:e.tokenServer)||void 0===i?void 0:i.token,userText:null==e?void 0:e.userText,retryOptions:null==e?void 0:e.retryOptions}},e.prototype.isLoggingEnabled=function(){return this._logger.isEnabled},e.prototype.getMinLogLevel=function(){return this._logger.getMinLogLevel()},e.prototype.setLogging=function(e){this._logger.enableLogging(e)},e.prototype.setMinLogLevel=function(e){this._logger.setMinLogLevel(e)},e}();!function(e){e[e.none=z.None]="none",e[e.microphone=z.Microphone]="microphone",e[e.microphoneAndCamera=z.MicrophoneAndCamera]="microphoneAndCamera",e[e.camera=z.Camera]="camera"}(Ql||(Ql={}));var Zl=new function(){this.Scene=Yl,this.Persona=P,this.userMedia={none:z.None,microphone:z.Microphone,microphoneAndCamera:z.MicrophoneAndCamera,camera:z.Camera},this.DetectCapabilities=function(){return(new D).detectWebRTCFeatures()},this.setLogging=function(e){}};return t})()));
//# sourceMappingURL=smwebsdk.min.js.map